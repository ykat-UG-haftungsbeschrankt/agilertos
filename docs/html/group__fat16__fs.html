<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AgileRTOS (zrtos): FAT16 access</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">AgileRTOS (zrtos)<span id="projectnumber">&#160;Version 0.8.0 (ghostbuster)</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__fat16__fs.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">FAT16 access<div class="ingroups"><a class="el" href="group__fat16.html">FAT16 support</a></div></div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for FAT16 access:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs.png" border="0" usemap="#agroup____fat16____fs" alt=""/></div>
<map name="agroup____fat16____fs" id="agroup____fat16____fs">
<area shape="rect" href="group__fat16.html" title=" " alt="" coords="5,5,112,32"/>
<area shape="rect" title="Basic functions for handling a FAT16 filesystem." alt="" coords="160,5,265,32"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga554cb707673a9db9d6a668af97600d04" id="r_ga554cb707673a9db9d6a668af97600d04"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga554cb707673a9db9d6a668af97600d04">fat16_open</a> (struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *fs, struct partition_struct *partition)</td></tr>
<tr class="separator:ga554cb707673a9db9d6a668af97600d04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6588833571e6ef0f5d094b8ff56a5985" id="r_ga6588833571e6ef0f5d094b8ff56a5985"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga6588833571e6ef0f5d094b8ff56a5985">fat16_close</a> (struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *fs)</td></tr>
<tr class="separator:ga6588833571e6ef0f5d094b8ff56a5985"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4ae970c89e2d74d71eb313f104db7e27" id="r_ga4ae970c89e2d74d71eb313f104db7e27"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga4ae970c89e2d74d71eb313f104db7e27">fat16_read_header</a> (struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *fs)</td></tr>
<tr class="separator:ga4ae970c89e2d74d71eb313f104db7e27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2e0cd2d601f164cec718052204d257b5" id="r_ga2e0cd2d601f164cec718052204d257b5"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga2e0cd2d601f164cec718052204d257b5">fat16_read_root_dir_entry</a> (const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *fs, uint16_t entry_num, struct <a class="el" href="structfat16__dir__entry__struct.html">fat16_dir_entry_struct</a> *dir_entry)</td></tr>
<tr class="separator:ga2e0cd2d601f164cec718052204d257b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaefed7787ed7c6e2ce35f67c06aac36c7" id="r_gaefed7787ed7c6e2ce35f67c06aac36c7"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaefed7787ed7c6e2ce35f67c06aac36c7">fat16_read_sub_dir_entry</a> (const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *fs, uint16_t entry_num, const struct <a class="el" href="structfat16__dir__entry__struct.html">fat16_dir_entry_struct</a> *parent, struct <a class="el" href="structfat16__dir__entry__struct.html">fat16_dir_entry_struct</a> *dir_entry)</td></tr>
<tr class="separator:gaefed7787ed7c6e2ce35f67c06aac36c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6f277c11fa202ecfadca3635221f70a4" id="r_ga6f277c11fa202ecfadca3635221f70a4"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga6f277c11fa202ecfadca3635221f70a4">fat16_dir_entry_seek_callback</a> (uint8_t *buffer, uint32_t offset, void *p)</td></tr>
<tr class="separator:ga6f277c11fa202ecfadca3635221f70a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga64666f9e44e49273d33ed01058ff5fac" id="r_ga64666f9e44e49273d33ed01058ff5fac"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga64666f9e44e49273d33ed01058ff5fac">fat16_dir_entry_read_callback</a> (uint8_t *buffer, uint32_t offset, void *p)</td></tr>
<tr class="separator:ga64666f9e44e49273d33ed01058ff5fac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8927d70d35df0d10284286e2d5b66193" id="r_ga8927d70d35df0d10284286e2d5b66193"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga8927d70d35df0d10284286e2d5b66193">fat16_interpret_dir_entry</a> (struct <a class="el" href="structfat16__dir__entry__struct.html">fat16_dir_entry_struct</a> *dir_entry, const uint8_t *raw_entry)</td></tr>
<tr class="separator:ga8927d70d35df0d10284286e2d5b66193"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga80d15e5b202d3b8999f1c05d5da6be6a" id="r_ga80d15e5b202d3b8999f1c05d5da6be6a"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga80d15e5b202d3b8999f1c05d5da6be6a">fat16_get_next_cluster</a> (const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *fs, uint16_t cluster_num)</td></tr>
<tr class="separator:ga80d15e5b202d3b8999f1c05d5da6be6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7c2bf1884a5d396916b4581e15eb6992" id="r_ga7c2bf1884a5d396916b4581e15eb6992"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga7c2bf1884a5d396916b4581e15eb6992">fat16_append_clusters</a> (const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *fs, uint16_t cluster_num, uint16_t count)</td></tr>
<tr class="separator:ga7c2bf1884a5d396916b4581e15eb6992"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadef154e10fea9a769262e22c4bbfa383" id="r_gadef154e10fea9a769262e22c4bbfa383"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gadef154e10fea9a769262e22c4bbfa383">fat16_free_clusters</a> (const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *fs, uint16_t cluster_num)</td></tr>
<tr class="separator:gadef154e10fea9a769262e22c4bbfa383"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad1da920ff8c1a617522bbfa21972e4c7" id="r_gad1da920ff8c1a617522bbfa21972e4c7"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gad1da920ff8c1a617522bbfa21972e4c7">fat16_terminate_clusters</a> (const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *fs, uint16_t cluster_num)</td></tr>
<tr class="separator:gad1da920ff8c1a617522bbfa21972e4c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa8e109c4e412a52e117f01aab14831c9" id="r_gaa8e109c4e412a52e117f01aab14831c9"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaa8e109c4e412a52e117f01aab14831c9">fat16_write_dir_entry</a> (const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *fs, const struct <a class="el" href="structfat16__dir__entry__struct.html">fat16_dir_entry_struct</a> *dir_entry)</td></tr>
<tr class="separator:gaa8e109c4e412a52e117f01aab14831c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8af3c3535929e19b0039e07f1976cec7" id="r_ga8af3c3535929e19b0039e07f1976cec7"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga8af3c3535929e19b0039e07f1976cec7">fat16_get_fs_size</a> (const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *fs)</td></tr>
<tr class="separator:ga8af3c3535929e19b0039e07f1976cec7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2f8ff07cca44ecb6770b12a58b6cd8c7" id="r_ga2f8ff07cca44ecb6770b12a58b6cd8c7"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga2f8ff07cca44ecb6770b12a58b6cd8c7">fat16_get_fs_free</a> (const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *fs)</td></tr>
<tr class="separator:ga2f8ff07cca44ecb6770b12a58b6cd8c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7b21ea41c37e54f4edf690918f92fe8a" id="r_ga7b21ea41c37e54f4edf690918f92fe8a"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga7b21ea41c37e54f4edf690918f92fe8a">fat16_get_fs_free_callback</a> (uint8_t *buffer, uint32_t offset, void *p)</td></tr>
<tr class="separator:ga7b21ea41c37e54f4edf690918f92fe8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Basic functions for handling a FAT16 filesystem. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga7c2bf1884a5d396916b4581e15eb6992" name="ga7c2bf1884a5d396916b4581e15eb6992"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7c2bf1884a5d396916b4581e15eb6992">&#9670;&#160;</a></span>fat16_append_clusters()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t fat16_append_clusters </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>cluster_num</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>count</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Appends a new cluster chain to an existing one. </p>
<p>Set cluster_num to zero to create a completely new one.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fs</td><td>The file system on which to operate. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cluster_num</td><td>The cluster to which to append the new chain. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">count</td><td>The number of clusters to allocate. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, the number of the first new cluster on success. </dd></dl>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l00601">601</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  602</span>{</div>
<div class="line"><span class="lineno">  603</span><span class="preprocessor">    #if FAT16_WRITE_SUPPORT</span></div>
<div class="line"><span class="lineno">  604</span>        <span class="keywordflow">if</span>(!fs)</div>
<div class="line"><span class="lineno">  605</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  606</span>    </div>
<div class="line"><span class="lineno">  607</span>        device_read_t device_read = fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#a59ba2a9a21fc39f90358fe48baa5b923">partition</a>-&gt;device_read;</div>
<div class="line"><span class="lineno">  608</span>        device_write_t device_write = fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#a59ba2a9a21fc39f90358fe48baa5b923">partition</a>-&gt;device_write;</div>
<div class="line"><span class="lineno">  609</span>        uint32_t fat_offset = fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#ad1287906321608dc2aa7741324dca9b5">header</a>.<a class="code hl_variable" href="structfat16__header__struct.html#a747d84164b4dc1f39c8081dc6f59432a">fat_offset</a>;</div>
<div class="line"><span class="lineno">  610</span>        uint16_t cluster_max = fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#ad1287906321608dc2aa7741324dca9b5">header</a>.<a class="code hl_variable" href="structfat16__header__struct.html#ad96d9b98bad8bd19d767857f8bfe1870">fat_size</a> / 2;</div>
<div class="line"><span class="lineno">  611</span>        uint16_t cluster_next = 0;</div>
<div class="line"><span class="lineno">  612</span>        uint16_t count_left = count;</div>
<div class="line"><span class="lineno">  613</span>        uint8_t buffer[2];</div>
<div class="line"><span class="lineno">  614</span>        uint16_t cluster_new;</div>
<div class="line"><span class="lineno">  615</span>        <span class="keywordflow">for</span>(cluster_new = 0; cluster_new &lt; cluster_max; ++cluster_new)</div>
<div class="line"><span class="lineno">  616</span>        {</div>
<div class="line"><span class="lineno">  617</span>            <span class="keywordflow">if</span>(!device_read(fat_offset + 2 * cluster_new, buffer, <span class="keyword">sizeof</span>(buffer)))</div>
<div class="line"><span class="lineno">  618</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  619</span>    </div>
<div class="line"><span class="lineno">  620</span>            <span class="comment">/* check if this is a free cluster */</span></div>
<div class="line"><span class="lineno">  621</span>            <span class="keywordflow">if</span>(buffer[0] == (<a class="code hl_define" href="fat16_8h.html#a522cad018c7775d11293514bedf3354e">FAT16_CLUSTER_FREE</a> &amp; 0xff) &amp;&amp;</div>
<div class="line"><span class="lineno">  622</span>                buffer[1] == ((<a class="code hl_define" href="fat16_8h.html#a522cad018c7775d11293514bedf3354e">FAT16_CLUSTER_FREE</a> &gt;&gt; 8) &amp; 0xff))</div>
<div class="line"><span class="lineno">  623</span>            {</div>
<div class="line"><span class="lineno">  624</span>                <span class="comment">/* allocate cluster */</span></div>
<div class="line"><span class="lineno">  625</span>                <span class="keywordflow">if</span>(count_left == count)</div>
<div class="line"><span class="lineno">  626</span>                {</div>
<div class="line"><span class="lineno">  627</span>                    buffer[0] = <a class="code hl_define" href="fat16_8h.html#a5d15f887f18577d14ff69ef3de9efa0a">FAT16_CLUSTER_LAST_MAX</a> &amp; 0xff;</div>
<div class="line"><span class="lineno">  628</span>                    buffer[1] = (<a class="code hl_define" href="fat16_8h.html#a5d15f887f18577d14ff69ef3de9efa0a">FAT16_CLUSTER_LAST_MAX</a> &gt;&gt; 8) &amp; 0xff;</div>
<div class="line"><span class="lineno">  629</span>                }</div>
<div class="line"><span class="lineno">  630</span>                <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  631</span>                {</div>
<div class="line"><span class="lineno">  632</span>                    buffer[0] = cluster_next &amp; 0xff;</div>
<div class="line"><span class="lineno">  633</span>                    buffer[1] = (cluster_next &gt;&gt; 8) &amp; 0xff;</div>
<div class="line"><span class="lineno">  634</span>                }</div>
<div class="line"><span class="lineno">  635</span>    </div>
<div class="line"><span class="lineno">  636</span>                <span class="keywordflow">if</span>(!device_write(fat_offset + 2 * cluster_new, buffer, <span class="keyword">sizeof</span>(buffer)))</div>
<div class="line"><span class="lineno">  637</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  638</span>    </div>
<div class="line"><span class="lineno">  639</span>                cluster_next = cluster_new;</div>
<div class="line"><span class="lineno">  640</span>                <span class="keywordflow">if</span>(--count_left == 0)</div>
<div class="line"><span class="lineno">  641</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  642</span>            }</div>
<div class="line"><span class="lineno">  643</span>        }</div>
<div class="line"><span class="lineno">  644</span>    </div>
<div class="line"><span class="lineno">  645</span>        <span class="keywordflow">do</span></div>
<div class="line"><span class="lineno">  646</span>        {</div>
<div class="line"><span class="lineno">  647</span>            <span class="keywordflow">if</span>(count_left &gt; 0)</div>
<div class="line"><span class="lineno">  648</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  649</span>    </div>
<div class="line"><span class="lineno">  650</span>            <span class="comment">/* We allocated a new cluster chain. Now join</span></div>
<div class="line"><span class="lineno">  651</span><span class="comment">                                             * it with the existing one.</span></div>
<div class="line"><span class="lineno">  652</span><span class="comment">                                             */</span></div>
<div class="line"><span class="lineno">  653</span>            <span class="keywordflow">if</span>(cluster_num &gt;= 2)</div>
<div class="line"><span class="lineno">  654</span>            {</div>
<div class="line"><span class="lineno">  655</span>                buffer[0] = cluster_next &amp; 0xff;</div>
<div class="line"><span class="lineno">  656</span>                buffer[1] = (cluster_next &gt;&gt; 8) &amp; 0xff;</div>
<div class="line"><span class="lineno">  657</span>                <span class="keywordflow">if</span>(!device_write(fat_offset + 2 * cluster_num, buffer, <span class="keyword">sizeof</span>(buffer)))</div>
<div class="line"><span class="lineno">  658</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  659</span>            }</div>
<div class="line"><span class="lineno">  660</span>    </div>
<div class="line"><span class="lineno">  661</span>            <span class="keywordflow">return</span> cluster_next;</div>
<div class="line"><span class="lineno">  662</span>    </div>
<div class="line"><span class="lineno">  663</span>        }</div>
<div class="line"><span class="lineno">  664</span>        <span class="keywordflow">while</span>(0);</div>
<div class="line"><span class="lineno">  665</span>    </div>
<div class="line"><span class="lineno">  666</span>        <span class="comment">/* No space left on device or writing error.</span></div>
<div class="line"><span class="lineno">  667</span><span class="comment">                             * Free up all clusters already allocated.</span></div>
<div class="line"><span class="lineno">  668</span><span class="comment">                             */</span></div>
<div class="line"><span class="lineno">  669</span>        <a class="code hl_function" href="#gadef154e10fea9a769262e22c4bbfa383">fat16_free_clusters</a>(fs, cluster_next);</div>
<div class="line"><span class="lineno">  670</span>    </div>
<div class="line"><span class="lineno">  671</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  672</span><span class="preprocessor">    #else</span></div>
<div class="line"><span class="lineno">  673</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  674</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno">  675</span>}</div>
<div class="ttc" id="afat16_8h_html_a522cad018c7775d11293514bedf3354e"><div class="ttname"><a href="fat16_8h.html#a522cad018c7775d11293514bedf3354e">FAT16_CLUSTER_FREE</a></div><div class="ttdeci">#define FAT16_CLUSTER_FREE</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l00065">fat16.h:65</a></div></div>
<div class="ttc" id="afat16_8h_html_a5d15f887f18577d14ff69ef3de9efa0a"><div class="ttname"><a href="fat16_8h.html#a5d15f887f18577d14ff69ef3de9efa0a">FAT16_CLUSTER_LAST_MAX</a></div><div class="ttdeci">#define FAT16_CLUSTER_LAST_MAX</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l00070">fat16.h:70</a></div></div>
<div class="ttc" id="agroup__fat16__fs_html_gadef154e10fea9a769262e22c4bbfa383"><div class="ttname"><a href="#gadef154e10fea9a769262e22c4bbfa383">fat16_free_clusters</a></div><div class="ttdeci">static uint8_t fat16_free_clusters(const struct fat16_fs_struct *fs, uint16_t cluster_num)</div><div class="ttdoc">Frees a cluster chain, or a part thereof.</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l00694">fat16.h:694</a></div></div>
<div class="ttc" id="astructfat16__fs__struct_html_a59ba2a9a21fc39f90358fe48baa5b923"><div class="ttname"><a href="structfat16__fs__struct.html#a59ba2a9a21fc39f90358fe48baa5b923">fat16_fs_struct::partition</a></div><div class="ttdeci">struct partition_struct * partition</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00152">fat16_header.h:152</a></div></div>
<div class="ttc" id="astructfat16__fs__struct_html_ad1287906321608dc2aa7741324dca9b5"><div class="ttname"><a href="structfat16__fs__struct.html#ad1287906321608dc2aa7741324dca9b5">fat16_fs_struct::header</a></div><div class="ttdeci">struct fat16_header_struct header</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00153">fat16_header.h:153</a></div></div>
<div class="ttc" id="astructfat16__header__struct_html_a747d84164b4dc1f39c8081dc6f59432a"><div class="ttname"><a href="structfat16__header__struct.html#a747d84164b4dc1f39c8081dc6f59432a">fat16_header_struct::fat_offset</a></div><div class="ttdeci">uint32_t fat_offset</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00140">fat16_header.h:140</a></div></div>
<div class="ttc" id="astructfat16__header__struct_html_ad96d9b98bad8bd19d767857f8bfe1870"><div class="ttname"><a href="structfat16__header__struct.html#ad96d9b98bad8bd19d767857f8bfe1870">fat16_header_struct::fat_size</a></div><div class="ttdeci">uint32_t fat_size</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00141">fat16_header.h:141</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_ga7c2bf1884a5d396916b4581e15eb6992_cgraph.png" border="0" usemap="#agroup__fat16__fs_ga7c2bf1884a5d396916b4581e15eb6992_cgraph" alt=""/></div>
<map name="agroup__fat16__fs_ga7c2bf1884a5d396916b4581e15eb6992_cgraph" id="agroup__fat16__fs_ga7c2bf1884a5d396916b4581e15eb6992_cgraph">
<area shape="rect" title="Appends a new cluster chain to an existing one." alt="" coords="5,5,157,32"/>
<area shape="rect" href="group__fat16__fs.html#gadef154e10fea9a769262e22c4bbfa383" title="Frees a cluster chain, or a part thereof." alt="" coords="205,5,335,32"/>
<area shape="poly" title=" " alt="" coords="157,16,189,16,189,21,157,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_ga7c2bf1884a5d396916b4581e15eb6992_icgraph.png" border="0" usemap="#agroup__fat16__fs_ga7c2bf1884a5d396916b4581e15eb6992_icgraph" alt=""/></div>
<map name="agroup__fat16__fs_ga7c2bf1884a5d396916b4581e15eb6992_icgraph" id="agroup__fat16__fs_ga7c2bf1884a5d396916b4581e15eb6992_icgraph">
<area shape="rect" title="Appends a new cluster chain to an existing one." alt="" coords="324,56,475,83"/>
<area shape="rect" href="group__fat16__file.html#gaf8029e3ec633902d08e8204d13afc350" title="Creates a file." alt="" coords="161,5,276,32"/>
<area shape="poly" title=" " alt="" coords="334,54,268,35,270,30,335,49"/>
<area shape="rect" href="group__fat16__file.html#ga23740742fa60ca148ef098caac7085c0" title="Resizes a file to have a specific size." alt="" coords="161,56,276,83"/>
<area shape="poly" title=" " alt="" coords="309,72,276,72,276,67,309,67"/>
<area shape="rect" href="group__fat16__file.html#ga4f0c785a47b1cf070839b5edec2c6f65" title="Writes data to a file." alt="" coords="165,107,272,133"/>
<area shape="poly" title=" " alt="" coords="335,90,270,109,268,104,334,85"/>
<area shape="rect" href="group__fat16__file.html#gaf1511fd1a5419d0828265566dc5d33e4" title="Repositions the read/write file offset." alt="" coords="5,56,113,83"/>
<area shape="poly" title=" " alt="" coords="146,72,113,72,113,67,146,67"/>
</map>
</div>

</div>
</div>
<a id="ga6588833571e6ef0f5d094b8ff56a5985" name="ga6588833571e6ef0f5d094b8ff56a5985"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6588833571e6ef0f5d094b8ff56a5985">&#9670;&#160;</a></span>fat16_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fat16_close </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Closes a FAT16 filesystem. </p>
<p>When this function returns, the given filesystem descriptor will be invalid.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fs</td><td>The filesystem to close. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#ga554cb707673a9db9d6a668af97600d04" title="Opens a FAT16 filesystem.">fat16_open</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l00127">127</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  127</span>                                             {</div>
<div class="line"><span class="lineno">  128</span>  memset(fs, 0, <span class="keyword">sizeof</span>(*fs));</div>
<div class="line"><span class="lineno">  129</span>  <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  130</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ga64666f9e44e49273d33ed01058ff5fac" name="ga64666f9e44e49273d33ed01058ff5fac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga64666f9e44e49273d33ed01058ff5fac">&#9670;&#160;</a></span>fat16_dir_entry_read_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t fat16_dir_entry_read_callback </td>
          <td>(</td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>offset</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>p</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback function for reading a directory entry. </p>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l00368">368</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  369</span>{</div>
<div class="line"><span class="lineno">  370</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structfat16__dir__entry__struct.html">fat16_dir_entry_struct</a>* dir_entry = p;</div>
<div class="line"><span class="lineno">  371</span> </div>
<div class="line"><span class="lineno">  372</span>    <span class="comment">/* there should not be any deleted or empty entries */</span></div>
<div class="line"><span class="lineno">  373</span>    <span class="keywordflow">if</span>(buffer[0] == <a class="code hl_define" href="fat16_8h.html#a062d60991f5236f2dd1b323d7faeabe3">FAT16_DIRENTRY_DELETED</a> || !buffer[0])</div>
<div class="line"><span class="lineno">  374</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  375</span> </div>
<div class="line"><span class="lineno">  376</span>    <span class="keywordflow">if</span>(!dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a8af0bfe59cef4c7940d2e53da87a0c28">entry_offset</a>)</div>
<div class="line"><span class="lineno">  377</span>        dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a8af0bfe59cef4c7940d2e53da87a0c28">entry_offset</a> = offset;</div>
<div class="line"><span class="lineno">  378</span> </div>
<div class="line"><span class="lineno">  379</span>    <span class="keywordflow">switch</span>(<a class="code hl_function" href="#ga8927d70d35df0d10284286e2d5b66193">fat16_interpret_dir_entry</a>(dir_entry, buffer))</div>
<div class="line"><span class="lineno">  380</span>    {</div>
<div class="line"><span class="lineno">  381</span>        <span class="keywordflow">case</span> 0: <span class="comment">/* failure */</span></div>
<div class="line"><span class="lineno">  382</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  383</span>            <span class="keywordflow">case</span> 1: <span class="comment">/* buffer successfully parsed, continue */</span></div>
<div class="line"><span class="lineno">  384</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  385</span>            <span class="keywordflow">case</span> 2: <span class="comment">/* directory entry complete, finish */</span></div>
<div class="line"><span class="lineno">  386</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  387</span>        }</div>
<div class="line"><span class="lineno">  388</span> </div>
<div class="line"><span class="lineno">  389</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  390</span>}</div>
<div class="ttc" id="afat16_8h_html_a062d60991f5236f2dd1b323d7faeabe3"><div class="ttname"><a href="fat16_8h.html#a062d60991f5236f2dd1b323d7faeabe3">FAT16_DIRENTRY_DELETED</a></div><div class="ttdeci">#define FAT16_DIRENTRY_DELETED</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l00072">fat16.h:72</a></div></div>
<div class="ttc" id="agroup__fat16__fs_html_ga8927d70d35df0d10284286e2d5b66193"><div class="ttname"><a href="#ga8927d70d35df0d10284286e2d5b66193">fat16_interpret_dir_entry</a></div><div class="ttdeci">static uint8_t fat16_interpret_dir_entry(struct fat16_dir_entry_struct *dir_entry, const uint8_t *raw_entry)</div><div class="ttdoc">Interprets a raw directory entry and puts the contained information into the directory entry.</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l00408">fat16.h:408</a></div></div>
<div class="ttc" id="astructfat16__dir__entry__struct_html"><div class="ttname"><a href="structfat16__dir__entry__struct.html">fat16_dir_entry_struct</a></div><div class="ttdoc">Describes a directory entry.</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00065">fat16_header.h:65</a></div></div>
<div class="ttc" id="astructfat16__dir__entry__struct_html_a8af0bfe59cef4c7940d2e53da87a0c28"><div class="ttname"><a href="structfat16__dir__entry__struct.html#a8af0bfe59cef4c7940d2e53da87a0c28">fat16_dir_entry_struct::entry_offset</a></div><div class="ttdeci">uint32_t entry_offset</div><div class="ttdoc">The total disk offset of this directory entry.</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00081">fat16_header.h:81</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_ga64666f9e44e49273d33ed01058ff5fac_cgraph.png" border="0" usemap="#agroup__fat16__fs_ga64666f9e44e49273d33ed01058ff5fac_cgraph" alt=""/></div>
<map name="agroup__fat16__fs_ga64666f9e44e49273d33ed01058ff5fac_cgraph" id="agroup__fat16__fs_ga64666f9e44e49273d33ed01058ff5fac_cgraph">
<area shape="rect" title="Callback function for reading a directory entry." alt="" coords="5,5,144,48"/>
<area shape="rect" href="group__fat16__fs.html#ga8927d70d35df0d10284286e2d5b66193" title="Interprets a raw directory entry and puts the contained information into the directory entry." alt="" coords="192,5,316,48"/>
<area shape="poly" title=" " alt="" coords="144,24,176,24,176,29,144,29"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_ga64666f9e44e49273d33ed01058ff5fac_icgraph.png" border="0" usemap="#agroup__fat16__fs_ga64666f9e44e49273d33ed01058ff5fac_icgraph" alt=""/></div>
<map name="agroup__fat16__fs_ga64666f9e44e49273d33ed01058ff5fac_icgraph" id="agroup__fat16__fs_ga64666f9e44e49273d33ed01058ff5fac_icgraph">
<area shape="rect" title="Callback function for reading a directory entry." alt="" coords="673,56,811,99"/>
<area shape="rect" href="group__fat16__fs.html#ga2e0cd2d601f164cec718052204d257b5" title="Reads a directory entry of the root directory." alt="" coords="493,23,625,65"/>
<area shape="poly" title=" " alt="" coords="657,65,624,59,625,53,658,59"/>
<area shape="rect" href="group__fat16__fs.html#gaefed7787ed7c6e2ce35f67c06aac36c7" title="Reads a directory entry of a given parent directory." alt="" coords="494,89,624,132"/>
<area shape="poly" title=" " alt="" coords="658,95,625,101,624,96,657,90"/>
<area shape="rect" href="group__fat16__dir.html#ga73c8f0598e8224736b09644c48cf2970" title="Reads the next directory entry contained within a parent directory." alt="" coords="343,64,445,91"/>
<area shape="poly" title=" " alt="" coords="479,63,446,70,445,64,478,58"/>
<area shape="rect" href="group__fat16__file.html#gaf8029e3ec633902d08e8204d13afc350" title="Creates a file." alt="" coords="172,5,287,32"/>
<area shape="poly" title=" " alt="" coords="340,61,268,35,270,30,341,56"/>
<area shape="rect" href="group__fat16__file.html#ga0045fe378de2f7c52b528f985e1891a6" title="Retrieves the directory entry of a path." alt="" coords="164,56,295,99"/>
<area shape="poly" title=" " alt="" coords="327,80,295,80,295,75,327,75"/>
<area shape="rect" href="group__fat16.html#gaa25986550d47370f582118a9ef6eae24" title=" " alt="" coords="178,123,281,149"/>
<area shape="poly" title=" " alt="" coords="341,99,270,125,268,120,340,94"/>
<area shape="rect" href="group__fat16.html#gacdc9da639a6ccdac9847aaba559f9ef0" title=" " alt="" coords="5,123,116,149"/>
<area shape="poly" title=" " alt="" coords="163,139,116,139,116,133,163,133"/>
<area shape="poly" title=" " alt="" coords="478,97,445,90,446,85,479,92"/>
</map>
</div>

</div>
</div>
<a id="ga6f277c11fa202ecfadca3635221f70a4" name="ga6f277c11fa202ecfadca3635221f70a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6f277c11fa202ecfadca3635221f70a4">&#9670;&#160;</a></span>fat16_dir_entry_seek_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t fat16_dir_entry_seek_callback </td>
          <td>(</td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>offset</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>p</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback function for seeking through subdirectory entries. </p>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l00340">340</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  341</span>{</div>
<div class="line"><span class="lineno">  342</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structfat16__read__callback__arg.html">fat16_read_callback_arg</a>* arg = p;</div>
<div class="line"><span class="lineno">  343</span> </div>
<div class="line"><span class="lineno">  344</span>    <span class="comment">/* skip deleted or empty entries */</span></div>
<div class="line"><span class="lineno">  345</span>    <span class="keywordflow">if</span>(buffer[0] == <a class="code hl_define" href="fat16_8h.html#a062d60991f5236f2dd1b323d7faeabe3">FAT16_DIRENTRY_DELETED</a> || !buffer[0])</div>
<div class="line"><span class="lineno">  346</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  347</span> </div>
<div class="line"><span class="lineno">  348</span>    <span class="keywordflow">if</span>(arg-&gt;<a class="code hl_variable" href="structfat16__read__callback__arg.html#a7e0b4fd23f8c521d50907c4794850c6a">entry_cur</a> == arg-&gt;<a class="code hl_variable" href="structfat16__read__callback__arg.html#a3bd3955143c97975d82d1ac2f6f45b37">entry_num</a>)</div>
<div class="line"><span class="lineno">  349</span>    {</div>
<div class="line"><span class="lineno">  350</span>        arg-&gt;<a class="code hl_variable" href="structfat16__read__callback__arg.html#a1f667535d7e07377f512e2a84a5102ac">entry_offset</a> = offset;</div>
<div class="line"><span class="lineno">  351</span>        arg-&gt;<a class="code hl_variable" href="structfat16__read__callback__arg.html#a877a9b864461d1f57868d8db876e8c8a">byte_count</a> = buffer[11] == 0x0f ?</div>
<div class="line"><span class="lineno">  352</span>        ((buffer[0] &amp; <a class="code hl_define" href="fat16_8h.html#a48281c5b0fce551f67e0ac23a963b881">FAT16_DIRENTRY_LFNSEQMASK</a>) + 1) * 32 :</div>
<div class="line"><span class="lineno">  353</span>        32;</div>
<div class="line"><span class="lineno">  354</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  355</span>    }</div>
<div class="line"><span class="lineno">  356</span> </div>
<div class="line"><span class="lineno">  357</span>    <span class="comment">/* if we read a 8.3 entry, we reached a new directory entry */</span></div>
<div class="line"><span class="lineno">  358</span>    <span class="keywordflow">if</span>(buffer[11] != 0x0f)</div>
<div class="line"><span class="lineno">  359</span>        ++arg-&gt;<a class="code hl_variable" href="structfat16__read__callback__arg.html#a7e0b4fd23f8c521d50907c4794850c6a">entry_cur</a>;</div>
<div class="line"><span class="lineno">  360</span> </div>
<div class="line"><span class="lineno">  361</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  362</span>}</div>
<div class="ttc" id="afat16_8h_html_a48281c5b0fce551f67e0ac23a963b881"><div class="ttname"><a href="fat16_8h.html#a48281c5b0fce551f67e0ac23a963b881">FAT16_DIRENTRY_LFNSEQMASK</a></div><div class="ttdeci">#define FAT16_DIRENTRY_LFNSEQMASK</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l00074">fat16.h:74</a></div></div>
<div class="ttc" id="astructfat16__read__callback__arg_html"><div class="ttname"><a href="structfat16__read__callback__arg.html">fat16_read_callback_arg</a></div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00170">fat16_header.h:170</a></div></div>
<div class="ttc" id="astructfat16__read__callback__arg_html_a1f667535d7e07377f512e2a84a5102ac"><div class="ttname"><a href="structfat16__read__callback__arg.html#a1f667535d7e07377f512e2a84a5102ac">fat16_read_callback_arg::entry_offset</a></div><div class="ttdeci">uint32_t entry_offset</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00173">fat16_header.h:173</a></div></div>
<div class="ttc" id="astructfat16__read__callback__arg_html_a3bd3955143c97975d82d1ac2f6f45b37"><div class="ttname"><a href="structfat16__read__callback__arg.html#a3bd3955143c97975d82d1ac2f6f45b37">fat16_read_callback_arg::entry_num</a></div><div class="ttdeci">uint16_t entry_num</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00172">fat16_header.h:172</a></div></div>
<div class="ttc" id="astructfat16__read__callback__arg_html_a7e0b4fd23f8c521d50907c4794850c6a"><div class="ttname"><a href="structfat16__read__callback__arg.html#a7e0b4fd23f8c521d50907c4794850c6a">fat16_read_callback_arg::entry_cur</a></div><div class="ttdeci">uint16_t entry_cur</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00171">fat16_header.h:171</a></div></div>
<div class="ttc" id="astructfat16__read__callback__arg_html_a877a9b864461d1f57868d8db876e8c8a"><div class="ttname"><a href="structfat16__read__callback__arg.html#a877a9b864461d1f57868d8db876e8c8a">fat16_read_callback_arg::byte_count</a></div><div class="ttdeci">uint8_t byte_count</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00174">fat16_header.h:174</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_ga6f277c11fa202ecfadca3635221f70a4_icgraph.png" border="0" usemap="#agroup__fat16__fs_ga6f277c11fa202ecfadca3635221f70a4_icgraph" alt=""/></div>
<map name="agroup__fat16__fs_ga6f277c11fa202ecfadca3635221f70a4_icgraph" id="agroup__fat16__fs_ga6f277c11fa202ecfadca3635221f70a4_icgraph">
<area shape="rect" title="Callback function for seeking through subdirectory entries." alt="" coords="673,56,814,99"/>
<area shape="rect" href="group__fat16__fs.html#ga2e0cd2d601f164cec718052204d257b5" title="Reads a directory entry of the root directory." alt="" coords="493,23,625,65"/>
<area shape="poly" title=" " alt="" coords="657,64,624,58,625,53,658,59"/>
<area shape="rect" href="group__fat16__fs.html#gaefed7787ed7c6e2ce35f67c06aac36c7" title="Reads a directory entry of a given parent directory." alt="" coords="494,89,624,132"/>
<area shape="poly" title=" " alt="" coords="658,95,625,101,624,96,657,90"/>
<area shape="rect" href="group__fat16__dir.html#ga73c8f0598e8224736b09644c48cf2970" title="Reads the next directory entry contained within a parent directory." alt="" coords="343,64,445,91"/>
<area shape="poly" title=" " alt="" coords="479,63,446,70,445,64,478,58"/>
<area shape="rect" href="group__fat16__file.html#gaf8029e3ec633902d08e8204d13afc350" title="Creates a file." alt="" coords="172,5,287,32"/>
<area shape="poly" title=" " alt="" coords="340,61,268,35,270,30,341,56"/>
<area shape="rect" href="group__fat16__file.html#ga0045fe378de2f7c52b528f985e1891a6" title="Retrieves the directory entry of a path." alt="" coords="164,56,295,99"/>
<area shape="poly" title=" " alt="" coords="327,80,295,80,295,75,327,75"/>
<area shape="rect" href="group__fat16.html#gaa25986550d47370f582118a9ef6eae24" title=" " alt="" coords="178,123,281,149"/>
<area shape="poly" title=" " alt="" coords="341,99,270,125,268,120,340,94"/>
<area shape="rect" href="group__fat16.html#gacdc9da639a6ccdac9847aaba559f9ef0" title=" " alt="" coords="5,123,116,149"/>
<area shape="poly" title=" " alt="" coords="163,139,116,139,116,133,163,133"/>
<area shape="poly" title=" " alt="" coords="478,97,445,90,446,85,479,92"/>
</map>
</div>

</div>
</div>
<a id="gadef154e10fea9a769262e22c4bbfa383" name="gadef154e10fea9a769262e22c4bbfa383"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadef154e10fea9a769262e22c4bbfa383">&#9670;&#160;</a></span>fat16_free_clusters()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t fat16_free_clusters </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>cluster_num</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Frees a cluster chain, or a part thereof. </p>
<p>Marks the specified cluster and all clusters which are sequentially referenced by it as free. They may then be used again for future file allocations.</p>
<dl class="section note"><dt>Note</dt><dd>If this function is used for freeing just a part of a cluster chain, the new end of the chain is not correctly terminated within the FAT. Use <a class="el" href="#gad1da920ff8c1a617522bbfa21972e4c7" title="Frees a part of a cluster chain and correctly terminates the rest.">fat16_terminate_clusters()</a> instead.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fs</td><td>The filesystem on which to operate. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cluster_num</td><td>The starting cluster of the chain which to free. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, 1 on success. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#gad1da920ff8c1a617522bbfa21972e4c7" title="Frees a part of a cluster chain and correctly terminates the rest.">fat16_terminate_clusters</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l00694">694</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  695</span>{</div>
<div class="line"><span class="lineno">  696</span><span class="preprocessor">    #if FAT16_WRITE_SUPPORT</span></div>
<div class="line"><span class="lineno">  697</span>        <span class="keywordflow">if</span>(!fs || cluster_num &lt; 2)</div>
<div class="line"><span class="lineno">  698</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  699</span>    </div>
<div class="line"><span class="lineno">  700</span>        uint32_t fat_offset = fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#ad1287906321608dc2aa7741324dca9b5">header</a>.<a class="code hl_variable" href="structfat16__header__struct.html#a747d84164b4dc1f39c8081dc6f59432a">fat_offset</a>;</div>
<div class="line"><span class="lineno">  701</span>        uint8_t buffer[2];</div>
<div class="line"><span class="lineno">  702</span>        <span class="keywordflow">while</span>(cluster_num)</div>
<div class="line"><span class="lineno">  703</span>        {</div>
<div class="line"><span class="lineno">  704</span>            <span class="keywordflow">if</span>(!fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#a59ba2a9a21fc39f90358fe48baa5b923">partition</a>-&gt;device_read(fat_offset + 2 * cluster_num, buffer, 2))</div>
<div class="line"><span class="lineno">  705</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  706</span>    </div>
<div class="line"><span class="lineno">  707</span>            <span class="comment">/* get next cluster of current cluster before freeing current cluster */</span></div>
<div class="line"><span class="lineno">  708</span>            uint16_t cluster_num_next = ((uint16_t) buffer[0]) |</div>
<div class="line"><span class="lineno">  709</span>            ((uint16_t) buffer[1] &lt;&lt; 8);</div>
<div class="line"><span class="lineno">  710</span>    </div>
<div class="line"><span class="lineno">  711</span>            <span class="keywordflow">if</span>(cluster_num_next == <a class="code hl_define" href="fat16_8h.html#a522cad018c7775d11293514bedf3354e">FAT16_CLUSTER_FREE</a>)</div>
<div class="line"><span class="lineno">  712</span>                <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  713</span>            <span class="keywordflow">if</span>(cluster_num_next == <a class="code hl_define" href="fat16_8h.html#a688fb1639a9f8fc728eb70df0c21d60b">FAT16_CLUSTER_BAD</a> ||</div>
<div class="line"><span class="lineno">  714</span>                (cluster_num_next &gt;= <a class="code hl_define" href="fat16_8h.html#adeead813e1f60ddb2dc9c8e7a7a25315">FAT16_CLUSTER_RESERVED_MIN</a> &amp;&amp;</div>
<div class="line"><span class="lineno">  715</span>               cluster_num_next &lt;= <a class="code hl_define" href="fat16_8h.html#a3331ed0dd68db4e4d8c5736c2469c2d0">FAT16_CLUSTER_RESERVED_MAX</a></div>
<div class="line"><span class="lineno">  716</span>               )</div>
<div class="line"><span class="lineno">  717</span>               )</div>
<div class="line"><span class="lineno">  718</span>            <span class="keywordflow">return</span> 0;<span class="comment"></span></div>
<div class="line"><span class="lineno">  719</span><span class="comment">            ///*</span></div>
<div class="line"><span class="lineno">  720</span><span class="comment"></span>            <span class="keywordflow">if</span>((cluster_num_next &gt;= <a class="code hl_define" href="fat16_8h.html#ac74094f0b780bf45067994830d50bac7">FAT16_CLUSTER_LAST_MIN</a>) &amp;&amp;</div>
<div class="line"><span class="lineno">  721</span>                (cluster_num_next &lt;= <a class="code hl_define" href="fat16_8h.html#a5d15f887f18577d14ff69ef3de9efa0a">FAT16_CLUSTER_LAST_MAX</a>)</div>
<div class="line"><span class="lineno">  722</span>               )</div>
<div class="line"><span class="lineno">  723</span>            <span class="comment">//*/</span></div>
<div class="line"><span class="lineno">  724</span>            cluster_num_next = 0;</div>
<div class="line"><span class="lineno">  725</span>    </div>
<div class="line"><span class="lineno">  726</span>            <span class="comment">/* free cluster */</span></div>
<div class="line"><span class="lineno">  727</span>            buffer[0] = <a class="code hl_define" href="fat16_8h.html#a522cad018c7775d11293514bedf3354e">FAT16_CLUSTER_FREE</a> &amp; 0xff;</div>
<div class="line"><span class="lineno">  728</span>            buffer[1] = (<a class="code hl_define" href="fat16_8h.html#a522cad018c7775d11293514bedf3354e">FAT16_CLUSTER_FREE</a> &gt;&gt; 8) &amp; 0xff;</div>
<div class="line"><span class="lineno">  729</span>            fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#a59ba2a9a21fc39f90358fe48baa5b923">partition</a>-&gt;device_write(fat_offset + 2 * cluster_num, buffer, 2);</div>
<div class="line"><span class="lineno">  730</span>    </div>
<div class="line"><span class="lineno">  731</span>            <span class="comment">/* We continue in any case here, even if freeing the cluster failed.</span></div>
<div class="line"><span class="lineno">  732</span><span class="comment">                                             * The cluster is lost, but maybe we can still free up some later ones.</span></div>
<div class="line"><span class="lineno">  733</span><span class="comment">                                             */</span></div>
<div class="line"><span class="lineno">  734</span>    </div>
<div class="line"><span class="lineno">  735</span>            cluster_num = cluster_num_next;</div>
<div class="line"><span class="lineno">  736</span>        }</div>
<div class="line"><span class="lineno">  737</span>    </div>
<div class="line"><span class="lineno">  738</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  739</span><span class="preprocessor">    #else</span></div>
<div class="line"><span class="lineno">  740</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  741</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno">  742</span>}</div>
<div class="ttc" id="afat16_8h_html_a3331ed0dd68db4e4d8c5736c2469c2d0"><div class="ttname"><a href="fat16_8h.html#a3331ed0dd68db4e4d8c5736c2469c2d0">FAT16_CLUSTER_RESERVED_MAX</a></div><div class="ttdeci">#define FAT16_CLUSTER_RESERVED_MAX</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l00067">fat16.h:67</a></div></div>
<div class="ttc" id="afat16_8h_html_a688fb1639a9f8fc728eb70df0c21d60b"><div class="ttname"><a href="fat16_8h.html#a688fb1639a9f8fc728eb70df0c21d60b">FAT16_CLUSTER_BAD</a></div><div class="ttdeci">#define FAT16_CLUSTER_BAD</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l00068">fat16.h:68</a></div></div>
<div class="ttc" id="afat16_8h_html_ac74094f0b780bf45067994830d50bac7"><div class="ttname"><a href="fat16_8h.html#ac74094f0b780bf45067994830d50bac7">FAT16_CLUSTER_LAST_MIN</a></div><div class="ttdeci">#define FAT16_CLUSTER_LAST_MIN</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l00069">fat16.h:69</a></div></div>
<div class="ttc" id="afat16_8h_html_adeead813e1f60ddb2dc9c8e7a7a25315"><div class="ttname"><a href="fat16_8h.html#adeead813e1f60ddb2dc9c8e7a7a25315">FAT16_CLUSTER_RESERVED_MIN</a></div><div class="ttdeci">#define FAT16_CLUSTER_RESERVED_MIN</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l00066">fat16.h:66</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_gadef154e10fea9a769262e22c4bbfa383_icgraph.png" border="0" usemap="#agroup__fat16__fs_gadef154e10fea9a769262e22c4bbfa383_icgraph" alt=""/></div>
<map name="agroup__fat16__fs_gadef154e10fea9a769262e22c4bbfa383_icgraph" id="agroup__fat16__fs_gadef154e10fea9a769262e22c4bbfa383_icgraph">
<area shape="rect" title="Frees a cluster chain, or a part thereof." alt="" coords="535,132,666,159"/>
<area shape="rect" href="group__fat16__fs.html#ga7c2bf1884a5d396916b4581e15eb6992" title="Appends a new cluster chain to an existing one." alt="" coords="330,56,481,83"/>
<area shape="poly" title=" " alt="" coords="549,128,441,86,443,81,551,123"/>
<area shape="rect" href="group__fat16__file.html#ga23740742fa60ca148ef098caac7085c0" title="Resizes a file to have a specific size." alt="" coords="161,107,276,133"/>
<area shape="poly" title=" " alt="" coords="520,143,276,126,276,121,520,137"/>
<area shape="rect" href="group__fat16__file.html#gae060faccbbeca802afe86be2f4d5b485" title="Deletes a file or directory." alt="" coords="349,157,463,184"/>
<area shape="poly" title=" " alt="" coords="520,158,463,166,463,161,520,153"/>
<area shape="rect" href="group__fat16__fs.html#gad1da920ff8c1a617522bbfa21972e4c7" title="Frees a part of a cluster chain and correctly terminates the rest." alt="" coords="324,208,487,235"/>
<area shape="poly" title=" " alt="" coords="559,168,488,198,455,210,454,205,486,194,556,163"/>
<area shape="rect" href="group__fat16__file.html#gaf8029e3ec633902d08e8204d13afc350" title="Creates a file." alt="" coords="161,5,276,32"/>
<area shape="poly" title=" " alt="" coords="338,54,270,35,271,30,340,49"/>
<area shape="poly" title=" " alt="" coords="340,90,271,109,270,103,338,85"/>
<area shape="rect" href="group__fat16__file.html#ga4f0c785a47b1cf070839b5edec2c6f65" title="Writes data to a file." alt="" coords="165,56,272,83"/>
<area shape="poly" title=" " alt="" coords="315,72,272,72,272,67,315,67"/>
<area shape="rect" href="group__fat16__file.html#gaf1511fd1a5419d0828265566dc5d33e4" title="Repositions the read/write file offset." alt="" coords="5,107,113,133"/>
<area shape="poly" title=" " alt="" coords="146,123,113,123,113,117,146,117"/>
<area shape="poly" title=" " alt="" coords="336,205,323,198,273,167,234,136,237,132,276,163,325,194,339,200"/>
</map>
</div>

</div>
</div>
<a id="ga2f8ff07cca44ecb6770b12a58b6cd8c7" name="ga2f8ff07cca44ecb6770b12a58b6cd8c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2f8ff07cca44ecb6770b12a58b6cd8c7">&#9670;&#160;</a></span>fat16_get_fs_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t fat16_get_fs_free </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the amount of free storage capacity on the filesystem in bytes. </p>
<dl class="section note"><dt>Note</dt><dd>As the FAT16 filesystem is cluster based, this function does not return continuous values but multiples of the cluster size.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fs</td><td>The filesystem on which to operate. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, the free filesystem space in bytes otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l01726">1726</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1727</span>{</div>
<div class="line"><span class="lineno"> 1728</span>    <span class="keywordflow">if</span>(!fs)</div>
<div class="line"><span class="lineno"> 1729</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1730</span> </div>
<div class="line"><span class="lineno"> 1731</span>    uint8_t fat[32];</div>
<div class="line"><span class="lineno"> 1732</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structfat16__usage__count__callback__arg.html">fat16_usage_count_callback_arg</a> count_arg;</div>
<div class="line"><span class="lineno"> 1733</span>    count_arg.<a class="code hl_variable" href="structfat16__usage__count__callback__arg.html#a78692e17dfc842a4b944a25536eef604">cluster_count</a> = 0;</div>
<div class="line"><span class="lineno"> 1734</span>    count_arg.buffer_size = <span class="keyword">sizeof</span>(fat);</div>
<div class="line"><span class="lineno"> 1735</span> </div>
<div class="line"><span class="lineno"> 1736</span>    uint32_t fat_offset = fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#ad1287906321608dc2aa7741324dca9b5">header</a>.<a class="code hl_variable" href="structfat16__header__struct.html#a747d84164b4dc1f39c8081dc6f59432a">fat_offset</a>;</div>
<div class="line"><span class="lineno"> 1737</span>    uint32_t fat_size = fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#ad1287906321608dc2aa7741324dca9b5">header</a>.<a class="code hl_variable" href="structfat16__header__struct.html#ad96d9b98bad8bd19d767857f8bfe1870">fat_size</a>;</div>
<div class="line"><span class="lineno"> 1738</span>    <span class="keywordflow">while</span>(fat_size &gt; 0) {</div>
<div class="line"><span class="lineno"> 1739</span>        uint16_t length = UINT16_MAX - 1;</div>
<div class="line"><span class="lineno"> 1740</span>        <span class="keywordflow">if</span>(fat_size &lt; length)</div>
<div class="line"><span class="lineno"> 1741</span>            length = fat_size;</div>
<div class="line"><span class="lineno"> 1742</span> </div>
<div class="line"><span class="lineno"> 1743</span>        <span class="keywordflow">if</span>(!fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#a59ba2a9a21fc39f90358fe48baa5b923">partition</a>-&gt;device_read_interval(fat_offset,</div>
<div class="line"><span class="lineno"> 1744</span>            fat,</div>
<div class="line"><span class="lineno"> 1745</span>           <span class="keyword">sizeof</span>(fat),</div>
<div class="line"><span class="lineno"> 1746</span>           length,</div>
<div class="line"><span class="lineno"> 1747</span>           <a class="code hl_function" href="#ga7b21ea41c37e54f4edf690918f92fe8a">fat16_get_fs_free_callback</a>,</div>
<div class="line"><span class="lineno"> 1748</span>           &amp;count_arg</div>
<div class="line"><span class="lineno"> 1749</span>           )</div>
<div class="line"><span class="lineno"> 1750</span>           )</div>
<div class="line"><span class="lineno"> 1751</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1752</span> </div>
<div class="line"><span class="lineno"> 1753</span>        fat_offset += length;</div>
<div class="line"><span class="lineno"> 1754</span>        fat_size -= length;</div>
<div class="line"><span class="lineno"> 1755</span>    }</div>
<div class="line"><span class="lineno"> 1756</span> </div>
<div class="line"><span class="lineno"> 1757</span>    <span class="keywordflow">return</span> (uint32_t) count_arg.cluster_count * fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#ad1287906321608dc2aa7741324dca9b5">header</a>.<a class="code hl_variable" href="structfat16__header__struct.html#a724086964a23748a0585386c396b945e">cluster_size</a>;</div>
<div class="line"><span class="lineno"> 1758</span>}</div>
<div class="ttc" id="agroup__fat16__fs_html_ga7b21ea41c37e54f4edf690918f92fe8a"><div class="ttname"><a href="#ga7b21ea41c37e54f4edf690918f92fe8a">fat16_get_fs_free_callback</a></div><div class="ttdeci">static uint8_t fat16_get_fs_free_callback(uint8_t *buffer, uint32_t offset, void *p)</div><div class="ttdoc">Callback function used for counting free clusters.</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l01764">fat16.h:1764</a></div></div>
<div class="ttc" id="astructfat16__header__struct_html_a724086964a23748a0585386c396b945e"><div class="ttname"><a href="structfat16__header__struct.html#a724086964a23748a0585386c396b945e">fat16_header_struct::cluster_size</a></div><div class="ttdeci">uint16_t cluster_size</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00144">fat16_header.h:144</a></div></div>
<div class="ttc" id="astructfat16__usage__count__callback__arg_html"><div class="ttname"><a href="structfat16__usage__count__callback__arg.html">fat16_usage_count_callback_arg</a></div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00177">fat16_header.h:177</a></div></div>
<div class="ttc" id="astructfat16__usage__count__callback__arg_html_a78692e17dfc842a4b944a25536eef604"><div class="ttname"><a href="structfat16__usage__count__callback__arg.html#a78692e17dfc842a4b944a25536eef604">fat16_usage_count_callback_arg::cluster_count</a></div><div class="ttdeci">uint16_t cluster_count</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00178">fat16_header.h:178</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_ga2f8ff07cca44ecb6770b12a58b6cd8c7_cgraph.png" border="0" usemap="#agroup__fat16__fs_ga2f8ff07cca44ecb6770b12a58b6cd8c7_cgraph" alt=""/></div>
<map name="agroup__fat16__fs_ga2f8ff07cca44ecb6770b12a58b6cd8c7_cgraph" id="agroup__fat16__fs_ga2f8ff07cca44ecb6770b12a58b6cd8c7_cgraph">
<area shape="rect" title="Returns the amount of free storage capacity on the filesystem in bytes." alt="" coords="5,5,125,32"/>
<area shape="rect" href="group__fat16__fs.html#ga7b21ea41c37e54f4edf690918f92fe8a" title="Callback function used for counting free clusters." alt="" coords="173,5,347,32"/>
<area shape="poly" title=" " alt="" coords="125,16,157,16,157,21,125,21"/>
</map>
</div>

</div>
</div>
<a id="ga7b21ea41c37e54f4edf690918f92fe8a" name="ga7b21ea41c37e54f4edf690918f92fe8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7b21ea41c37e54f4edf690918f92fe8a">&#9670;&#160;</a></span>fat16_get_fs_free_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t fat16_get_fs_free_callback </td>
          <td>(</td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>offset</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>p</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback function used for counting free clusters. </p>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l01764">1764</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1765</span>{</div>
<div class="line"><span class="lineno"> 1766</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structfat16__usage__count__callback__arg.html">fat16_usage_count_callback_arg</a>* count_arg = (<span class="keyword">struct </span><a class="code hl_struct" href="structfat16__usage__count__callback__arg.html">fat16_usage_count_callback_arg</a>*) p;</div>
<div class="line"><span class="lineno"> 1767</span>    uint8_t <a class="code hl_variable" href="structfat16__usage__count__callback__arg.html#a46cafad933e3e3615c9dc30c848c0cb4">buffer_size</a> = count_arg-&gt;<a class="code hl_variable" href="structfat16__usage__count__callback__arg.html#a46cafad933e3e3615c9dc30c848c0cb4">buffer_size</a>;</div>
<div class="line"><span class="lineno"> 1768</span>    uint8_t i;</div>
<div class="line"><span class="lineno"> 1769</span>    <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code hl_variable" href="structfat16__usage__count__callback__arg.html#a46cafad933e3e3615c9dc30c848c0cb4">buffer_size</a>; i += 2)</div>
<div class="line"><span class="lineno"> 1770</span>    {</div>
<div class="line"><span class="lineno"> 1771</span>        <span class="keywordflow">if</span>((((uint16_t) buffer[1] &lt;&lt; 8) | ((uint16_t) buffer[0] &lt;&lt; 0)) == <a class="code hl_define" href="fat16_8h.html#a522cad018c7775d11293514bedf3354e">FAT16_CLUSTER_FREE</a>)</div>
<div class="line"><span class="lineno"> 1772</span>            ++(count_arg-&gt;<a class="code hl_variable" href="structfat16__usage__count__callback__arg.html#a78692e17dfc842a4b944a25536eef604">cluster_count</a>);</div>
<div class="line"><span class="lineno"> 1773</span> </div>
<div class="line"><span class="lineno"> 1774</span>        buffer += 2;</div>
<div class="line"><span class="lineno"> 1775</span>    }</div>
<div class="line"><span class="lineno"> 1776</span> </div>
<div class="line"><span class="lineno"> 1777</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 1778</span>}</div>
<div class="ttc" id="astructfat16__usage__count__callback__arg_html_a46cafad933e3e3615c9dc30c848c0cb4"><div class="ttname"><a href="structfat16__usage__count__callback__arg.html#a46cafad933e3e3615c9dc30c848c0cb4">fat16_usage_count_callback_arg::buffer_size</a></div><div class="ttdeci">uint8_t buffer_size</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00179">fat16_header.h:179</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_ga7b21ea41c37e54f4edf690918f92fe8a_icgraph.png" border="0" usemap="#agroup__fat16__fs_ga7b21ea41c37e54f4edf690918f92fe8a_icgraph" alt=""/></div>
<map name="agroup__fat16__fs_ga7b21ea41c37e54f4edf690918f92fe8a_icgraph" id="agroup__fat16__fs_ga7b21ea41c37e54f4edf690918f92fe8a_icgraph">
<area shape="rect" title="Callback function used for counting free clusters." alt="" coords="173,5,347,32"/>
<area shape="rect" href="group__fat16__fs.html#ga2f8ff07cca44ecb6770b12a58b6cd8c7" title="Returns the amount of free storage capacity on the filesystem in bytes." alt="" coords="5,5,125,32"/>
<area shape="poly" title=" " alt="" coords="157,21,125,21,125,16,157,16"/>
</map>
</div>

</div>
</div>
<a id="ga8af3c3535929e19b0039e07f1976cec7" name="ga8af3c3535929e19b0039e07f1976cec7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8af3c3535929e19b0039e07f1976cec7">&#9670;&#160;</a></span>fat16_get_fs_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t fat16_get_fs_size </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the amount of total storage capacity of the filesystem in bytes. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fs</td><td>The filesystem on which to operate. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, the filesystem size in bytes otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l01708">1708</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1709</span>{</div>
<div class="line"><span class="lineno"> 1710</span>    <span class="keywordflow">if</span>(!fs)</div>
<div class="line"><span class="lineno"> 1711</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1712</span> </div>
<div class="line"><span class="lineno"> 1713</span>    <span class="keywordflow">return</span> (fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#ad1287906321608dc2aa7741324dca9b5">header</a>.<a class="code hl_variable" href="structfat16__header__struct.html#ad96d9b98bad8bd19d767857f8bfe1870">fat_size</a> / 2 - 2) * fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#ad1287906321608dc2aa7741324dca9b5">header</a>.<a class="code hl_variable" href="structfat16__header__struct.html#a724086964a23748a0585386c396b945e">cluster_size</a>;</div>
<div class="line"><span class="lineno"> 1714</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ga80d15e5b202d3b8999f1c05d5da6be6a" name="ga80d15e5b202d3b8999f1c05d5da6be6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga80d15e5b202d3b8999f1c05d5da6be6a">&#9670;&#160;</a></span>fat16_get_next_cluster()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t fat16_get_next_cluster </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>cluster_num</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves the next following cluster of a given cluster. </p>
<p>Using the filesystem file allocation table, this function returns the number of the cluster containing the data directly following the data within the cluster with the given number.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fs</td><td>The filesystem for which to determine the next cluster. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cluster_num</td><td>The number of the cluster for which to determine its successor. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The wanted cluster number, or 0 on error. </dd></dl>
<ul>
<li></li>
</ul>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l00566">566</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  567</span>{</div>
<div class="line"><span class="lineno">  568</span>    <span class="keywordflow">if</span>(!fs || cluster_num &lt; 2)</div>
<div class="line"><span class="lineno">  569</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  570</span> </div>
<div class="line"><span class="lineno">  571</span>    <span class="comment">/* read appropriate fat entry */</span></div>
<div class="line"><span class="lineno">  572</span>    uint8_t fat_entry[2];</div>
<div class="line"><span class="lineno">  573</span>    <span class="keywordflow">if</span>(!fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#a59ba2a9a21fc39f90358fe48baa5b923">partition</a>-&gt;device_read(fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#ad1287906321608dc2aa7741324dca9b5">header</a>.<a class="code hl_variable" href="structfat16__header__struct.html#a747d84164b4dc1f39c8081dc6f59432a">fat_offset</a> + 2 * cluster_num, fat_entry, 2))</div>
<div class="line"><span class="lineno">  574</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  575</span> </div>
<div class="line"><span class="lineno">  576</span>    <span class="comment">/* determine next cluster from fat */</span></div>
<div class="line"><span class="lineno">  577</span>    cluster_num = ((uint16_t) fat_entry[0]) |</div>
<div class="line"><span class="lineno">  578</span>    ((uint16_t) fat_entry[1] &lt;&lt; 8);<span class="comment"></span></div>
<div class="line"><span class="lineno">  579</span><span class="comment">    ///*</span></div>
<div class="line"><span class="lineno">  580</span><span class="comment"></span>    <span class="keywordflow">if</span>(cluster_num == <a class="code hl_define" href="fat16_8h.html#a522cad018c7775d11293514bedf3354e">FAT16_CLUSTER_FREE</a> ||</div>
<div class="line"><span class="lineno">  581</span>        cluster_num == <a class="code hl_define" href="fat16_8h.html#a688fb1639a9f8fc728eb70df0c21d60b">FAT16_CLUSTER_BAD</a> ||</div>
<div class="line"><span class="lineno">  582</span>       (cluster_num &gt;= <a class="code hl_define" href="fat16_8h.html#adeead813e1f60ddb2dc9c8e7a7a25315">FAT16_CLUSTER_RESERVED_MIN</a> &amp;&amp; cluster_num &lt;= <a class="code hl_define" href="fat16_8h.html#a3331ed0dd68db4e4d8c5736c2469c2d0">FAT16_CLUSTER_RESERVED_MAX</a>) ||</div>
<div class="line"><span class="lineno">  583</span>       (cluster_num &gt;= <a class="code hl_define" href="fat16_8h.html#ac74094f0b780bf45067994830d50bac7">FAT16_CLUSTER_LAST_MIN</a> &amp;&amp; cluster_num &lt;= <a class="code hl_define" href="fat16_8h.html#a5d15f887f18577d14ff69ef3de9efa0a">FAT16_CLUSTER_LAST_MAX</a>))</div>
<div class="line"><span class="lineno">  584</span>    <span class="comment">//*/</span></div>
<div class="line"><span class="lineno">  585</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  586</span> </div>
<div class="line"><span class="lineno">  587</span>    <span class="keywordflow">return</span> cluster_num;</div>
<div class="line"><span class="lineno">  588</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_ga80d15e5b202d3b8999f1c05d5da6be6a_icgraph.png" border="0" usemap="#agroup__fat16__fs_ga80d15e5b202d3b8999f1c05d5da6be6a_icgraph" alt=""/></div>
<map name="agroup__fat16__fs_ga80d15e5b202d3b8999f1c05d5da6be6a_icgraph" id="agroup__fat16__fs_ga80d15e5b202d3b8999f1c05d5da6be6a_icgraph">
<area shape="rect" title="Retrieves the next following cluster of a given cluster." alt="" coords="717,142,869,169"/>
<area shape="rect" href="group__fat16__file.html#gaf8029e3ec633902d08e8204d13afc350" title="Creates a file." alt="" coords="172,16,287,42"/>
<area shape="poly" title=" " alt="" coords="771,132,727,85,699,62,668,45,618,28,567,17,514,11,462,9,366,12,288,21,287,16,365,7,462,3,515,6,568,12,620,23,670,40,702,58,731,81,775,128"/>
<area shape="rect" href="group__fat16__file.html#ga0af2ef3d690626a5640a334cefbb27a6" title="Reads data from a file." alt="" coords="535,54,639,81"/>
<area shape="poly" title=" " alt="" coords="753,137,668,95,636,84,638,79,670,91,755,132"/>
<area shape="rect" href="group__fat16__fs.html#gaefed7787ed7c6e2ce35f67c06aac36c7" title="Reads a directory entry of a given parent directory." alt="" coords="522,105,652,148"/>
<area shape="poly" title=" " alt="" coords="701,145,652,138,653,133,702,140"/>
<area shape="rect" href="group__fat16__file.html#ga23740742fa60ca148ef098caac7085c0" title="Resizes a file to have a specific size." alt="" coords="343,216,457,242"/>
<area shape="poly" title=" " alt="" coords="703,175,458,221,457,216,702,170"/>
<area shape="rect" href="group__fat16__fs.html#gad1da920ff8c1a617522bbfa21972e4c7" title="Frees a part of a cluster chain and correctly terminates the rest." alt="" coords="505,222,669,249"/>
<area shape="poly" title=" " alt="" coords="743,178,625,224,623,219,741,173"/>
<area shape="rect" href="group__fat16__file.html#ga4f0c785a47b1cf070839b5edec2c6f65" title="Writes data to a file." alt="" coords="534,273,640,300"/>
<area shape="poly" title=" " alt="" coords="771,182,726,223,670,263,642,276,640,271,667,259,723,219,767,178"/>
<area shape="rect" href="group__fat16__dir.html#ga73c8f0598e8224736b09644c48cf2970" title="Reads the next directory entry contained within a parent directory." alt="" coords="349,88,451,114"/>
<area shape="poly" title=" " alt="" coords="506,118,451,111,452,105,507,113"/>
<area shape="poly" title=" " alt="" coords="351,84,262,45,264,40,353,79"/>
<area shape="rect" href="group__fat16__file.html#ga0045fe378de2f7c52b528f985e1891a6" title="Retrieves the directory entry of a path." alt="" coords="164,73,295,116"/>
<area shape="poly" title=" " alt="" coords="333,101,295,100,296,94,333,96"/>
<area shape="rect" href="group__fat16.html#gaa25986550d47370f582118a9ef6eae24" title=" " alt="" coords="178,140,281,166"/>
<area shape="poly" title=" " alt="" coords="340,122,277,142,275,136,339,117"/>
<area shape="rect" href="group__fat16.html#gacdc9da639a6ccdac9847aaba559f9ef0" title=" " alt="" coords="5,140,116,166"/>
<area shape="poly" title=" " alt="" coords="163,156,116,156,116,150,163,150"/>
<area shape="rect" href="group__fat16__file.html#gaf1511fd1a5419d0828265566dc5d33e4" title="Repositions the read/write file offset." alt="" coords="176,216,283,242"/>
<area shape="poly" title=" " alt="" coords="327,232,283,232,283,226,327,226"/>
<area shape="poly" title=" " alt="" coords="489,235,458,234,458,228,490,230"/>
</map>
</div>

</div>
</div>
<a id="ga8927d70d35df0d10284286e2d5b66193" name="ga8927d70d35df0d10284286e2d5b66193"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8927d70d35df0d10284286e2d5b66193">&#9670;&#160;</a></span>fat16_interpret_dir_entry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t fat16_interpret_dir_entry </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfat16__dir__entry__struct.html">fat16_dir_entry_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>dir_entry</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *</td>          <td class="paramname"><span class="paramname"><em>raw_entry</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Interprets a raw directory entry and puts the contained information into the directory entry. </p>
<p>For a single file there may exist multiple directory entries. All except the last one are lfn entries, which contain parts of the long filename. The last directory entry is a traditional 8.3 style one. It contains all other information like size, cluster, date and time.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">dir_entry</td><td>The directory entry to fill. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">raw_entry</td><td>A pointer to 32 bytes of raw data. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, 1 on success and 2 if the directory entry is complete. </dd></dl>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l00408">408</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  409</span>{</div>
<div class="line"><span class="lineno">  410</span>    <span class="keywordflow">if</span>(!dir_entry || !raw_entry || !raw_entry[0])</div>
<div class="line"><span class="lineno">  411</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  412</span> </div>
<div class="line"><span class="lineno">  413</span>    <span class="keywordtype">char</span>* long_name = dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a9f625c7e8ac92bd268c62089f71480d0">long_name</a>;</div>
<div class="line"><span class="lineno">  414</span>    <span class="keywordflow">if</span>(raw_entry[11] == 0x0f)</div>
<div class="line"><span class="lineno">  415</span>    {</div>
<div class="line"><span class="lineno">  416</span>        uint16_t char_offset = ((raw_entry[0] &amp; 0x3f) - 1) * 13;</div>
<div class="line"><span class="lineno">  417</span> </div>
<div class="line"><span class="lineno">  418</span>        <span class="keywordflow">if</span>(char_offset + 12 &lt; <span class="keyword">sizeof</span>(dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a9f625c7e8ac92bd268c62089f71480d0">long_name</a>))</div>
<div class="line"><span class="lineno">  419</span>        {</div>
<div class="line"><span class="lineno">  420</span>            <span class="comment">/* Lfn supports unicode, but we do not, for now.</span></div>
<div class="line"><span class="lineno">  421</span><span class="comment">                                                 * So we assume pure ascii and read only every</span></div>
<div class="line"><span class="lineno">  422</span><span class="comment">                                                 * second byte.</span></div>
<div class="line"><span class="lineno">  423</span><span class="comment">                                                 */</span></div>
<div class="line"><span class="lineno">  424</span>            long_name[char_offset + 0] = raw_entry[1];</div>
<div class="line"><span class="lineno">  425</span>            long_name[char_offset + 1] = raw_entry[3];</div>
<div class="line"><span class="lineno">  426</span>            long_name[char_offset + 2] = raw_entry[5];</div>
<div class="line"><span class="lineno">  427</span>            long_name[char_offset + 3] = raw_entry[7];</div>
<div class="line"><span class="lineno">  428</span>            long_name[char_offset + 4] = raw_entry[9];</div>
<div class="line"><span class="lineno">  429</span>            long_name[char_offset + 5] = raw_entry[14];</div>
<div class="line"><span class="lineno">  430</span>            long_name[char_offset + 6] = raw_entry[16];</div>
<div class="line"><span class="lineno">  431</span>            long_name[char_offset + 7] = raw_entry[18];</div>
<div class="line"><span class="lineno">  432</span>            long_name[char_offset + 8] = raw_entry[20];</div>
<div class="line"><span class="lineno">  433</span>            long_name[char_offset + 9] = raw_entry[22];</div>
<div class="line"><span class="lineno">  434</span>            long_name[char_offset + 10] = raw_entry[24];</div>
<div class="line"><span class="lineno">  435</span>            long_name[char_offset + 11] = raw_entry[28];</div>
<div class="line"><span class="lineno">  436</span>            long_name[char_offset + 12] = raw_entry[30];</div>
<div class="line"><span class="lineno">  437</span>        }</div>
<div class="line"><span class="lineno">  438</span> </div>
<div class="line"><span class="lineno">  439</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  440</span>    }</div>
<div class="line"><span class="lineno">  441</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  442</span>    {</div>
<div class="line"><span class="lineno">  443</span>        <span class="comment">/* if we do not have a long name, take the short one */</span></div>
<div class="line"><span class="lineno">  444</span>        <span class="keywordflow">if</span>(long_name[0] == <span class="charliteral">&#39;\0&#39;</span>)</div>
<div class="line"><span class="lineno">  445</span>        {</div>
<div class="line"><span class="lineno">  446</span>            uint8_t i;</div>
<div class="line"><span class="lineno">  447</span>            <span class="keywordflow">for</span>(i = 0; i &lt; 8; ++i)</div>
<div class="line"><span class="lineno">  448</span>            {</div>
<div class="line"><span class="lineno">  449</span>                <span class="keywordflow">if</span>(raw_entry[i] == <span class="charliteral">&#39; &#39;</span>)</div>
<div class="line"><span class="lineno">  450</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  451</span>                long_name[i] = raw_entry[i];</div>
<div class="line"><span class="lineno">  452</span>            }</div>
<div class="line"><span class="lineno">  453</span>            <span class="keywordflow">if</span>(raw_entry[8] != <span class="charliteral">&#39; &#39;</span>)</div>
<div class="line"><span class="lineno">  454</span>            {</div>
<div class="line"><span class="lineno">  455</span>                long_name[i++] = <span class="charliteral">&#39;.&#39;</span>;</div>
<div class="line"><span class="lineno">  456</span> </div>
<div class="line"><span class="lineno">  457</span>                uint8_t j = 8;</div>
<div class="line"><span class="lineno">  458</span>                <span class="keywordflow">for</span>(; j &lt; 11; ++j)</div>
<div class="line"><span class="lineno">  459</span>                {</div>
<div class="line"><span class="lineno">  460</span>                    <span class="keywordflow">if</span>(raw_entry[j] != <span class="charliteral">&#39; &#39;</span>)</div>
<div class="line"><span class="lineno">  461</span>                    {</div>
<div class="line"><span class="lineno">  462</span>                        long_name[i++] = raw_entry[j];</div>
<div class="line"><span class="lineno">  463</span>                    }</div>
<div class="line"><span class="lineno">  464</span>                    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  465</span>                    {</div>
<div class="line"><span class="lineno">  466</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  467</span>                    }</div>
<div class="line"><span class="lineno">  468</span>                }</div>
<div class="line"><span class="lineno">  469</span>            }</div>
<div class="line"><span class="lineno">  470</span> </div>
<div class="line"><span class="lineno">  471</span>            long_name[i] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  472</span>        }</div>
<div class="line"><span class="lineno">  473</span> </div>
<div class="line"><span class="lineno">  474</span>        <span class="comment">/* extract properties of file and store them within the structure */</span></div>
<div class="line"><span class="lineno">  475</span>        dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a4e4c6084a1f0cf1e687ac68853dbd61e">attributes</a> = raw_entry[11];</div>
<div class="line"><span class="lineno">  476</span>        dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a8bbd1a1339bd035f916ffe91420cc8ad">cluster</a> = ((uint16_t) raw_entry[26]) |</div>
<div class="line"><span class="lineno">  477</span>        ((uint16_t) raw_entry[27] &lt;&lt; 8);</div>
<div class="line"><span class="lineno">  478</span>        dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a20dc3151ca3727aef4ad79a7735131ff">file_size</a> = ((uint32_t) raw_entry[28]) |</div>
<div class="line"><span class="lineno">  479</span>        ((uint32_t) raw_entry[29] &lt;&lt; 8) |</div>
<div class="line"><span class="lineno">  480</span>        ((uint32_t) raw_entry[30] &lt;&lt; 16) |</div>
<div class="line"><span class="lineno">  481</span>        ((uint32_t) raw_entry[31] &lt;&lt; 24);</div>
<div class="line"><span class="lineno">  482</span> </div>
<div class="line"><span class="lineno">  483</span>        <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno">  484</span>    }</div>
<div class="line"><span class="lineno">  485</span>}</div>
<div class="ttc" id="astructfat16__dir__entry__struct_html_a20dc3151ca3727aef4ad79a7735131ff"><div class="ttname"><a href="structfat16__dir__entry__struct.html#a20dc3151ca3727aef4ad79a7735131ff">fat16_dir_entry_struct::file_size</a></div><div class="ttdeci">uint32_t file_size</div><div class="ttdoc">The file's size.</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00079">fat16_header.h:79</a></div></div>
<div class="ttc" id="astructfat16__dir__entry__struct_html_a4e4c6084a1f0cf1e687ac68853dbd61e"><div class="ttname"><a href="structfat16__dir__entry__struct.html#a4e4c6084a1f0cf1e687ac68853dbd61e">fat16_dir_entry_struct::attributes</a></div><div class="ttdeci">uint8_t attributes</div><div class="ttdoc">The file's attributes.</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00069">fat16_header.h:69</a></div></div>
<div class="ttc" id="astructfat16__dir__entry__struct_html_a8bbd1a1339bd035f916ffe91420cc8ad"><div class="ttname"><a href="structfat16__dir__entry__struct.html#a8bbd1a1339bd035f916ffe91420cc8ad">fat16_dir_entry_struct::cluster</a></div><div class="ttdeci">uint16_t cluster</div><div class="ttdoc">The time the file was last modified.</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00077">fat16_header.h:77</a></div></div>
<div class="ttc" id="astructfat16__dir__entry__struct_html_a9f625c7e8ac92bd268c62089f71480d0"><div class="ttname"><a href="structfat16__dir__entry__struct.html#a9f625c7e8ac92bd268c62089f71480d0">fat16_dir_entry_struct::long_name</a></div><div class="ttdeci">char long_name[32]</div><div class="ttdoc">The file's name, truncated to 31 characters.</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00067">fat16_header.h:67</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_ga8927d70d35df0d10284286e2d5b66193_icgraph.png" border="0" usemap="#agroup__fat16__fs_ga8927d70d35df0d10284286e2d5b66193_icgraph" alt=""/></div>
<map name="agroup__fat16__fs_ga8927d70d35df0d10284286e2d5b66193_icgraph" id="agroup__fat16__fs_ga8927d70d35df0d10284286e2d5b66193_icgraph">
<area shape="rect" title="Interprets a raw directory entry and puts the contained information into the directory entry." alt="" coords="859,56,983,99"/>
<area shape="rect" href="group__fat16__fs.html#ga64666f9e44e49273d33ed01058ff5fac" title="Callback function for reading a directory entry." alt="" coords="673,56,811,99"/>
<area shape="poly" title=" " alt="" coords="843,80,812,80,812,75,843,75"/>
<area shape="rect" href="group__fat16__fs.html#ga2e0cd2d601f164cec718052204d257b5" title="Reads a directory entry of the root directory." alt="" coords="493,23,625,65"/>
<area shape="poly" title=" " alt="" coords="657,65,624,59,625,53,658,59"/>
<area shape="rect" href="group__fat16__fs.html#gaefed7787ed7c6e2ce35f67c06aac36c7" title="Reads a directory entry of a given parent directory." alt="" coords="494,89,624,132"/>
<area shape="poly" title=" " alt="" coords="658,95,625,101,624,96,657,90"/>
<area shape="rect" href="group__fat16__dir.html#ga73c8f0598e8224736b09644c48cf2970" title="Reads the next directory entry contained within a parent directory." alt="" coords="343,64,445,91"/>
<area shape="poly" title=" " alt="" coords="479,63,446,70,445,64,478,58"/>
<area shape="rect" href="group__fat16__file.html#gaf8029e3ec633902d08e8204d13afc350" title="Creates a file." alt="" coords="172,5,287,32"/>
<area shape="poly" title=" " alt="" coords="340,61,268,35,270,30,341,56"/>
<area shape="rect" href="group__fat16__file.html#ga0045fe378de2f7c52b528f985e1891a6" title="Retrieves the directory entry of a path." alt="" coords="164,56,295,99"/>
<area shape="poly" title=" " alt="" coords="327,80,295,80,295,75,327,75"/>
<area shape="rect" href="group__fat16.html#gaa25986550d47370f582118a9ef6eae24" title=" " alt="" coords="178,123,281,149"/>
<area shape="poly" title=" " alt="" coords="341,99,270,125,268,120,340,94"/>
<area shape="rect" href="group__fat16.html#gacdc9da639a6ccdac9847aaba559f9ef0" title=" " alt="" coords="5,123,116,149"/>
<area shape="poly" title=" " alt="" coords="163,139,116,139,116,133,163,133"/>
<area shape="poly" title=" " alt="" coords="478,97,445,90,446,85,479,92"/>
</map>
</div>

</div>
</div>
<a id="ga554cb707673a9db9d6a668af97600d04" name="ga554cb707673a9db9d6a668af97600d04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga554cb707673a9db9d6a668af97600d04">&#9670;&#160;</a></span>fat16_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fat16_open </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct partition_struct *</td>          <td class="paramname"><span class="paramname"><em>partition</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Opens a FAT16 filesystem. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">partition</td><td>Discriptor of partition on which the filesystem resides. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on error, a FAT16 filesystem descriptor on success. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#ga554cb707673a9db9d6a668af97600d04" title="Opens a FAT16 filesystem.">fat16_open</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l00098">98</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   98</span>                                                                               {</div>
<div class="line"><span class="lineno">   99</span>    <span class="keywordflow">if</span>(!partition ||</div>
<div class="line"><span class="lineno">  100</span>        #<span class="keywordflow">if</span> FAT16_WRITE_SUPPORT</div>
<div class="line"><span class="lineno">  101</span>        !partition-&gt;device_write</div>
<div class="line"><span class="lineno">  102</span>       #<span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  103</span>        0</div>
<div class="line"><span class="lineno">  104</span>       #endif</div>
<div class="line"><span class="lineno">  105</span>       )</div>
<div class="line"><span class="lineno">  106</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  107</span> </div>
<div class="line"><span class="lineno">  108</span>    <span class="keywordflow">if</span>(!fs) <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno">  109</span>    </div>
<div class="line"><span class="lineno">  110</span>    memset(fs, 0, <span class="keyword">sizeof</span>(*fs));</div>
<div class="line"><span class="lineno">  111</span> </div>
<div class="line"><span class="lineno">  112</span>    fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#a59ba2a9a21fc39f90358fe48baa5b923">partition</a> = partition;</div>
<div class="line"><span class="lineno">  113</span>    <span class="keywordflow">if</span>(!<a class="code hl_function" href="#ga4ae970c89e2d74d71eb313f104db7e27">fat16_read_header</a>(fs)) <span class="keywordflow">return</span> -3;</div>
<div class="line"><span class="lineno">  114</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  115</span>}</div>
<div class="ttc" id="agroup__fat16__fs_html_ga4ae970c89e2d74d71eb313f104db7e27"><div class="ttname"><a href="#ga4ae970c89e2d74d71eb313f104db7e27">fat16_read_header</a></div><div class="ttdeci">static uint8_t fat16_read_header(struct fat16_fs_struct *fs)</div><div class="ttdoc">Reads and parses the header of a FAT16 filesystem.</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l00139">fat16.h:139</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_ga554cb707673a9db9d6a668af97600d04_cgraph.png" border="0" usemap="#agroup__fat16__fs_ga554cb707673a9db9d6a668af97600d04_cgraph" alt=""/></div>
<map name="agroup__fat16__fs_ga554cb707673a9db9d6a668af97600d04_cgraph" id="agroup__fat16__fs_ga554cb707673a9db9d6a668af97600d04_cgraph">
<area shape="rect" title="Opens a FAT16 filesystem." alt="" coords="5,5,90,32"/>
<area shape="rect" href="group__fat16__fs.html#ga4ae970c89e2d74d71eb313f104db7e27" title="Reads and parses the header of a FAT16 filesystem." alt="" coords="138,5,265,32"/>
<area shape="poly" title=" " alt="" coords="90,16,122,16,122,21,90,21"/>
</map>
</div>

</div>
</div>
<a id="ga4ae970c89e2d74d71eb313f104db7e27" name="ga4ae970c89e2d74d71eb313f104db7e27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4ae970c89e2d74d71eb313f104db7e27">&#9670;&#160;</a></span>fat16_read_header()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t fat16_read_header </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reads and parses the header of a FAT16 filesystem. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">fs</td><td>The filesystem for which to parse the header. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, 1 on success. </dd></dl>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l00139">139</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  139</span>                                                      {</div>
<div class="line"><span class="lineno">  140</span>    <span class="keywordflow">if</span>(!fs) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>    <span class="keyword">struct </span>partition_struct* partition = fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#a59ba2a9a21fc39f90358fe48baa5b923">partition</a>;</div>
<div class="line"><span class="lineno">  143</span>    <span class="keywordflow">if</span>(!partition) {</div>
<div class="line"><span class="lineno">  144</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  145</span>    }</div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>    <span class="comment">/* read fat parameters */</span></div>
<div class="line"><span class="lineno">  148</span>    uint8_t buffer[25];</div>
<div class="line"><span class="lineno">  149</span>    uint32_t partition_offset = partition-&gt;offset * 512;</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span>    <span class="keywordflow">if</span>(!partition-&gt;device_read(partition_offset + 0x0b, buffer, <span class="keyword">sizeof</span>(buffer)))</div>
<div class="line"><span class="lineno">  152</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  153</span> </div>
<div class="line"><span class="lineno">  154</span>    uint16_t bytes_per_sector = ((uint16_t) buffer[0x00]) |</div>
<div class="line"><span class="lineno">  155</span>    ((uint16_t) buffer[0x01] &lt;&lt; 8);</div>
<div class="line"><span class="lineno">  156</span>    uint8_t sectors_per_cluster = buffer[0x02];</div>
<div class="line"><span class="lineno">  157</span>    uint16_t reserved_sectors = ((uint16_t) buffer[0x03]) |</div>
<div class="line"><span class="lineno">  158</span>    ((uint16_t) buffer[0x04] &lt;&lt; 8);</div>
<div class="line"><span class="lineno">  159</span>    uint8_t fat_copies = buffer[0x05];</div>
<div class="line"><span class="lineno">  160</span>    uint16_t max_root_entries = ((uint16_t) buffer[0x06]) |</div>
<div class="line"><span class="lineno">  161</span>    ((uint16_t) buffer[0x07] &lt;&lt; 8);</div>
<div class="line"><span class="lineno">  162</span>    uint16_t sector_count_16 = ((uint16_t) buffer[0x08]) |</div>
<div class="line"><span class="lineno">  163</span>    ((uint16_t) buffer[0x09] &lt;&lt; 8);</div>
<div class="line"><span class="lineno">  164</span>    uint16_t sectors_per_fat = ((uint16_t) buffer[0x0b]) |</div>
<div class="line"><span class="lineno">  165</span>    ((uint16_t) buffer[0x0c] &lt;&lt; 8);</div>
<div class="line"><span class="lineno">  166</span>    uint32_t sector_count = ((uint32_t) buffer[0x15]) |</div>
<div class="line"><span class="lineno">  167</span>    ((uint32_t) buffer[0x16] &lt;&lt; 8) |</div>
<div class="line"><span class="lineno">  168</span>    ((uint32_t) buffer[0x17] &lt;&lt; 16) |</div>
<div class="line"><span class="lineno">  169</span>    ((uint32_t) buffer[0x18] &lt;&lt; 24);</div>
<div class="line"><span class="lineno">  170</span> </div>
<div class="line"><span class="lineno">  171</span>    <span class="keywordflow">if</span>(sectors_per_fat == 0)</div>
<div class="line"><span class="lineno">  172</span>    <span class="comment">/* this is not a FAT16 */</span></div>
<div class="line"><span class="lineno">  173</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  174</span> </div>
<div class="line"><span class="lineno">  175</span>    <span class="keywordflow">if</span>(sector_count == 0)</div>
<div class="line"><span class="lineno">  176</span>    {</div>
<div class="line"><span class="lineno">  177</span>        <span class="keywordflow">if</span>(sector_count_16 == 0)</div>
<div class="line"><span class="lineno">  178</span>    <span class="comment">/* illegal volume size */</span></div>
<div class="line"><span class="lineno">  179</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  180</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  181</span>            sector_count = sector_count_16;</div>
<div class="line"><span class="lineno">  182</span>    }</div>
<div class="line"><span class="lineno">  183</span> </div>
<div class="line"><span class="lineno">  184</span>    <span class="comment">/* ensure we really have a FAT16 fs here */</span></div>
<div class="line"><span class="lineno">  185</span>    uint32_t data_sector_count = sector_count</div>
<div class="line"><span class="lineno">  186</span>    - reserved_sectors</div>
<div class="line"><span class="lineno">  187</span>    - (uint32_t) sectors_per_fat * fat_copies</div>
<div class="line"><span class="lineno">  188</span>    - ((max_root_entries * 32 + bytes_per_sector - 1) / bytes_per_sector);</div>
<div class="line"><span class="lineno">  189</span>    uint32_t data_cluster_count = data_sector_count / sectors_per_cluster;</div>
<div class="line"><span class="lineno">  190</span>    <span class="keywordflow">if</span>(data_cluster_count &lt; 4085 || data_cluster_count &gt;= 65525)</div>
<div class="line"><span class="lineno">  191</span>    <span class="comment">/* this is not a FAT16 */</span></div>
<div class="line"><span class="lineno">  192</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  193</span> </div>
<div class="line"><span class="lineno">  194</span>    partition-&gt;type = PARTITION_TYPE_FAT16;</div>
<div class="line"><span class="lineno">  195</span> </div>
<div class="line"><span class="lineno">  196</span>    <span class="comment">/* fill header information */</span></div>
<div class="line"><span class="lineno">  197</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structfat16__header__struct.html">fat16_header_struct</a>* header = &amp;fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#ad1287906321608dc2aa7741324dca9b5">header</a>;</div>
<div class="line"><span class="lineno">  198</span>    memset(header, 0, <span class="keyword">sizeof</span>(*header));</div>
<div class="line"><span class="lineno">  199</span> </div>
<div class="line"><span class="lineno">  200</span>    header-&gt;<a class="code hl_variable" href="structfat16__header__struct.html#a5f36578ebe841a884821caa7b1092b54">size</a> = sector_count * bytes_per_sector;</div>
<div class="line"><span class="lineno">  201</span> </div>
<div class="line"><span class="lineno">  202</span>    header-&gt;<a class="code hl_variable" href="structfat16__header__struct.html#a747d84164b4dc1f39c8081dc6f59432a">fat_offset</a> = <span class="comment">/* jump to partition */</span></div>
<div class="line"><span class="lineno">  203</span>    partition_offset +</div>
<div class="line"><span class="lineno">  204</span>    <span class="comment">/* jump to fat */</span></div>
<div class="line"><span class="lineno">  205</span>    (uint32_t) reserved_sectors * bytes_per_sector;</div>
<div class="line"><span class="lineno">  206</span>    header-&gt;<a class="code hl_variable" href="structfat16__header__struct.html#ad96d9b98bad8bd19d767857f8bfe1870">fat_size</a> = (data_cluster_count + 2) * 2;</div>
<div class="line"><span class="lineno">  207</span> </div>
<div class="line"><span class="lineno">  208</span>    header-&gt;<a class="code hl_variable" href="structfat16__header__struct.html#a6335a85f6d40bca48f2feefebf9c7d17">sector_size</a> = bytes_per_sector;</div>
<div class="line"><span class="lineno">  209</span>    header-&gt;<a class="code hl_variable" href="structfat16__header__struct.html#a724086964a23748a0585386c396b945e">cluster_size</a> = (uint32_t) bytes_per_sector * sectors_per_cluster;</div>
<div class="line"><span class="lineno">  210</span> </div>
<div class="line"><span class="lineno">  211</span>    header-&gt;<a class="code hl_variable" href="structfat16__header__struct.html#a1e631311b2e65eef7f022196ec16aa18">root_dir_offset</a> = <span class="comment">/* jump to fats */</span></div>
<div class="line"><span class="lineno">  212</span>    header-&gt;<a class="code hl_variable" href="structfat16__header__struct.html#a747d84164b4dc1f39c8081dc6f59432a">fat_offset</a> +</div>
<div class="line"><span class="lineno">  213</span>    <span class="comment">/* jump to root directory entries */</span></div>
<div class="line"><span class="lineno">  214</span>    (uint32_t) fat_copies * sectors_per_fat * bytes_per_sector;</div>
<div class="line"><span class="lineno">  215</span> </div>
<div class="line"><span class="lineno">  216</span>    header-&gt;<a class="code hl_variable" href="structfat16__header__struct.html#a877f23793a9b6cf783f71bf31fb18bb1">cluster_zero_offset</a> = <span class="comment">/* jump to root directory entries */</span></div>
<div class="line"><span class="lineno">  217</span>    header-&gt;<a class="code hl_variable" href="structfat16__header__struct.html#a1e631311b2e65eef7f022196ec16aa18">root_dir_offset</a> +</div>
<div class="line"><span class="lineno">  218</span>    <span class="comment">/* skip root directory entries */</span></div>
<div class="line"><span class="lineno">  219</span>    (uint32_t) max_root_entries * 32;</div>
<div class="line"><span class="lineno">  220</span> </div>
<div class="line"><span class="lineno">  221</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  222</span>}</div>
<div class="ttc" id="astructfat16__header__struct_html"><div class="ttname"><a href="structfat16__header__struct.html">fat16_header_struct</a></div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00137">fat16_header.h:137</a></div></div>
<div class="ttc" id="astructfat16__header__struct_html_a1e631311b2e65eef7f022196ec16aa18"><div class="ttname"><a href="structfat16__header__struct.html#a1e631311b2e65eef7f022196ec16aa18">fat16_header_struct::root_dir_offset</a></div><div class="ttdeci">uint32_t root_dir_offset</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00146">fat16_header.h:146</a></div></div>
<div class="ttc" id="astructfat16__header__struct_html_a5f36578ebe841a884821caa7b1092b54"><div class="ttname"><a href="structfat16__header__struct.html#a5f36578ebe841a884821caa7b1092b54">fat16_header_struct::size</a></div><div class="ttdeci">uint32_t size</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00138">fat16_header.h:138</a></div></div>
<div class="ttc" id="astructfat16__header__struct_html_a6335a85f6d40bca48f2feefebf9c7d17"><div class="ttname"><a href="structfat16__header__struct.html#a6335a85f6d40bca48f2feefebf9c7d17">fat16_header_struct::sector_size</a></div><div class="ttdeci">uint16_t sector_size</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00143">fat16_header.h:143</a></div></div>
<div class="ttc" id="astructfat16__header__struct_html_a877f23793a9b6cf783f71bf31fb18bb1"><div class="ttname"><a href="structfat16__header__struct.html#a877f23793a9b6cf783f71bf31fb18bb1">fat16_header_struct::cluster_zero_offset</a></div><div class="ttdeci">uint32_t cluster_zero_offset</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00148">fat16_header.h:148</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_ga4ae970c89e2d74d71eb313f104db7e27_icgraph.png" border="0" usemap="#agroup__fat16__fs_ga4ae970c89e2d74d71eb313f104db7e27_icgraph" alt=""/></div>
<map name="agroup__fat16__fs_ga4ae970c89e2d74d71eb313f104db7e27_icgraph" id="agroup__fat16__fs_ga4ae970c89e2d74d71eb313f104db7e27_icgraph">
<area shape="rect" title="Reads and parses the header of a FAT16 filesystem." alt="" coords="138,5,265,32"/>
<area shape="rect" href="group__fat16__fs.html#ga554cb707673a9db9d6a668af97600d04" title="Opens a FAT16 filesystem." alt="" coords="5,5,90,32"/>
<area shape="poly" title=" " alt="" coords="122,21,90,21,90,16,122,16"/>
</map>
</div>

</div>
</div>
<a id="ga2e0cd2d601f164cec718052204d257b5" name="ga2e0cd2d601f164cec718052204d257b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2e0cd2d601f164cec718052204d257b5">&#9670;&#160;</a></span>fat16_read_root_dir_entry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t fat16_read_root_dir_entry </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>entry_num</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structfat16__dir__entry__struct.html">fat16_dir_entry_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>dir_entry</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reads a directory entry of the root directory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fs</td><td>Descriptor of file system to use. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">entry_num</td><td>The index of the directory entry to read. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">dir_entry</td><td>Directory entry descriptor which will get filled. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, 1 on success </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#gaefed7787ed7c6e2ce35f67c06aac36c7" title="Reads a directory entry of a given parent directory.">fat16_read_sub_dir_entry</a>, fat16_read_dir_entry_by_path </dd></dl>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l00234">234</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  234</span>                                                                                                                                  {</div>
<div class="line"><span class="lineno">  235</span>    <span class="keywordflow">if</span>(!fs || !dir_entry) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  236</span> </div>
<div class="line"><span class="lineno">  237</span>    <span class="comment">/* we read from the root directory entry */</span></div>
<div class="line"><span class="lineno">  238</span>    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code hl_struct" href="structfat16__header__struct.html">fat16_header_struct</a>* header = &amp;fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#ad1287906321608dc2aa7741324dca9b5">header</a>;</div>
<div class="line"><span class="lineno">  239</span>    device_read_interval_t device_read_interval = fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#a59ba2a9a21fc39f90358fe48baa5b923">partition</a>-&gt;device_read_interval;</div>
<div class="line"><span class="lineno">  240</span>    uint8_t buffer[32];</div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>    <span class="comment">/* seek to the n-th entry */</span></div>
<div class="line"><span class="lineno">  243</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structfat16__read__callback__arg.html">fat16_read_callback_arg</a> arg;</div>
<div class="line"><span class="lineno">  244</span>    memset(&amp;arg, 0, <span class="keyword">sizeof</span>(arg));</div>
<div class="line"><span class="lineno">  245</span>    arg.entry_num = <a class="code hl_variable" href="structfat16__read__callback__arg.html#a3bd3955143c97975d82d1ac2f6f45b37">entry_num</a>;</div>
<div class="line"><span class="lineno">  246</span>    <span class="keywordflow">if</span>(!device_read_interval(header-&gt;<a class="code hl_variable" href="structfat16__header__struct.html#a1e631311b2e65eef7f022196ec16aa18">root_dir_offset</a>,</div>
<div class="line"><span class="lineno">  247</span>        buffer,</div>
<div class="line"><span class="lineno">  248</span>       <span class="keyword">sizeof</span>(buffer),</div>
<div class="line"><span class="lineno">  249</span>       header-&gt;<a class="code hl_variable" href="structfat16__header__struct.html#a877f23793a9b6cf783f71bf31fb18bb1">cluster_zero_offset</a> - header-&gt;<a class="code hl_variable" href="structfat16__header__struct.html#a1e631311b2e65eef7f022196ec16aa18">root_dir_offset</a>,</div>
<div class="line"><span class="lineno">  250</span>       <a class="code hl_function" href="#ga6f277c11fa202ecfadca3635221f70a4">fat16_dir_entry_seek_callback</a>,</div>
<div class="line"><span class="lineno">  251</span>       &amp;arg) ||</div>
<div class="line"><span class="lineno">  252</span>       arg.entry_offset == 0</div>
<div class="line"><span class="lineno">  253</span>       )</div>
<div class="line"><span class="lineno">  254</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  255</span> </div>
<div class="line"><span class="lineno">  256</span>    <span class="comment">/* read entry */</span></div>
<div class="line"><span class="lineno">  257</span>    memset(dir_entry, 0, <span class="keyword">sizeof</span>(*dir_entry));</div>
<div class="line"><span class="lineno">  258</span>    <span class="keywordflow">if</span>(!device_read_interval(arg.entry_offset,</div>
<div class="line"><span class="lineno">  259</span>        buffer,</div>
<div class="line"><span class="lineno">  260</span>       <span class="keyword">sizeof</span>(buffer),</div>
<div class="line"><span class="lineno">  261</span>       arg.byte_count,</div>
<div class="line"><span class="lineno">  262</span>       <a class="code hl_function" href="#ga64666f9e44e49273d33ed01058ff5fac">fat16_dir_entry_read_callback</a>,</div>
<div class="line"><span class="lineno">  263</span>       dir_entry))</div>
<div class="line"><span class="lineno">  264</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  265</span> </div>
<div class="line"><span class="lineno">  266</span>    <span class="keywordflow">return</span> dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a9f625c7e8ac92bd268c62089f71480d0">long_name</a>[0] != <span class="charliteral">&#39;\0&#39;</span> ? 1 : 0;</div>
<div class="line"><span class="lineno">  267</span>}</div>
<div class="ttc" id="agroup__fat16__fs_html_ga64666f9e44e49273d33ed01058ff5fac"><div class="ttname"><a href="#ga64666f9e44e49273d33ed01058ff5fac">fat16_dir_entry_read_callback</a></div><div class="ttdeci">static uint8_t fat16_dir_entry_read_callback(uint8_t *buffer, uint32_t offset, void *p)</div><div class="ttdoc">Callback function for reading a directory entry.</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l00368">fat16.h:368</a></div></div>
<div class="ttc" id="agroup__fat16__fs_html_ga6f277c11fa202ecfadca3635221f70a4"><div class="ttname"><a href="#ga6f277c11fa202ecfadca3635221f70a4">fat16_dir_entry_seek_callback</a></div><div class="ttdeci">static uint8_t fat16_dir_entry_seek_callback(uint8_t *buffer, uint32_t offset, void *p)</div><div class="ttdoc">Callback function for seeking through subdirectory entries.</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l00340">fat16.h:340</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_ga2e0cd2d601f164cec718052204d257b5_cgraph.png" border="0" usemap="#agroup__fat16__fs_ga2e0cd2d601f164cec718052204d257b5_cgraph" alt=""/></div>
<map name="agroup__fat16__fs_ga2e0cd2d601f164cec718052204d257b5_cgraph" id="agroup__fat16__fs_ga2e0cd2d601f164cec718052204d257b5_cgraph">
<area shape="rect" title="Reads a directory entry of the root directory." alt="" coords="5,39,137,81"/>
<area shape="rect" href="group__fat16__fs.html#ga64666f9e44e49273d33ed01058ff5fac" title="Callback function for reading a directory entry." alt="" coords="186,5,325,48"/>
<area shape="poly" title=" " alt="" coords="136,46,171,39,172,45,137,51"/>
<area shape="rect" href="group__fat16__fs.html#ga6f277c11fa202ecfadca3635221f70a4" title="Callback function for seeking through subdirectory entries." alt="" coords="185,72,326,115"/>
<area shape="poly" title=" " alt="" coords="137,69,170,75,169,80,136,74"/>
<area shape="rect" href="group__fat16__fs.html#ga8927d70d35df0d10284286e2d5b66193" title="Interprets a raw directory entry and puts the contained information into the directory entry." alt="" coords="374,5,498,48"/>
<area shape="poly" title=" " alt="" coords="325,24,358,24,358,29,325,29"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_ga2e0cd2d601f164cec718052204d257b5_icgraph.png" border="0" usemap="#agroup__fat16__fs_ga2e0cd2d601f164cec718052204d257b5_icgraph" alt=""/></div>
<map name="agroup__fat16__fs_ga2e0cd2d601f164cec718052204d257b5_icgraph" id="agroup__fat16__fs_ga2e0cd2d601f164cec718052204d257b5_icgraph">
<area shape="rect" title="Reads a directory entry of the root directory." alt="" coords="493,56,625,99"/>
<area shape="rect" href="group__fat16__dir.html#ga73c8f0598e8224736b09644c48cf2970" title="Reads the next directory entry contained within a parent directory." alt="" coords="343,64,445,91"/>
<area shape="poly" title=" " alt="" coords="478,80,446,80,446,75,478,75"/>
<area shape="rect" href="group__fat16__file.html#gaf8029e3ec633902d08e8204d13afc350" title="Creates a file." alt="" coords="172,5,287,32"/>
<area shape="poly" title=" " alt="" coords="340,61,268,35,270,30,341,56"/>
<area shape="rect" href="group__fat16__file.html#ga0045fe378de2f7c52b528f985e1891a6" title="Retrieves the directory entry of a path." alt="" coords="164,56,295,99"/>
<area shape="poly" title=" " alt="" coords="327,80,295,80,295,75,327,75"/>
<area shape="rect" href="group__fat16.html#gaa25986550d47370f582118a9ef6eae24" title=" " alt="" coords="178,123,281,149"/>
<area shape="poly" title=" " alt="" coords="341,99,270,125,268,120,340,94"/>
<area shape="rect" href="group__fat16.html#gacdc9da639a6ccdac9847aaba559f9ef0" title=" " alt="" coords="5,123,116,149"/>
<area shape="poly" title=" " alt="" coords="163,139,116,139,116,133,163,133"/>
</map>
</div>

</div>
</div>
<a id="gaefed7787ed7c6e2ce35f67c06aac36c7" name="gaefed7787ed7c6e2ce35f67c06aac36c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaefed7787ed7c6e2ce35f67c06aac36c7">&#9670;&#160;</a></span>fat16_read_sub_dir_entry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t fat16_read_sub_dir_entry </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>entry_num</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structfat16__dir__entry__struct.html">fat16_dir_entry_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>parent</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structfat16__dir__entry__struct.html">fat16_dir_entry_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>dir_entry</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reads a directory entry of a given parent directory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fs</td><td>Descriptor of file system to use. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">entry_num</td><td>The index of the directory entry to read. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">parent</td><td>Directory entry descriptor in which to read directory entry. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">dir_entry</td><td>Directory entry descriptor which will get filled. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, 1 on success </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#ga2e0cd2d601f164cec718052204d257b5" title="Reads a directory entry of the root directory.">fat16_read_root_dir_entry</a>, fat16_read_dir_entry_by_path </dd></dl>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l00280">280</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  281</span>{</div>
<div class="line"><span class="lineno">  282</span>    <span class="keywordflow">if</span>(!fs || !parent || !dir_entry)</div>
<div class="line"><span class="lineno">  283</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  284</span> </div>
<div class="line"><span class="lineno">  285</span>    <span class="comment">/* we are in a parent directory and want to search within its directory entry table */</span></div>
<div class="line"><span class="lineno">  286</span>    <span class="keywordflow">if</span>(!(parent-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a4e4c6084a1f0cf1e687ac68853dbd61e">attributes</a> &amp; <a class="code hl_define" href="group__fat16__file.html#gaafdb0e859960ff33b11b6c55b3188274">FAT16_ATTRIB_DIR</a>))</div>
<div class="line"><span class="lineno">  287</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  288</span> </div>
<div class="line"><span class="lineno">  289</span>    <span class="comment">/* loop through all clusters of the directory */</span></div>
<div class="line"><span class="lineno">  290</span>    uint8_t buffer[32];</div>
<div class="line"><span class="lineno">  291</span>    uint32_t cluster_offset;</div>
<div class="line"><span class="lineno">  292</span>    uint16_t cluster_size = fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#ad1287906321608dc2aa7741324dca9b5">header</a>.<a class="code hl_variable" href="structfat16__header__struct.html#a724086964a23748a0585386c396b945e">cluster_size</a>;</div>
<div class="line"><span class="lineno">  293</span>    uint16_t cluster_num = parent-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a8bbd1a1339bd035f916ffe91420cc8ad">cluster</a>;</div>
<div class="line"><span class="lineno">  294</span>    <span class="keyword">struct </span><a class="code hl_struct" href="structfat16__read__callback__arg.html">fat16_read_callback_arg</a> arg;</div>
<div class="line"><span class="lineno">  295</span> </div>
<div class="line"><span class="lineno">  296</span>    <span class="keywordflow">while</span>(1)</div>
<div class="line"><span class="lineno">  297</span>    {</div>
<div class="line"><span class="lineno">  298</span>        <span class="comment">/* calculate new cluster offset */</span></div>
<div class="line"><span class="lineno">  299</span>        cluster_offset = fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#ad1287906321608dc2aa7741324dca9b5">header</a>.<a class="code hl_variable" href="structfat16__header__struct.html#a877f23793a9b6cf783f71bf31fb18bb1">cluster_zero_offset</a> + (uint32_t) (cluster_num - 2) * cluster_size;</div>
<div class="line"><span class="lineno">  300</span> </div>
<div class="line"><span class="lineno">  301</span>        <span class="comment">/* seek to the n-th entry */</span></div>
<div class="line"><span class="lineno">  302</span>        memset(&amp;arg, 0, <span class="keyword">sizeof</span>(arg));</div>
<div class="line"><span class="lineno">  303</span>        arg.entry_num = <a class="code hl_variable" href="structfat16__read__callback__arg.html#a3bd3955143c97975d82d1ac2f6f45b37">entry_num</a>;</div>
<div class="line"><span class="lineno">  304</span>        <span class="keywordflow">if</span>(!fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#a59ba2a9a21fc39f90358fe48baa5b923">partition</a>-&gt;device_read_interval(cluster_offset,</div>
<div class="line"><span class="lineno">  305</span>            buffer,</div>
<div class="line"><span class="lineno">  306</span>           <span class="keyword">sizeof</span>(buffer),</div>
<div class="line"><span class="lineno">  307</span>           cluster_size,</div>
<div class="line"><span class="lineno">  308</span>           <a class="code hl_function" href="#ga6f277c11fa202ecfadca3635221f70a4">fat16_dir_entry_seek_callback</a>,</div>
<div class="line"><span class="lineno">  309</span>           &amp;arg)</div>
<div class="line"><span class="lineno">  310</span>           )</div>
<div class="line"><span class="lineno">  311</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  312</span> </div>
<div class="line"><span class="lineno">  313</span>        <span class="comment">/* check if we found the entry */</span></div>
<div class="line"><span class="lineno">  314</span>        <span class="keywordflow">if</span>(arg.entry_offset)</div>
<div class="line"><span class="lineno">  315</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  316</span> </div>
<div class="line"><span class="lineno">  317</span>        <span class="comment">/* get number of next cluster */</span></div>
<div class="line"><span class="lineno">  318</span>        <span class="keywordflow">if</span>(!(cluster_num = <a class="code hl_function" href="#ga80d15e5b202d3b8999f1c05d5da6be6a">fat16_get_next_cluster</a>(fs, cluster_num)))</div>
<div class="line"><span class="lineno">  319</span>            <span class="keywordflow">return</span> 0; <span class="comment">/* directory entry not found */</span></div>
<div class="line"><span class="lineno">  320</span>    }</div>
<div class="line"><span class="lineno">  321</span> </div>
<div class="line"><span class="lineno">  322</span>    memset(dir_entry, 0, <span class="keyword">sizeof</span>(*dir_entry));</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span>    <span class="comment">/* read entry */</span></div>
<div class="line"><span class="lineno">  325</span>    <span class="keywordflow">if</span>(!fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#a59ba2a9a21fc39f90358fe48baa5b923">partition</a>-&gt;device_read_interval(arg.entry_offset,</div>
<div class="line"><span class="lineno">  326</span>        buffer,</div>
<div class="line"><span class="lineno">  327</span>       <span class="keyword">sizeof</span>(buffer),</div>
<div class="line"><span class="lineno">  328</span>       arg.byte_count,</div>
<div class="line"><span class="lineno">  329</span>       <a class="code hl_function" href="#ga64666f9e44e49273d33ed01058ff5fac">fat16_dir_entry_read_callback</a>,</div>
<div class="line"><span class="lineno">  330</span>       dir_entry))</div>
<div class="line"><span class="lineno">  331</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  332</span> </div>
<div class="line"><span class="lineno">  333</span>    <span class="keywordflow">return</span> dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a9f625c7e8ac92bd268c62089f71480d0">long_name</a>[0] != <span class="charliteral">&#39;\0&#39;</span> ? 1 : 0;</div>
<div class="line"><span class="lineno">  334</span>}</div>
<div class="ttc" id="agroup__fat16__file_html_gaafdb0e859960ff33b11b6c55b3188274"><div class="ttname"><a href="group__fat16__file.html#gaafdb0e859960ff33b11b6c55b3188274">FAT16_ATTRIB_DIR</a></div><div class="ttdeci">#define FAT16_ATTRIB_DIR</div><div class="ttdoc">The file is a directory.</div><div class="ttdef"><b>Definition</b> <a href="fat16__header_8h_source.html#l00041">fat16_header.h:41</a></div></div>
<div class="ttc" id="agroup__fat16__fs_html_ga80d15e5b202d3b8999f1c05d5da6be6a"><div class="ttname"><a href="#ga80d15e5b202d3b8999f1c05d5da6be6a">fat16_get_next_cluster</a></div><div class="ttdeci">static uint16_t fat16_get_next_cluster(const struct fat16_fs_struct *fs, uint16_t cluster_num)</div><div class="ttdoc">Retrieves the next following cluster of a given cluster.</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l00566">fat16.h:566</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_gaefed7787ed7c6e2ce35f67c06aac36c7_cgraph.png" border="0" usemap="#agroup__fat16__fs_gaefed7787ed7c6e2ce35f67c06aac36c7_cgraph" alt=""/></div>
<map name="agroup__fat16__fs_gaefed7787ed7c6e2ce35f67c06aac36c7_cgraph" id="agroup__fat16__fs_gaefed7787ed7c6e2ce35f67c06aac36c7_cgraph">
<area shape="rect" title="Reads a directory entry of a given parent directory." alt="" coords="5,72,136,115"/>
<area shape="rect" href="group__fat16__fs.html#ga64666f9e44e49273d33ed01058ff5fac" title="Callback function for reading a directory entry." alt="" coords="191,5,329,48"/>
<area shape="poly" title=" " alt="" coords="132,69,182,51,184,56,134,74"/>
<area shape="rect" href="group__fat16__fs.html#ga6f277c11fa202ecfadca3635221f70a4" title="Callback function for seeking through subdirectory entries." alt="" coords="189,72,331,115"/>
<area shape="poly" title=" " alt="" coords="136,91,174,91,174,96,136,96"/>
<area shape="rect" href="group__fat16__fs.html#ga80d15e5b202d3b8999f1c05d5da6be6a" title="Retrieves the next following cluster of a given cluster." alt="" coords="184,139,336,165"/>
<area shape="poly" title=" " alt="" coords="137,111,201,131,199,136,135,116"/>
<area shape="rect" href="group__fat16__fs.html#ga8927d70d35df0d10284286e2d5b66193" title="Interprets a raw directory entry and puts the contained information into the directory entry." alt="" coords="384,5,508,48"/>
<area shape="poly" title=" " alt="" coords="330,24,369,24,369,29,330,29"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_gaefed7787ed7c6e2ce35f67c06aac36c7_icgraph.png" border="0" usemap="#agroup__fat16__fs_gaefed7787ed7c6e2ce35f67c06aac36c7_icgraph" alt=""/></div>
<map name="agroup__fat16__fs_gaefed7787ed7c6e2ce35f67c06aac36c7_icgraph" id="agroup__fat16__fs_gaefed7787ed7c6e2ce35f67c06aac36c7_icgraph">
<area shape="rect" title="Reads a directory entry of a given parent directory." alt="" coords="493,56,624,99"/>
<area shape="rect" href="group__fat16__dir.html#ga73c8f0598e8224736b09644c48cf2970" title="Reads the next directory entry contained within a parent directory." alt="" coords="343,64,445,91"/>
<area shape="poly" title=" " alt="" coords="478,80,446,80,446,75,478,75"/>
<area shape="rect" href="group__fat16__file.html#gaf8029e3ec633902d08e8204d13afc350" title="Creates a file." alt="" coords="172,5,287,32"/>
<area shape="poly" title=" " alt="" coords="340,61,268,35,270,30,341,56"/>
<area shape="rect" href="group__fat16__file.html#ga0045fe378de2f7c52b528f985e1891a6" title="Retrieves the directory entry of a path." alt="" coords="164,56,295,99"/>
<area shape="poly" title=" " alt="" coords="327,80,295,80,295,75,327,75"/>
<area shape="rect" href="group__fat16.html#gaa25986550d47370f582118a9ef6eae24" title=" " alt="" coords="178,123,281,149"/>
<area shape="poly" title=" " alt="" coords="341,99,270,125,268,120,340,94"/>
<area shape="rect" href="group__fat16.html#gacdc9da639a6ccdac9847aaba559f9ef0" title=" " alt="" coords="5,123,116,149"/>
<area shape="poly" title=" " alt="" coords="163,139,116,139,116,133,163,133"/>
</map>
</div>

</div>
</div>
<a id="gad1da920ff8c1a617522bbfa21972e4c7" name="gad1da920ff8c1a617522bbfa21972e4c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad1da920ff8c1a617522bbfa21972e4c7">&#9670;&#160;</a></span>fat16_terminate_clusters()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t fat16_terminate_clusters </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>cluster_num</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Frees a part of a cluster chain and correctly terminates the rest. </p>
<p>Marks the specified cluster as the new end of a cluster chain and frees all following clusters.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fs</td><td>The filesystem on which to operate. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cluster_num</td><td>The new end of the cluster chain. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, 1 on success. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#gadef154e10fea9a769262e22c4bbfa383" title="Frees a cluster chain, or a part thereof.">fat16_free_clusters</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l00756">756</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  757</span>{</div>
<div class="line"><span class="lineno">  758</span><span class="preprocessor">    #if FAT16_WRITE_SUPPORT</span></div>
<div class="line"><span class="lineno">  759</span>        <span class="keywordflow">if</span>(!fs || cluster_num &lt; 2)</div>
<div class="line"><span class="lineno">  760</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  761</span>    </div>
<div class="line"><span class="lineno">  762</span>        <span class="comment">/* fetch next cluster before overwriting the cluster entry */</span></div>
<div class="line"><span class="lineno">  763</span>        uint16_t cluster_num_next = <a class="code hl_function" href="#ga80d15e5b202d3b8999f1c05d5da6be6a">fat16_get_next_cluster</a>(fs, cluster_num);</div>
<div class="line"><span class="lineno">  764</span>    </div>
<div class="line"><span class="lineno">  765</span>        <span class="comment">/* mark cluster as the last one */</span></div>
<div class="line"><span class="lineno">  766</span>        uint8_t buffer[2];</div>
<div class="line"><span class="lineno">  767</span>        buffer[0] = <a class="code hl_define" href="fat16_8h.html#a5d15f887f18577d14ff69ef3de9efa0a">FAT16_CLUSTER_LAST_MAX</a> &amp; 0xff;</div>
<div class="line"><span class="lineno">  768</span>        buffer[1] = (<a class="code hl_define" href="fat16_8h.html#a5d15f887f18577d14ff69ef3de9efa0a">FAT16_CLUSTER_LAST_MAX</a> &gt;&gt; 8) &amp; 0xff;</div>
<div class="line"><span class="lineno">  769</span>        <span class="keywordflow">if</span>(!fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#a59ba2a9a21fc39f90358fe48baa5b923">partition</a>-&gt;device_write(fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#ad1287906321608dc2aa7741324dca9b5">header</a>.<a class="code hl_variable" href="structfat16__header__struct.html#a747d84164b4dc1f39c8081dc6f59432a">fat_offset</a> + 2 * cluster_num, buffer, 2))</div>
<div class="line"><span class="lineno">  770</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  771</span>    </div>
<div class="line"><span class="lineno">  772</span>        <span class="comment">/* free remaining clusters */</span></div>
<div class="line"><span class="lineno">  773</span>        <span class="keywordflow">if</span>(cluster_num_next)</div>
<div class="line"><span class="lineno">  774</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="#gadef154e10fea9a769262e22c4bbfa383">fat16_free_clusters</a>(fs, cluster_num_next);</div>
<div class="line"><span class="lineno">  775</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  776</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  777</span><span class="preprocessor">    #else</span></div>
<div class="line"><span class="lineno">  778</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  779</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno">  780</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_gad1da920ff8c1a617522bbfa21972e4c7_cgraph.png" border="0" usemap="#agroup__fat16__fs_gad1da920ff8c1a617522bbfa21972e4c7_cgraph" alt=""/></div>
<map name="agroup__fat16__fs_gad1da920ff8c1a617522bbfa21972e4c7_cgraph" id="agroup__fat16__fs_gad1da920ff8c1a617522bbfa21972e4c7_cgraph">
<area shape="rect" title="Frees a part of a cluster chain and correctly terminates the rest." alt="" coords="5,31,169,57"/>
<area shape="rect" href="group__fat16__fs.html#gadef154e10fea9a769262e22c4bbfa383" title="Frees a cluster chain, or a part thereof." alt="" coords="228,5,358,32"/>
<area shape="poly" title=" " alt="" coords="169,31,212,26,212,31,170,37"/>
<area shape="rect" href="group__fat16__fs.html#ga80d15e5b202d3b8999f1c05d5da6be6a" title="Retrieves the next following cluster of a given cluster." alt="" coords="217,56,369,83"/>
<area shape="poly" title=" " alt="" coords="170,51,202,55,201,61,169,57"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_gad1da920ff8c1a617522bbfa21972e4c7_icgraph.png" border="0" usemap="#agroup__fat16__fs_gad1da920ff8c1a617522bbfa21972e4c7_icgraph" alt=""/></div>
<map name="agroup__fat16__fs_gad1da920ff8c1a617522bbfa21972e4c7_icgraph" id="agroup__fat16__fs_gad1da920ff8c1a617522bbfa21972e4c7_icgraph">
<area shape="rect" title="Frees a part of a cluster chain and correctly terminates the rest." alt="" coords="323,5,486,32"/>
<area shape="rect" href="group__fat16__file.html#ga23740742fa60ca148ef098caac7085c0" title="Resizes a file to have a specific size." alt="" coords="161,5,275,32"/>
<area shape="poly" title=" " alt="" coords="307,21,276,21,276,16,307,16"/>
<area shape="rect" href="group__fat16__file.html#gaf1511fd1a5419d0828265566dc5d33e4" title="Repositions the read/write file offset." alt="" coords="5,5,113,32"/>
<area shape="poly" title=" " alt="" coords="145,21,113,21,113,16,145,16"/>
</map>
</div>

</div>
</div>
<a id="gaa8e109c4e412a52e117f01aab14831c9" name="gaa8e109c4e412a52e117f01aab14831c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa8e109c4e412a52e117f01aab14831c9">&#9670;&#160;</a></span>fat16_write_dir_entry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t fat16_write_dir_entry </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structfat16__fs__struct.html">fat16_fs_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>fs</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structfat16__dir__entry__struct.html">fat16_dir_entry_struct</a> *</td>          <td class="paramname"><span class="paramname"><em>dir_entry</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Writes a directory entry to disk. </p>
<dl class="section note"><dt>Note</dt><dd>The file name is not checked for invalid characters.</dd>
<dd>
The generation of the short 8.3 file name is quite simple. The first eight characters are used for the filename. The extension, if any, is made up of the first three characters following the last dot within the long filename. If the filename (without the extension) is longer than eight characters, the lower byte of the cluster number replaces the last two characters to avoid name clashes. In any other case, it is your responsibility to avoid name clashes.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fs</td><td>The filesystem on which to operate. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dir_entry</td><td>The directory entry to write. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, 1 on success. </dd></dl>

<p class="definition">Definition at line <a class="el" href="fat16_8h_source.html#l01327">1327</a> of file <a class="el" href="fat16_8h_source.html">fat16.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1328</span>{</div>
<div class="line"><span class="lineno"> 1329</span><span class="preprocessor">    #if FAT16_WRITE_SUPPORT</span></div>
<div class="line"><span class="lineno"> 1330</span>        <span class="keywordflow">if</span>(!fs || !dir_entry)</div>
<div class="line"><span class="lineno"> 1331</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1332</span>    </div>
<div class="line"><span class="lineno"> 1333</span>        device_write_t device_write = fs-&gt;<a class="code hl_variable" href="structfat16__fs__struct.html#a59ba2a9a21fc39f90358fe48baa5b923">partition</a>-&gt;device_write;</div>
<div class="line"><span class="lineno"> 1334</span>        uint32_t offset = dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a8af0bfe59cef4c7940d2e53da87a0c28">entry_offset</a>;</div>
<div class="line"><span class="lineno"> 1335</span>        uint8_t name_len = strlen(dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a9f625c7e8ac92bd268c62089f71480d0">long_name</a>);</div>
<div class="line"><span class="lineno"> 1336</span>        uint8_t lfn_entry_count = (name_len + 12) / 13;</div>
<div class="line"><span class="lineno"> 1337</span>        uint8_t buffer[32];</div>
<div class="line"><span class="lineno"> 1338</span>    </div>
<div class="line"><span class="lineno"> 1339</span>        <span class="comment">/* write 8.3 entry */</span></div>
<div class="line"><span class="lineno"> 1340</span>    </div>
<div class="line"><span class="lineno"> 1341</span>        <span class="comment">/* generate 8.3 file name */</span></div>
<div class="line"><span class="lineno"> 1342</span>        memset(&amp;buffer[0], <span class="charliteral">&#39; &#39;</span>, 11);</div>
<div class="line"><span class="lineno"> 1343</span>        <span class="keywordtype">char</span>* name_ext = strrchr(dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a9f625c7e8ac92bd268c62089f71480d0">long_name</a>, <span class="charliteral">&#39;.&#39;</span>);</div>
<div class="line"><span class="lineno"> 1344</span>        <span class="keywordflow">if</span>(name_ext)</div>
<div class="line"><span class="lineno"> 1345</span>        {</div>
<div class="line"><span class="lineno"> 1346</span>            ++name_ext;</div>
<div class="line"><span class="lineno"> 1347</span>    </div>
<div class="line"><span class="lineno"> 1348</span>            uint8_t name_ext_len = strlen(name_ext);</div>
<div class="line"><span class="lineno"> 1349</span>            name_len -= name_ext_len + 1;</div>
<div class="line"><span class="lineno"> 1350</span>    </div>
<div class="line"><span class="lineno"> 1351</span>            <span class="keywordflow">if</span>(name_ext_len &gt; 3)</div>
<div class="line"><span class="lineno"> 1352</span>                name_ext_len = 3;</div>
<div class="line"><span class="lineno"> 1353</span>    </div>
<div class="line"><span class="lineno"> 1354</span>            memcpy(&amp;buffer[8], name_ext, name_ext_len);</div>
<div class="line"><span class="lineno"> 1355</span>        }</div>
<div class="line"><span class="lineno"> 1356</span>    </div>
<div class="line"><span class="lineno"> 1357</span>        <span class="keywordflow">if</span>(name_len &lt;= 8)</div>
<div class="line"><span class="lineno"> 1358</span>        {</div>
<div class="line"><span class="lineno"> 1359</span>            memcpy(buffer, dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a9f625c7e8ac92bd268c62089f71480d0">long_name</a>, name_len);</div>
<div class="line"><span class="lineno"> 1360</span>        }</div>
<div class="line"><span class="lineno"> 1361</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno"> 1362</span>        {</div>
<div class="line"><span class="lineno"> 1363</span>            memcpy(buffer, dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a9f625c7e8ac92bd268c62089f71480d0">long_name</a>, 8);</div>
<div class="line"><span class="lineno"> 1364</span>    </div>
<div class="line"><span class="lineno"> 1365</span>            <span class="comment">/* Minimize 8.3 name clashes by appending</span></div>
<div class="line"><span class="lineno"> 1366</span><span class="comment">                                             * the lower byte of the cluster number.</span></div>
<div class="line"><span class="lineno"> 1367</span><span class="comment">                                             */</span></div>
<div class="line"><span class="lineno"> 1368</span>            uint8_t num = dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a8bbd1a1339bd035f916ffe91420cc8ad">cluster</a> &amp; 0xff;</div>
<div class="line"><span class="lineno"> 1369</span>    </div>
<div class="line"><span class="lineno"> 1370</span>            buffer[6] = (num &lt; 0xa0) ? (<span class="charliteral">&#39;0&#39;</span> + (num &gt;&gt; 4)) : (<span class="stringliteral">&#39;a&#39;</span> + (num &gt;&gt; 4));</div>
<div class="line"><span class="lineno"> 1371</span>            num &amp;= 0x0f;</div>
<div class="line"><span class="lineno"> 1372</span>            buffer[7] = (num &lt; 0x0a) ? (<span class="charliteral">&#39;0&#39;</span> + num) : (<span class="charliteral">&#39;a&#39;</span> + num);</div>
<div class="line"><span class="lineno"> 1373</span>        }</div>
<div class="line"><span class="lineno"> 1374</span>    </div>
<div class="line"><span class="lineno"> 1375</span>        <span class="comment">/* fill directory entry buffer */</span></div>
<div class="line"><span class="lineno"> 1376</span>        memset(&amp;buffer[11], 0, <span class="keyword">sizeof</span>(buffer) - 11);</div>
<div class="line"><span class="lineno"> 1377</span>        buffer[0x0b] = dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a4e4c6084a1f0cf1e687ac68853dbd61e">attributes</a>;</div>
<div class="line"><span class="lineno"> 1378</span> </div>
<div class="line"><span class="lineno"> 1379</span>        <span class="comment">//Not used in bootloader</span></div>
<div class="line"><span class="lineno"> 1380</span><span class="preprocessor">        #ifdef MAIN_FIRMWARE</span></div>
<div class="line"><span class="lineno"> 1381</span>            <span class="comment">//Added modified date/time 12-26-07</span></div>
<div class="line"><span class="lineno"> 1382</span>            <span class="comment">//=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span></div>
<div class="line"><span class="lineno"> 1383</span>            <span class="keywordtype">char</span> * current_time;</div>
<div class="line"><span class="lineno"> 1384</span><span class="comment">/*          current_time = GPS_get_time();</span></div>
<div class="line"><span class="lineno"> 1385</span><span class="comment">            char * current_date;</span></div>
<div class="line"><span class="lineno"> 1386</span><span class="comment">            current_date = GPS_get_date();</span></div>
<div class="line"><span class="lineno"> 1387</span><span class="comment">            </span></div>
<div class="line"><span class="lineno"> 1388</span><span class="comment">            uint16_t modified_time, modified_date;</span></div>
<div class="line"><span class="lineno"> 1389</span><span class="comment">            uint8_t c_hour, c_minute, c_second;</span></div>
<div class="line"><span class="lineno"> 1390</span><span class="comment">            uint8_t c_year, c_month, c_day;</span></div>
<div class="line"><span class="lineno"> 1391</span><span class="comment">            </span></div>
<div class="line"><span class="lineno"> 1392</span><span class="comment">            c_hour = (current_time[0] - &#39;0&#39;) * 10;</span></div>
<div class="line"><span class="lineno"> 1393</span><span class="comment">            c_hour += (current_time[1] - &#39;0&#39;);</span></div>
<div class="line"><span class="lineno"> 1394</span><span class="comment">            c_minute = (current_time[3] - &#39;0&#39;) * 10;</span></div>
<div class="line"><span class="lineno"> 1395</span><span class="comment">            c_minute += (current_time[4] - &#39;0&#39;);</span></div>
<div class="line"><span class="lineno"> 1396</span><span class="comment">            c_second = (current_time[6] - &#39;0&#39;) * 10;</span></div>
<div class="line"><span class="lineno"> 1397</span><span class="comment">            c_second += (current_time[7] - &#39;0&#39;);</span></div>
<div class="line"><span class="lineno"> 1398</span><span class="comment">            </span></div>
<div class="line"><span class="lineno"> 1399</span><span class="comment">            c_day = (current_date[0] - &#39;0&#39;) * 10;</span></div>
<div class="line"><span class="lineno"> 1400</span><span class="comment">            c_day += (current_date[1] - &#39;0&#39;);</span></div>
<div class="line"><span class="lineno"> 1401</span><span class="comment">            c_month = (current_date[3] - &#39;0&#39;) * 10;</span></div>
<div class="line"><span class="lineno"> 1402</span><span class="comment">            c_month += (current_date[4] - &#39;0&#39;);</span></div>
<div class="line"><span class="lineno"> 1403</span><span class="comment">            c_year = (current_date[6] - &#39;0&#39;) * 10;</span></div>
<div class="line"><span class="lineno"> 1404</span><span class="comment">            c_year += (current_date[7] - &#39;0&#39;);</span></div>
<div class="line"><span class="lineno"> 1405</span><span class="comment">            </span></div>
<div class="line"><span class="lineno"> 1406</span><span class="comment">            //Correct for 1980 = 0, 2000 = 20, year code</span></div>
<div class="line"><span class="lineno"> 1407</span><span class="comment">            c_year += 20;</span></div>
<div class="line"><span class="lineno"> 1408</span><span class="comment">            </span></div>
<div class="line"><span class="lineno"> 1409</span><span class="comment">            modified_time = (c_hour &lt;&lt; (16-5)) | (c_minute &lt;&lt; (16-11)) | (c_second);</span></div>
<div class="line"><span class="lineno"> 1410</span><span class="comment">            modified_date = (c_year &lt;&lt; (16-7)) | (c_month &lt;&lt; (16-11)) | (c_day);</span></div>
<div class="line"><span class="lineno"> 1411</span><span class="comment"></span> </div>
<div class="line"><span class="lineno"> 1412</span><span class="comment">            //Do a little error correction</span></div>
<div class="line"><span class="lineno"> 1413</span><span class="comment">            if (c_year &lt; 26) //26 = 2006</span></div>
<div class="line"><span class="lineno"> 1414</span><span class="comment">            {</span></div>
<div class="line"><span class="lineno"> 1415</span><span class="comment">                modified_time = 0;</span></div>
<div class="line"><span class="lineno"> 1416</span><span class="comment">                modified_date = 0;</span></div>
<div class="line"><span class="lineno"> 1417</span><span class="comment">            }</span></div>
<div class="line"><span class="lineno"> 1418</span><span class="comment"></span> </div>
<div class="line"><span class="lineno"> 1419</span><span class="comment">            //rprintf(&quot;c_time=%d, %d, %d\n&quot;, c_hour, c_minute, c_second);</span></div>
<div class="line"><span class="lineno"> 1420</span><span class="comment">            //rprintf(&quot;c_date=%d, %d, %d\n&quot;, c_month, c_day, c_year);</span></div>
<div class="line"><span class="lineno"> 1421</span><span class="comment">            //rprintf(&quot;mod_time=%x\n&quot;, modified_time);</span></div>
<div class="line"><span class="lineno"> 1422</span><span class="comment">            //rprintf(&quot;mod_date=%x\n&quot;, modified_date);</span></div>
<div class="line"><span class="lineno"> 1423</span><span class="comment">            </span></div>
<div class="line"><span class="lineno"> 1424</span><span class="comment">            buffer[0x16] = (modified_time &gt;&gt; 0) &amp; 0xFF;</span></div>
<div class="line"><span class="lineno"> 1425</span><span class="comment">            buffer[0x17] = (modified_time &gt;&gt; 8) &amp; 0xFF;</span></div>
<div class="line"><span class="lineno"> 1426</span><span class="comment">            buffer[0x18] = (modified_date &gt;&gt; 0) &amp; 0xFF;</span></div>
<div class="line"><span class="lineno"> 1427</span><span class="comment">            buffer[0x19] = (modified_date &gt;&gt; 8) &amp; 0xFF;</span></div>
<div class="line"><span class="lineno"> 1428</span><span class="comment">            */</span></div>
<div class="line"><span class="lineno"> 1429</span>            <span class="comment">//=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=</span></div>
<div class="line"><span class="lineno"> 1430</span><span class="preprocessor">        #endif</span></div>
<div class="line"><span class="lineno"> 1431</span> </div>
<div class="line"><span class="lineno"> 1432</span>        buffer[0x1a] = (dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a8bbd1a1339bd035f916ffe91420cc8ad">cluster</a> &gt;&gt; 0) &amp; 0xff;</div>
<div class="line"><span class="lineno"> 1433</span>        buffer[0x1b] = (dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a8bbd1a1339bd035f916ffe91420cc8ad">cluster</a> &gt;&gt; 8) &amp; 0xff;</div>
<div class="line"><span class="lineno"> 1434</span>        buffer[0x1c] = (dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a20dc3151ca3727aef4ad79a7735131ff">file_size</a> &gt;&gt; 0) &amp; 0xff;</div>
<div class="line"><span class="lineno"> 1435</span>        buffer[0x1d] = (dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a20dc3151ca3727aef4ad79a7735131ff">file_size</a> &gt;&gt; 8) &amp; 0xff;</div>
<div class="line"><span class="lineno"> 1436</span>        buffer[0x1e] = (dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a20dc3151ca3727aef4ad79a7735131ff">file_size</a> &gt;&gt; 16) &amp; 0xff;</div>
<div class="line"><span class="lineno"> 1437</span>        buffer[0x1f] = (dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a20dc3151ca3727aef4ad79a7735131ff">file_size</a> &gt;&gt; 24) &amp; 0xff;</div>
<div class="line"><span class="lineno"> 1438</span>    </div>
<div class="line"><span class="lineno"> 1439</span>        <span class="comment">/* write to disk */</span></div>
<div class="line"><span class="lineno"> 1440</span>        <span class="keywordflow">if</span>(!device_write(offset + (uint32_t) lfn_entry_count * 32, buffer, <span class="keyword">sizeof</span>(buffer)))</div>
<div class="line"><span class="lineno"> 1441</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1442</span>    </div>
<div class="line"><span class="lineno"> 1443</span>        <span class="comment">/* calculate checksum of 8.3 name */</span></div>
<div class="line"><span class="lineno"> 1444</span>        uint8_t checksum = buffer[0];</div>
<div class="line"><span class="lineno"> 1445</span>        uint8_t i;</div>
<div class="line"><span class="lineno"> 1446</span>        <span class="keywordflow">for</span>(i = 1; i &lt; 11; ++i)</div>
<div class="line"><span class="lineno"> 1447</span>            checksum = ((checksum &gt;&gt; 1) | (checksum &lt;&lt; 7)) + buffer[i];</div>
<div class="line"><span class="lineno"> 1448</span>    </div>
<div class="line"><span class="lineno"> 1449</span>        <span class="comment">/* write lfn entries */</span></div>
<div class="line"><span class="lineno"> 1450</span>        uint8_t lfn_entry;</div>
<div class="line"><span class="lineno"> 1451</span>        <span class="keywordflow">for</span>(lfn_entry = lfn_entry_count; lfn_entry &gt; 0; --lfn_entry)</div>
<div class="line"><span class="lineno"> 1452</span>        {</div>
<div class="line"><span class="lineno"> 1453</span>            memset(buffer, 0, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line"><span class="lineno"> 1454</span>            memset(&amp;buffer[0x01], 0xff, 10);</div>
<div class="line"><span class="lineno"> 1455</span>            memset(&amp;buffer[0x0e], 0xff, 12);</div>
<div class="line"><span class="lineno"> 1456</span>            memset(&amp;buffer[0x1c], 0xff, 4);</div>
<div class="line"><span class="lineno"> 1457</span>    </div>
<div class="line"><span class="lineno"> 1458</span>            buffer[0x00] = lfn_entry;</div>
<div class="line"><span class="lineno"> 1459</span>            <span class="keywordflow">if</span>(lfn_entry == lfn_entry_count)</div>
<div class="line"><span class="lineno"> 1460</span>                buffer[0x00] |= <a class="code hl_define" href="fat16_8h.html#a426e5c6a4a338b5d5c46fed86b962c82">FAT16_DIRENTRY_LFNLAST</a>;</div>
<div class="line"><span class="lineno"> 1461</span>    </div>
<div class="line"><span class="lineno"> 1462</span>            <span class="comment">/* set file name */</span></div>
<div class="line"><span class="lineno"> 1463</span>            <span class="keyword">const</span> <span class="keywordtype">char</span>* long_name_curr = dir_entry-&gt;<a class="code hl_variable" href="structfat16__dir__entry__struct.html#a9f625c7e8ac92bd268c62089f71480d0">long_name</a> + (lfn_entry - 1) * 13;</div>
<div class="line"><span class="lineno"> 1464</span>            i = 1;</div>
<div class="line"><span class="lineno"> 1465</span>            <span class="keywordflow">while</span>(i &lt; 0x1f)</div>
<div class="line"><span class="lineno"> 1466</span>            {</div>
<div class="line"><span class="lineno"> 1467</span>                buffer[i++] = *long_name_curr;</div>
<div class="line"><span class="lineno"> 1468</span>                buffer[i++] = 0;</div>
<div class="line"><span class="lineno"> 1469</span>    </div>
<div class="line"><span class="lineno"> 1470</span>                <span class="keywordflow">switch</span>(i)</div>
<div class="line"><span class="lineno"> 1471</span>                {</div>
<div class="line"><span class="lineno"> 1472</span>                    <span class="keywordflow">case</span> 0x0b:</div>
<div class="line"><span class="lineno"> 1473</span>                        i = 0x0e;</div>
<div class="line"><span class="lineno"> 1474</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1475</span>                    <span class="keywordflow">case</span> 0x1a:</div>
<div class="line"><span class="lineno"> 1476</span>                        i = 0x1c;</div>
<div class="line"><span class="lineno"> 1477</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1478</span>                }</div>
<div class="line"><span class="lineno"> 1479</span>    </div>
<div class="line"><span class="lineno"> 1480</span>                <span class="keywordflow">if</span>(!*long_name_curr++)</div>
<div class="line"><span class="lineno"> 1481</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1482</span>            }</div>
<div class="line"><span class="lineno"> 1483</span>    </div>
<div class="line"><span class="lineno"> 1484</span>            <span class="comment">/* mark as lfn entry */</span></div>
<div class="line"><span class="lineno"> 1485</span>            buffer[0x0b] = 0x0f;</div>
<div class="line"><span class="lineno"> 1486</span>    </div>
<div class="line"><span class="lineno"> 1487</span>            <span class="comment">/* set checksum */</span></div>
<div class="line"><span class="lineno"> 1488</span>            buffer[0x0d] = checksum;</div>
<div class="line"><span class="lineno"> 1489</span>    </div>
<div class="line"><span class="lineno"> 1490</span>            <span class="comment">/* write entry */</span></div>
<div class="line"><span class="lineno"> 1491</span>            device_write(offset, buffer, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line"><span class="lineno"> 1492</span>    </div>
<div class="line"><span class="lineno"> 1493</span>            offset += <span class="keyword">sizeof</span>(buffer);</div>
<div class="line"><span class="lineno"> 1494</span>        }</div>
<div class="line"><span class="lineno"> 1495</span>    </div>
<div class="line"><span class="lineno"> 1496</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 1497</span>    </div>
<div class="line"><span class="lineno"> 1498</span><span class="preprocessor">    #else</span></div>
<div class="line"><span class="lineno"> 1499</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1500</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno"> 1501</span>}</div>
<div class="ttc" id="afat16_8h_html_a426e5c6a4a338b5d5c46fed86b962c82"><div class="ttname"><a href="fat16_8h.html#a426e5c6a4a338b5d5c46fed86b962c82">FAT16_DIRENTRY_LFNLAST</a></div><div class="ttdeci">#define FAT16_DIRENTRY_LFNLAST</div><div class="ttdef"><b>Definition</b> <a href="fat16_8h_source.html#l00073">fat16.h:73</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__fat16__fs_gaa8e109c4e412a52e117f01aab14831c9_icgraph.png" border="0" usemap="#agroup__fat16__fs_gaa8e109c4e412a52e117f01aab14831c9_icgraph" alt=""/></div>
<map name="agroup__fat16__fs_gaa8e109c4e412a52e117f01aab14831c9_icgraph" id="agroup__fat16__fs_gaa8e109c4e412a52e117f01aab14831c9_icgraph">
<area shape="rect" title="Writes a directory entry to disk." alt="" coords="324,56,464,83"/>
<area shape="rect" href="group__fat16__file.html#gaf8029e3ec633902d08e8204d13afc350" title="Creates a file." alt="" coords="161,5,276,32"/>
<area shape="poly" title=" " alt="" coords="330,54,267,35,268,30,331,48"/>
<area shape="rect" href="group__fat16__file.html#ga23740742fa60ca148ef098caac7085c0" title="Resizes a file to have a specific size." alt="" coords="161,56,276,83"/>
<area shape="poly" title=" " alt="" coords="308,72,276,72,276,67,308,67"/>
<area shape="rect" href="group__fat16__file.html#ga4f0c785a47b1cf070839b5edec2c6f65" title="Writes data to a file." alt="" coords="165,107,272,133"/>
<area shape="poly" title=" " alt="" coords="331,90,268,109,267,104,330,85"/>
<area shape="rect" href="group__fat16__file.html#gaf1511fd1a5419d0828265566dc5d33e4" title="Repositions the read/write file offset." alt="" coords="5,56,113,83"/>
<area shape="poly" title=" " alt="" coords="146,72,113,72,113,67,146,67"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
    <ul>
      <address class="footer">
        <a href="http://ykat.de">
        &copy 2024 ykat UG (haftungsbeschrnkt)
        </a>
        </address>
    </li>
    </ul>
  </div>
  </div>
  </div>
  </div>
  </div>
  </div>
  </body>
  </html>