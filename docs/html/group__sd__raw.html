<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AgileRTOS (zrtos): MMC/SD card raw access</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">AgileRTOS (zrtos)<span id="projectnumber">&#160;Version 0.8.0 (ghostbuster)</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__sd__raw.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Topics</a> &#124;
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">MMC/SD card raw access</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for MMC/SD card raw access:</div>
<div class="dyncontent">
<div class="center"><img src="group__sd__raw.png" border="0" usemap="#agroup____sd____raw" alt=""/></div>
<map name="agroup____sd____raw" id="agroup____sd____raw">
<area shape="rect" title=" " alt="" coords="5,5,179,32"/>
<area shape="rect" href="group__sd__raw__config.html" title="Preprocessor defines to configure the MMC/SD support." alt="" coords="227,5,378,32"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="groups" name="groups"></a>
Topics</h2></td></tr>
<tr class="memitem:group__sd__raw__config" id="r_group__sd__raw__config"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__sd__raw__config.html">MMC/SD configuration</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:sd__card_8h" id="r_sd__card_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd__card_8h.html">sd_card.h</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:sd__card__header_8h" id="r_sd__card__header_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sd__card__header_8h.html">sd_card_header.h</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structsd__raw__info.html">sd_raw_info</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga2507a78d61385c9dbc1d06b8a03ef58a" id="r_ga2507a78d61385c9dbc1d06b8a03ef58a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga2507a78d61385c9dbc1d06b8a03ef58a">SD_RAW_FORMAT_HARDDISK</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:ga2507a78d61385c9dbc1d06b8a03ef58a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4caede5500f4d1035ceb9951a831c224" id="r_ga4caede5500f4d1035ceb9951a831c224"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga4caede5500f4d1035ceb9951a831c224">SD_RAW_FORMAT_SUPERFLOPPY</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ga4caede5500f4d1035ceb9951a831c224"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad070d05f762410f57870549a0fcd5f43" id="r_gad070d05f762410f57870549a0fcd5f43"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gad070d05f762410f57870549a0fcd5f43">SD_RAW_FORMAT_UNIVERSAL</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:gad070d05f762410f57870549a0fcd5f43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7e87231437f32335a25930ec1b85a9c9" id="r_ga7e87231437f32335a25930ec1b85a9c9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga7e87231437f32335a25930ec1b85a9c9">SD_RAW_FORMAT_UNKNOWN</a>&#160;&#160;&#160;3</td></tr>
<tr class="separator:ga7e87231437f32335a25930ec1b85a9c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga0932092e0096d2973d52d72aa69190ef" id="r_ga0932092e0096d2973d52d72aa69190ef"><td class="memItemLeft" align="right" valign="top">typedef unsigned char(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga0932092e0096d2973d52d72aa69190ef">sd_raw_interval_handler</a>) (unsigned char *buffer, unsigned int offset, void *p)</td></tr>
<tr class="separator:ga0932092e0096d2973d52d72aa69190ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gac2e6d0ba10cef8f72391d35b4aabf385" id="r_gac2e6d0ba10cef8f72391d35b4aabf385"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gac2e6d0ba10cef8f72391d35b4aabf385">sd_raw_init</a> ()</td></tr>
<tr class="separator:gac2e6d0ba10cef8f72391d35b4aabf385"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad8a7de96505d870f59afa5168b3e73c0" id="r_gad8a7de96505d870f59afa5168b3e73c0"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gad8a7de96505d870f59afa5168b3e73c0">sd_raw_available</a> ()</td></tr>
<tr class="separator:gad8a7de96505d870f59afa5168b3e73c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3b5607bd24b1d86cb597e3ac55fa0ab3" id="r_ga3b5607bd24b1d86cb597e3ac55fa0ab3"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga3b5607bd24b1d86cb597e3ac55fa0ab3">sd_raw_locked</a> ()</td></tr>
<tr class="separator:ga3b5607bd24b1d86cb597e3ac55fa0ab3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga157908b0533eb72368d320eb697f0cc0" id="r_ga157908b0533eb72368d320eb697f0cc0"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga157908b0533eb72368d320eb697f0cc0">sd_raw_send_byte</a> (unsigned char b)</td></tr>
<tr class="separator:ga157908b0533eb72368d320eb697f0cc0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga75085da84454931647328e80f6bdea7c" id="r_ga75085da84454931647328e80f6bdea7c"><td class="memItemLeft" align="right" valign="top">static unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a> (void)</td></tr>
<tr class="separator:ga75085da84454931647328e80f6bdea7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga956fc6f9ea12bf3c42fe5d3b472e61a8" id="r_ga956fc6f9ea12bf3c42fe5d3b472e61a8"><td class="memItemLeft" align="right" valign="top">static unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga956fc6f9ea12bf3c42fe5d3b472e61a8">sd_raw_send_command_r1</a> (unsigned char command, unsigned int arg)</td></tr>
<tr class="separator:ga956fc6f9ea12bf3c42fe5d3b472e61a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7aa8ed58f08b39d21b778b66f3e6ce59" id="r_ga7aa8ed58f08b39d21b778b66f3e6ce59"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga7aa8ed58f08b39d21b778b66f3e6ce59">sd_raw_read</a> (unsigned int offset, unsigned char *buffer, unsigned short length)</td></tr>
<tr class="separator:ga7aa8ed58f08b39d21b778b66f3e6ce59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0321ddf4d0234479fc90ee90d3e3cc40" id="r_ga0321ddf4d0234479fc90ee90d3e3cc40"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga0321ddf4d0234479fc90ee90d3e3cc40">sd_raw_read_interval</a> (unsigned int offset, unsigned char *buffer, unsigned short interval, unsigned short length, <a class="el" href="#ga0932092e0096d2973d52d72aa69190ef">sd_raw_interval_handler</a> callback, void *p)</td></tr>
<tr class="separator:ga0321ddf4d0234479fc90ee90d3e3cc40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga70e84e3345f19d2b5eecb9f665b37e0d" id="r_ga70e84e3345f19d2b5eecb9f665b37e0d"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga70e84e3345f19d2b5eecb9f665b37e0d">sd_raw_write</a> (unsigned int offset, const unsigned char *buffer, unsigned short length)</td></tr>
<tr class="separator:ga70e84e3345f19d2b5eecb9f665b37e0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8cff641a3a1cd747bb6634eeba1ad54b" id="r_ga8cff641a3a1cd747bb6634eeba1ad54b"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga8cff641a3a1cd747bb6634eeba1ad54b">sd_raw_sync</a> ()</td></tr>
<tr class="separator:ga8cff641a3a1cd747bb6634eeba1ad54b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga16b73f2f45ee2f1c647d6bef916eb198" id="r_ga16b73f2f45ee2f1c647d6bef916eb198"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga16b73f2f45ee2f1c647d6bef916eb198">sd_raw_get_info</a> (struct <a class="el" href="structsd__raw__info.html">sd_raw_info</a> *info)</td></tr>
<tr class="separator:ga16b73f2f45ee2f1c647d6bef916eb198"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0cd21cf9a326b8cfc9b9d9f35fa57423" id="r_ga0cd21cf9a326b8cfc9b9d9f35fa57423"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga0cd21cf9a326b8cfc9b9d9f35fa57423">sd_raw_get_cid_csd</a> (char *info)</td></tr>
<tr class="separator:ga0cd21cf9a326b8cfc9b9d9f35fa57423"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga33e2ae8b1a4e3088a37225670fb2fe99" id="r_ga33e2ae8b1a4e3088a37225670fb2fe99"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga33e2ae8b1a4e3088a37225670fb2fe99">SDoff</a> (void)</td></tr>
<tr class="separator:ga33e2ae8b1a4e3088a37225670fb2fe99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab2eb12b19ce9d34fa806de7f6ea78ece" id="r_gab2eb12b19ce9d34fa806de7f6ea78ece"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gab2eb12b19ce9d34fa806de7f6ea78ece">format_card</a> (char make_sure)</td></tr>
<tr class="separator:gab2eb12b19ce9d34fa806de7f6ea78ece"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This module implements read and write access to MMC and SD cards. It serves as a low-level driver for the higher level modules such as partition and file system access. </p>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ga2507a78d61385c9dbc1d06b8a03ef58a" name="ga2507a78d61385c9dbc1d06b8a03ef58a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2507a78d61385c9dbc1d06b8a03ef58a">&#9670;&#160;</a></span>SD_RAW_FORMAT_HARDDISK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_RAW_FORMAT_HARDDISK&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The card's layout is harddisk-like, which means it contains a master boot record with a partition table. </p>

<p class="definition">Definition at line <a class="el" href="sd__card__header_8h_source.html#l00028">28</a> of file <a class="el" href="sd__card__header_8h_source.html">sd_card_header.h</a>.</p>

</div>
</div>
<a id="ga4caede5500f4d1035ceb9951a831c224" name="ga4caede5500f4d1035ceb9951a831c224"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4caede5500f4d1035ceb9951a831c224">&#9670;&#160;</a></span>SD_RAW_FORMAT_SUPERFLOPPY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_RAW_FORMAT_SUPERFLOPPY&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The card contains a single filesystem and no partition table. </p>

<p class="definition">Definition at line <a class="el" href="sd__card__header_8h_source.html#l00032">32</a> of file <a class="el" href="sd__card__header_8h_source.html">sd_card_header.h</a>.</p>

</div>
</div>
<a id="gad070d05f762410f57870549a0fcd5f43" name="gad070d05f762410f57870549a0fcd5f43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad070d05f762410f57870549a0fcd5f43">&#9670;&#160;</a></span>SD_RAW_FORMAT_UNIVERSAL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_RAW_FORMAT_UNIVERSAL&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The card's layout follows the Universal File Format. </p>

<p class="definition">Definition at line <a class="el" href="sd__card__header_8h_source.html#l00036">36</a> of file <a class="el" href="sd__card__header_8h_source.html">sd_card_header.h</a>.</p>

</div>
</div>
<a id="ga7e87231437f32335a25930ec1b85a9c9" name="ga7e87231437f32335a25930ec1b85a9c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7e87231437f32335a25930ec1b85a9c9">&#9670;&#160;</a></span>SD_RAW_FORMAT_UNKNOWN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_RAW_FORMAT_UNKNOWN&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The card's layout is unknown. </p>

<p class="definition">Definition at line <a class="el" href="sd__card__header_8h_source.html#l00040">40</a> of file <a class="el" href="sd__card__header_8h_source.html">sd_card_header.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ga0932092e0096d2973d52d72aa69190ef" name="ga0932092e0096d2973d52d72aa69190ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0932092e0096d2973d52d72aa69190ef">&#9670;&#160;</a></span>sd_raw_interval_handler</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef unsigned char(* sd_raw_interval_handler) (unsigned char *buffer, unsigned int offset, void *p)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sd__card__header_8h_source.html#l00114">114</a> of file <a class="el" href="sd__card__header_8h_source.html">sd_card_header.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="gab2eb12b19ce9d34fa806de7f6ea78ece" name="gab2eb12b19ce9d34fa806de7f6ea78ece"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab2eb12b19ce9d34fa806de7f6ea78ece">&#9670;&#160;</a></span>format_card()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char format_card </td>
          <td>(</td>
          <td class="paramtype">char</td>          <td class="paramname"><span class="paramname"><em>make_sure</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="gad8a7de96505d870f59afa5168b3e73c0" name="gad8a7de96505d870f59afa5168b3e73c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad8a7de96505d870f59afa5168b3e73c0">&#9670;&#160;</a></span>sd_raw_available()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char sd_raw_available </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks wether a memory card is located in the slot. </p>
<dl class="section return"><dt>Returns</dt><dd>1 if the card is available, 0 if it is not. </dd></dl>

<p class="definition">Definition at line <a class="el" href="sd__card_8h_source.html#l00255">255</a> of file <a class="el" href="sd__card_8h_source.html">sd_card.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  256</span>{</div>
<div class="line"><span class="lineno">  257</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">  258</span>    configure_pin_available();</div>
<div class="line"><span class="lineno">  259</span>    <span class="keywordflow">for</span>(i=0;i&lt;100000;i++);</div>
<div class="line"><span class="lineno">  260</span>    i = get_pin_available();</div>
<div class="line"><span class="lineno">  261</span>    configure_pin_ss();</div>
<div class="line"><span class="lineno">  262</span>    <span class="keywordflow">return</span> i == 0x00;</div>
<div class="line"><span class="lineno">  263</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__sd__raw_gad8a7de96505d870f59afa5168b3e73c0_icgraph.png" border="0" usemap="#agroup__sd__raw_gad8a7de96505d870f59afa5168b3e73c0_icgraph" alt=""/></div>
<map name="agroup__sd__raw_gad8a7de96505d870f59afa5168b3e73c0_icgraph" id="agroup__sd__raw_gad8a7de96505d870f59afa5168b3e73c0_icgraph">
<area shape="rect" title="Checks wether a memory card is located in the slot." alt="" coords="193,56,311,83"/>
<area shape="rect" href="group__sd__raw.html#ga0cd21cf9a326b8cfc9b9d9f35fa57423" title=" " alt="" coords="5,5,145,32"/>
<area shape="poly" title=" " alt="" coords="188,54,123,35,125,30,189,49"/>
<area shape="rect" href="group__sd__raw.html#ga16b73f2f45ee2f1c647d6bef916eb198" title="Reads informational data from the card." alt="" coords="18,56,132,83"/>
<area shape="poly" title=" " alt="" coords="177,72,133,72,133,67,177,67"/>
<area shape="rect" href="group__sd__raw.html#gac2e6d0ba10cef8f72391d35b4aabf385" title="Initializes memory card communication." alt="" coords="32,107,118,133"/>
<area shape="poly" title=" " alt="" coords="188,90,119,110,118,105,187,85"/>
</map>
</div>

</div>
</div>
<a id="ga0cd21cf9a326b8cfc9b9d9f35fa57423" name="ga0cd21cf9a326b8cfc9b9d9f35fa57423"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0cd21cf9a326b8cfc9b9d9f35fa57423">&#9670;&#160;</a></span>sd_raw_get_cid_csd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sd_raw_get_cid_csd </td>
          <td>(</td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>info</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sd__card_8h_source.html#l00847">847</a> of file <a class="el" href="sd__card_8h_source.html">sd_card.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  847</span>                                   {</div>
<div class="line"><span class="lineno">  848</span>  <span class="keywordflow">if</span>(!info || !<a class="code hl_function" href="#gad8a7de96505d870f59afa5168b3e73c0">sd_raw_available</a>()) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  849</span> </div>
<div class="line"><span class="lineno">  850</span>  select_card();</div>
<div class="line"><span class="lineno">  851</span> </div>
<div class="line"><span class="lineno">  852</span>  <span class="comment">/* read cid register */</span></div>
<div class="line"><span class="lineno">  853</span>  <span class="keywordflow">if</span>(<a class="code hl_function" href="#ga956fc6f9ea12bf3c42fe5d3b472e61a8">sd_raw_send_command_r1</a>(<a class="code hl_define" href="sd__card_8h.html#a69e5cfa724af0af3e97d69005a2b588d">CMD_SEND_CID</a>, 0)) {</div>
<div class="line"><span class="lineno">  854</span>    unselect_card();</div>
<div class="line"><span class="lineno">  855</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  856</span>  }</div>
<div class="line"><span class="lineno">  857</span>  <span class="keywordflow">while</span>(<a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>() != 0xfe);</div>
<div class="line"><span class="lineno">  858</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i;</div>
<div class="line"><span class="lineno">  859</span>  <span class="keywordflow">for</span>(i = 0; i &lt; 18; ++i) {</div>
<div class="line"><span class="lineno">  860</span>    info[i]= <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  861</span>  }</div>
<div class="line"><span class="lineno">  862</span> </div>
<div class="line"><span class="lineno">  863</span>  <span class="comment">/* read csd register */</span></div>
<div class="line"><span class="lineno">  864</span>  <span class="keywordflow">if</span>(<a class="code hl_function" href="#ga956fc6f9ea12bf3c42fe5d3b472e61a8">sd_raw_send_command_r1</a>(<a class="code hl_define" href="sd__card_8h.html#a039c816f90fba6c89d09980c5c1cb888">CMD_SEND_CSD</a>, 0)) {</div>
<div class="line"><span class="lineno">  865</span>    unselect_card();</div>
<div class="line"><span class="lineno">  866</span>    <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno">  867</span>  }</div>
<div class="line"><span class="lineno">  868</span>  <span class="keywordflow">while</span>(<a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>() != 0xfe);</div>
<div class="line"><span class="lineno">  869</span>  <span class="keywordflow">for</span>(i = 0; i &lt; 18; ++i) {</div>
<div class="line"><span class="lineno">  870</span>    info[i+18]=<a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  871</span>  }</div>
<div class="line"><span class="lineno">  872</span> </div>
<div class="line"><span class="lineno">  873</span>  unselect_card();</div>
<div class="line"><span class="lineno">  874</span> </div>
<div class="line"><span class="lineno">  875</span>  <span class="keywordflow">return</span> 3;</div>
<div class="line"><span class="lineno">  876</span>}</div>
<div class="ttc" id="agroup__sd__raw_html_ga75085da84454931647328e80f6bdea7c"><div class="ttname"><a href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a></div><div class="ttdeci">static unsigned char sd_raw_rec_byte(void)</div><div class="ttdoc">Receives a raw byte from the memory card.</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00297">sd_card.h:297</a></div></div>
<div class="ttc" id="agroup__sd__raw_html_ga956fc6f9ea12bf3c42fe5d3b472e61a8"><div class="ttname"><a href="#ga956fc6f9ea12bf3c42fe5d3b472e61a8">sd_raw_send_command_r1</a></div><div class="ttdeci">static unsigned char sd_raw_send_command_r1(unsigned char command, unsigned int arg)</div><div class="ttdoc">Send a command to the memory card which responses with a R1 response.</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00314">sd_card.h:314</a></div></div>
<div class="ttc" id="agroup__sd__raw_html_gad8a7de96505d870f59afa5168b3e73c0"><div class="ttname"><a href="#gad8a7de96505d870f59afa5168b3e73c0">sd_raw_available</a></div><div class="ttdeci">unsigned char sd_raw_available()</div><div class="ttdoc">Checks wether a memory card is located in the slot.</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00255">sd_card.h:255</a></div></div>
<div class="ttc" id="asd__card_8h_html_a039c816f90fba6c89d09980c5c1cb888"><div class="ttname"><a href="sd__card_8h.html#a039c816f90fba6c89d09980c5c1cb888">CMD_SEND_CSD</a></div><div class="ttdeci">#define CMD_SEND_CSD</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00046">sd_card.h:46</a></div></div>
<div class="ttc" id="asd__card_8h_html_a69e5cfa724af0af3e97d69005a2b588d"><div class="ttname"><a href="sd__card_8h.html#a69e5cfa724af0af3e97d69005a2b588d">CMD_SEND_CID</a></div><div class="ttdeci">#define CMD_SEND_CID</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00048">sd_card.h:48</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__sd__raw_ga0cd21cf9a326b8cfc9b9d9f35fa57423_cgraph.png" border="0" usemap="#agroup__sd__raw_ga0cd21cf9a326b8cfc9b9d9f35fa57423_cgraph" alt=""/></div>
<map name="agroup__sd__raw_ga0cd21cf9a326b8cfc9b9d9f35fa57423_cgraph" id="agroup__sd__raw_ga0cd21cf9a326b8cfc9b9d9f35fa57423_cgraph">
<area shape="rect" title=" " alt="" coords="5,56,145,83"/>
<area shape="rect" href="group__sd__raw.html#gad8a7de96505d870f59afa5168b3e73c0" title="Checks wether a memory card is located in the slot." alt="" coords="223,5,342,32"/>
<area shape="poly" title=" " alt="" coords="132,53,209,34,210,39,133,58"/>
<area shape="rect" href="group__sd__raw.html#ga75085da84454931647328e80f6bdea7c" title="Receives a raw byte from the memory card." alt="" coords="425,56,544,83"/>
<area shape="poly" title=" " alt="" coords="145,67,409,67,409,72,145,72"/>
<area shape="rect" href="group__sd__raw.html#ga956fc6f9ea12bf3c42fe5d3b472e61a8" title="Send a command to the memory card which responses with a R1 response." alt="" coords="193,107,372,133"/>
<area shape="poly" title=" " alt="" coords="133,81,210,100,209,105,132,86"/>
<area shape="poly" title=" " alt="" coords="338,103,413,84,414,90,339,109"/>
<area shape="rect" href="group__sd__raw.html#ga157908b0533eb72368d320eb697f0cc0" title="Sends a raw byte to the memory card." alt="" coords="420,107,549,133"/>
<area shape="poly" title=" " alt="" coords="372,117,404,117,404,123,372,123"/>
</map>
</div>

</div>
</div>
<a id="ga16b73f2f45ee2f1c647d6bef916eb198" name="ga16b73f2f45ee2f1c647d6bef916eb198"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga16b73f2f45ee2f1c647d6bef916eb198">&#9670;&#160;</a></span>sd_raw_get_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char sd_raw_get_info </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsd__raw__info.html">sd_raw_info</a> *</td>          <td class="paramname"><span class="paramname"><em>info</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads informational data from the card. </p>
<p>This function reads and returns the card's registers containing manufacturing and status information.</p>
<dl class="section note"><dt>Note</dt><dd>: The information retrieved by this function is not required in any way to operate on the card, but it might be nice to display some of the data to the user.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">info</td><td>A pointer to the structure into which to save the information. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, 1 on success. </dd></dl>

<p class="definition">Definition at line <a class="el" href="sd__card_8h_source.html#l00735">735</a> of file <a class="el" href="sd__card_8h_source.html">sd_card.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  736</span>{</div>
<div class="line"><span class="lineno">  737</span>    <span class="keywordflow">if</span>(!info || !<a class="code hl_function" href="#gad8a7de96505d870f59afa5168b3e73c0">sd_raw_available</a>())</div>
<div class="line"><span class="lineno">  738</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  739</span> </div>
<div class="line"><span class="lineno">  740</span>    memset(info, 0, <span class="keyword">sizeof</span>(*info));</div>
<div class="line"><span class="lineno">  741</span> </div>
<div class="line"><span class="lineno">  742</span>    select_card();</div>
<div class="line"><span class="lineno">  743</span> </div>
<div class="line"><span class="lineno">  744</span>    <span class="comment">/* read cid register */</span></div>
<div class="line"><span class="lineno">  745</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="#ga956fc6f9ea12bf3c42fe5d3b472e61a8">sd_raw_send_command_r1</a>(<a class="code hl_define" href="sd__card_8h.html#a69e5cfa724af0af3e97d69005a2b588d">CMD_SEND_CID</a>, 0))</div>
<div class="line"><span class="lineno">  746</span>    {</div>
<div class="line"><span class="lineno">  747</span>        unselect_card();</div>
<div class="line"><span class="lineno">  748</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  749</span>    }</div>
<div class="line"><span class="lineno">  750</span>    <span class="keywordflow">while</span>(<a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>() != 0xfe);</div>
<div class="line"><span class="lineno">  751</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i;</div>
<div class="line"><span class="lineno">  752</span>    <span class="keywordflow">for</span>(i = 0; i &lt; 18; ++i)</div>
<div class="line"><span class="lineno">  753</span>    {</div>
<div class="line"><span class="lineno">  754</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> b = <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  755</span> </div>
<div class="line"><span class="lineno">  756</span>        <span class="keywordflow">switch</span>(i)</div>
<div class="line"><span class="lineno">  757</span>        {</div>
<div class="line"><span class="lineno">  758</span>            <span class="keywordflow">case</span> 0:</div>
<div class="line"><span class="lineno">  759</span>                info-&gt;<a class="code hl_variable" href="structsd__raw__info.html#a787cbb55444be04f7f41566d14b4d4c3">manufacturer</a> = b;</div>
<div class="line"><span class="lineno">  760</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  761</span>            <span class="keywordflow">case</span> 1:</div>
<div class="line"><span class="lineno">  762</span>            <span class="keywordflow">case</span> 2:</div>
<div class="line"><span class="lineno">  763</span>                info-&gt;<a class="code hl_variable" href="structsd__raw__info.html#a6a711989107233a23f19b22b0b1ae922">oem</a>[i - 1] = b;</div>
<div class="line"><span class="lineno">  764</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  765</span>            <span class="keywordflow">case</span> 3:</div>
<div class="line"><span class="lineno">  766</span>            <span class="keywordflow">case</span> 4:</div>
<div class="line"><span class="lineno">  767</span>            <span class="keywordflow">case</span> 5:</div>
<div class="line"><span class="lineno">  768</span>            <span class="keywordflow">case</span> 6:</div>
<div class="line"><span class="lineno">  769</span>            <span class="keywordflow">case</span> 7:</div>
<div class="line"><span class="lineno">  770</span>                info-&gt;<a class="code hl_variable" href="structsd__raw__info.html#a3b855f43fb0cc38560627db22d2f92e4">product</a>[i - 3] = b;</div>
<div class="line"><span class="lineno">  771</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  772</span>            <span class="keywordflow">case</span> 8:</div>
<div class="line"><span class="lineno">  773</span>                info-&gt;<a class="code hl_variable" href="structsd__raw__info.html#af1262d99673017a49f874613056bb168">revision</a> = b;</div>
<div class="line"><span class="lineno">  774</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  775</span>            <span class="keywordflow">case</span> 9:</div>
<div class="line"><span class="lineno">  776</span>            <span class="keywordflow">case</span> 10:</div>
<div class="line"><span class="lineno">  777</span>            <span class="keywordflow">case</span> 11:</div>
<div class="line"><span class="lineno">  778</span>            <span class="keywordflow">case</span> 12:</div>
<div class="line"><span class="lineno">  779</span>                info-&gt;<a class="code hl_variable" href="structsd__raw__info.html#aa9df98b121956b2ac8c78b20f98ff3e7">serial</a> |= (<span class="keywordtype">unsigned</span> int) b &lt;&lt; ((12 - i) * 8);</div>
<div class="line"><span class="lineno">  780</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  781</span>            <span class="keywordflow">case</span> 13:</div>
<div class="line"><span class="lineno">  782</span>                info-&gt;<a class="code hl_variable" href="structsd__raw__info.html#af70f2a9e2272815652fa02ef24761cbb">manufacturing_year</a> = b &lt;&lt; 4;</div>
<div class="line"><span class="lineno">  783</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  784</span>            <span class="keywordflow">case</span> 14:</div>
<div class="line"><span class="lineno">  785</span>                info-&gt;<a class="code hl_variable" href="structsd__raw__info.html#af70f2a9e2272815652fa02ef24761cbb">manufacturing_year</a> |= b &gt;&gt; 4;</div>
<div class="line"><span class="lineno">  786</span>                info-&gt;<a class="code hl_variable" href="structsd__raw__info.html#a6304026327ed84499e1439fbc0dca168">manufacturing_month</a> = b &amp; 0x0f;</div>
<div class="line"><span class="lineno">  787</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  788</span>        }</div>
<div class="line"><span class="lineno">  789</span>    }</div>
<div class="line"><span class="lineno">  790</span> </div>
<div class="line"><span class="lineno">  791</span>    <span class="comment">/* read csd register */</span></div>
<div class="line"><span class="lineno">  792</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> csd_read_bl_len = 0;</div>
<div class="line"><span class="lineno">  793</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> csd_c_size_mult = 0;</div>
<div class="line"><span class="lineno">  794</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> csd_c_size = 0;</div>
<div class="line"><span class="lineno">  795</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="#ga956fc6f9ea12bf3c42fe5d3b472e61a8">sd_raw_send_command_r1</a>(<a class="code hl_define" href="sd__card_8h.html#a039c816f90fba6c89d09980c5c1cb888">CMD_SEND_CSD</a>, 0))</div>
<div class="line"><span class="lineno">  796</span>    {</div>
<div class="line"><span class="lineno">  797</span>        unselect_card();</div>
<div class="line"><span class="lineno">  798</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  799</span>    }</div>
<div class="line"><span class="lineno">  800</span>    <span class="keywordflow">while</span>(<a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>() != 0xfe);</div>
<div class="line"><span class="lineno">  801</span>    <span class="keywordflow">for</span>(i = 0; i &lt; 18; ++i)</div>
<div class="line"><span class="lineno">  802</span>    {</div>
<div class="line"><span class="lineno">  803</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> b = <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  804</span> </div>
<div class="line"><span class="lineno">  805</span>        <span class="keywordflow">switch</span>(i)</div>
<div class="line"><span class="lineno">  806</span>        {</div>
<div class="line"><span class="lineno">  807</span>            <span class="keywordflow">case</span> 5:</div>
<div class="line"><span class="lineno">  808</span>                csd_read_bl_len = b &amp; 0x0f;</div>
<div class="line"><span class="lineno">  809</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  810</span>            <span class="keywordflow">case</span> 6:</div>
<div class="line"><span class="lineno">  811</span>                csd_c_size = (<span class="keywordtype">unsigned</span> short) (b &amp; 0x03) &lt;&lt; 8;</div>
<div class="line"><span class="lineno">  812</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  813</span>            <span class="keywordflow">case</span> 7:</div>
<div class="line"><span class="lineno">  814</span>                csd_c_size |= b;</div>
<div class="line"><span class="lineno">  815</span>                csd_c_size &lt;&lt;= 2;</div>
<div class="line"><span class="lineno">  816</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  817</span>            <span class="keywordflow">case</span> 8:</div>
<div class="line"><span class="lineno">  818</span>                csd_c_size |= b &gt;&gt; 6;</div>
<div class="line"><span class="lineno">  819</span>                ++csd_c_size;</div>
<div class="line"><span class="lineno">  820</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  821</span>            <span class="keywordflow">case</span> 9:</div>
<div class="line"><span class="lineno">  822</span>                csd_c_size_mult = (b &amp; 0x03) &lt;&lt; 1;</div>
<div class="line"><span class="lineno">  823</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  824</span>            <span class="keywordflow">case</span> 10:</div>
<div class="line"><span class="lineno">  825</span>                csd_c_size_mult |= b &gt;&gt; 7;</div>
<div class="line"><span class="lineno">  826</span> </div>
<div class="line"><span class="lineno">  827</span>                info-&gt;<a class="code hl_variable" href="structsd__raw__info.html#a72f7c0369e33b0f900bd00cb20497aaa">capacity</a> = (<span class="keywordtype">unsigned</span> int) csd_c_size &lt;&lt; (csd_c_size_mult + csd_read_bl_len + 2);</div>
<div class="line"><span class="lineno">  828</span> </div>
<div class="line"><span class="lineno">  829</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  830</span>            <span class="keywordflow">case</span> 14:</div>
<div class="line"><span class="lineno">  831</span>                <span class="keywordflow">if</span>(b &amp; 0x40)</div>
<div class="line"><span class="lineno">  832</span>                    info-&gt;<a class="code hl_variable" href="structsd__raw__info.html#a8dd96ab7ceaaf9b038e5e6c5cf99c28e">flag_copy</a> = 1;</div>
<div class="line"><span class="lineno">  833</span>                <span class="keywordflow">if</span>(b &amp; 0x20)</div>
<div class="line"><span class="lineno">  834</span>                    info-&gt;<a class="code hl_variable" href="structsd__raw__info.html#a6e0146444c80a709513286abeb42b3e5">flag_write_protect</a> = 1;</div>
<div class="line"><span class="lineno">  835</span>                <span class="keywordflow">if</span>(b &amp; 0x10)</div>
<div class="line"><span class="lineno">  836</span>                    info-&gt;<a class="code hl_variable" href="structsd__raw__info.html#ac7bf7c688c3326f57650ff3b70cb19ef">flag_write_protect_temp</a> = 1;</div>
<div class="line"><span class="lineno">  837</span>                info-&gt;<a class="code hl_variable" href="structsd__raw__info.html#a49d1391c8f60cc96b6fcc206a4d6e5d1">format</a> = (b &amp; 0x0c) &gt;&gt; 2;</div>
<div class="line"><span class="lineno">  838</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  839</span>        }</div>
<div class="line"><span class="lineno">  840</span>    }</div>
<div class="line"><span class="lineno">  841</span> </div>
<div class="line"><span class="lineno">  842</span>    unselect_card();</div>
<div class="line"><span class="lineno">  843</span> </div>
<div class="line"><span class="lineno">  844</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  845</span>}</div>
<div class="ttc" id="astructsd__raw__info_html_a3b855f43fb0cc38560627db22d2f92e4"><div class="ttname"><a href="structsd__raw__info.html#a3b855f43fb0cc38560627db22d2f92e4">sd_raw_info::product</a></div><div class="ttdeci">unsigned char product[6]</div><div class="ttdoc">A product name.</div><div class="ttdef"><b>Definition</b> <a href="sd__card__header_8h_source.html#l00059">sd_card_header.h:59</a></div></div>
<div class="ttc" id="astructsd__raw__info_html_a49d1391c8f60cc96b6fcc206a4d6e5d1"><div class="ttname"><a href="structsd__raw__info.html#a49d1391c8f60cc96b6fcc206a4d6e5d1">sd_raw_info::format</a></div><div class="ttdeci">unsigned char format</div><div class="ttdoc">The card's data layout.</div><div class="ttdef"><b>Definition</b> <a href="sd__card__header_8h_source.html#l00111">sd_card_header.h:111</a></div></div>
<div class="ttc" id="astructsd__raw__info_html_a6304026327ed84499e1439fbc0dca168"><div class="ttname"><a href="structsd__raw__info.html#a6304026327ed84499e1439fbc0dca168">sd_raw_info::manufacturing_month</a></div><div class="ttdeci">unsigned char manufacturing_month</div><div class="ttdoc">The month of manufacturing.</div><div class="ttdef"><b>Definition</b> <a href="sd__card__header_8h_source.html#l00079">sd_card_header.h:79</a></div></div>
<div class="ttc" id="astructsd__raw__info_html_a6a711989107233a23f19b22b0b1ae922"><div class="ttname"><a href="structsd__raw__info.html#a6a711989107233a23f19b22b0b1ae922">sd_raw_info::oem</a></div><div class="ttdeci">unsigned char oem[3]</div><div class="ttdoc">A string describing the card's OEM or content, globally assigned by the SD card organization.</div><div class="ttdef"><b>Definition</b> <a href="sd__card__header_8h_source.html#l00055">sd_card_header.h:55</a></div></div>
<div class="ttc" id="astructsd__raw__info_html_a6e0146444c80a709513286abeb42b3e5"><div class="ttname"><a href="structsd__raw__info.html#a6e0146444c80a709513286abeb42b3e5">sd_raw_info::flag_write_protect</a></div><div class="ttdeci">unsigned char flag_write_protect</div><div class="ttdoc">Defines wether the card's content is write-protected.</div><div class="ttdef"><b>Definition</b> <a href="sd__card__header_8h_source.html#l00096">sd_card_header.h:96</a></div></div>
<div class="ttc" id="astructsd__raw__info_html_a72f7c0369e33b0f900bd00cb20497aaa"><div class="ttname"><a href="structsd__raw__info.html#a72f7c0369e33b0f900bd00cb20497aaa">sd_raw_info::capacity</a></div><div class="ttdeci">unsigned int capacity</div><div class="ttdoc">The card's total capacity in bytes.</div><div class="ttdef"><b>Definition</b> <a href="sd__card__header_8h_source.html#l00083">sd_card_header.h:83</a></div></div>
<div class="ttc" id="astructsd__raw__info_html_a787cbb55444be04f7f41566d14b4d4c3"><div class="ttname"><a href="structsd__raw__info.html#a787cbb55444be04f7f41566d14b4d4c3">sd_raw_info::manufacturer</a></div><div class="ttdeci">unsigned char manufacturer</div><div class="ttdoc">A manufacturer code globally assigned by the SD card organization.</div><div class="ttdef"><b>Definition</b> <a href="sd__card__header_8h_source.html#l00051">sd_card_header.h:51</a></div></div>
<div class="ttc" id="astructsd__raw__info_html_a8dd96ab7ceaaf9b038e5e6c5cf99c28e"><div class="ttname"><a href="structsd__raw__info.html#a8dd96ab7ceaaf9b038e5e6c5cf99c28e">sd_raw_info::flag_copy</a></div><div class="ttdeci">unsigned char flag_copy</div><div class="ttdoc">Defines wether the card's content is original or copied.</div><div class="ttdef"><b>Definition</b> <a href="sd__card__header_8h_source.html#l00089">sd_card_header.h:89</a></div></div>
<div class="ttc" id="astructsd__raw__info_html_aa9df98b121956b2ac8c78b20f98ff3e7"><div class="ttname"><a href="structsd__raw__info.html#aa9df98b121956b2ac8c78b20f98ff3e7">sd_raw_info::serial</a></div><div class="ttdeci">unsigned int serial</div><div class="ttdoc">A serial number assigned by the manufacturer.</div><div class="ttdef"><b>Definition</b> <a href="sd__card__header_8h_source.html#l00069">sd_card_header.h:69</a></div></div>
<div class="ttc" id="astructsd__raw__info_html_ac7bf7c688c3326f57650ff3b70cb19ef"><div class="ttname"><a href="structsd__raw__info.html#ac7bf7c688c3326f57650ff3b70cb19ef">sd_raw_info::flag_write_protect_temp</a></div><div class="ttdeci">unsigned char flag_write_protect_temp</div><div class="ttdoc">Defines wether the card's content is temporarily write-protected.</div><div class="ttdef"><b>Definition</b> <a href="sd__card__header_8h_source.html#l00103">sd_card_header.h:103</a></div></div>
<div class="ttc" id="astructsd__raw__info_html_af1262d99673017a49f874613056bb168"><div class="ttname"><a href="structsd__raw__info.html#af1262d99673017a49f874613056bb168">sd_raw_info::revision</a></div><div class="ttdeci">unsigned char revision</div><div class="ttdoc">The card's revision, coded in packed BCD.</div><div class="ttdef"><b>Definition</b> <a href="sd__card__header_8h_source.html#l00065">sd_card_header.h:65</a></div></div>
<div class="ttc" id="astructsd__raw__info_html_af70f2a9e2272815652fa02ef24761cbb"><div class="ttname"><a href="structsd__raw__info.html#af70f2a9e2272815652fa02ef24761cbb">sd_raw_info::manufacturing_year</a></div><div class="ttdeci">unsigned char manufacturing_year</div><div class="ttdoc">The year of manufacturing.</div><div class="ttdef"><b>Definition</b> <a href="sd__card__header_8h_source.html#l00075">sd_card_header.h:75</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__sd__raw_ga16b73f2f45ee2f1c647d6bef916eb198_cgraph.png" border="0" usemap="#agroup__sd__raw_ga16b73f2f45ee2f1c647d6bef916eb198_cgraph" alt=""/></div>
<map name="agroup__sd__raw_ga16b73f2f45ee2f1c647d6bef916eb198_cgraph" id="agroup__sd__raw_ga16b73f2f45ee2f1c647d6bef916eb198_cgraph">
<area shape="rect" title="Reads informational data from the card." alt="" coords="5,56,120,83"/>
<area shape="rect" href="group__sd__raw.html#gad8a7de96505d870f59afa5168b3e73c0" title="Checks wether a memory card is located in the slot." alt="" coords="198,5,317,32"/>
<area shape="poly" title=" " alt="" coords="116,53,188,34,189,39,118,58"/>
<area shape="rect" href="group__sd__raw.html#ga75085da84454931647328e80f6bdea7c" title="Receives a raw byte from the memory card." alt="" coords="400,56,519,83"/>
<area shape="poly" title=" " alt="" coords="120,67,385,67,385,72,120,72"/>
<area shape="rect" href="group__sd__raw.html#ga956fc6f9ea12bf3c42fe5d3b472e61a8" title="Send a command to the memory card which responses with a R1 response." alt="" coords="168,107,347,133"/>
<area shape="poly" title=" " alt="" coords="118,81,189,100,188,105,116,86"/>
<area shape="poly" title=" " alt="" coords="313,103,388,84,389,90,314,109"/>
<area shape="rect" href="group__sd__raw.html#ga157908b0533eb72368d320eb697f0cc0" title="Sends a raw byte to the memory card." alt="" coords="395,107,524,133"/>
<area shape="poly" title=" " alt="" coords="347,117,379,117,379,123,347,123"/>
</map>
</div>

</div>
</div>
<a id="gac2e6d0ba10cef8f72391d35b4aabf385" name="gac2e6d0ba10cef8f72391d35b4aabf385"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac2e6d0ba10cef8f72391d35b4aabf385">&#9670;&#160;</a></span>sd_raw_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char sd_raw_init </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes memory card communication. </p>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, 1 on success. </dd></dl>

<p class="definition">Definition at line <a class="el" href="sd__card_8h_source.html#l00159">159</a> of file <a class="el" href="sd__card_8h_source.html">sd_card.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  160</span>{</div>
<div class="line"><span class="lineno">  161</span>    <span class="comment">/* enable inputs for reading card status */</span></div>
<div class="line"><span class="lineno">  162</span>    <span class="comment">/*    configure_pin_available();*/</span></div>
<div class="line"><span class="lineno">  163</span>    <span class="comment">/*    configure_pin_locked();*/</span></div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>    <span class="comment">/* enable outputs for MOSI, SCK, SS, input for MISO */</span></div>
<div class="line"><span class="lineno">  166</span>    configure_pin_ss();</div>
<div class="line"><span class="lineno">  167</span>    configure_pin_mosi();</div>
<div class="line"><span class="lineno">  168</span>    configure_pin_miso();</div>
<div class="line"><span class="lineno">  169</span>    configure_pin_sck();</div>
<div class="line"><span class="lineno">  170</span> </div>
<div class="line"><span class="lineno">  171</span>    unselect_card();</div>
<div class="line"><span class="lineno">  172</span> </div>
<div class="line"><span class="lineno">  173</span>    <span class="comment">/* initialize SPI with lowest frequency; max. 400kHz during identification mode of card */</span></div>
<div class="line"><span class="lineno">  174</span>    S0SPCCR = 150;  <span class="comment">/* Set frequency to 400kHz */</span></div>
<div class="line"><span class="lineno">  175</span>    S0SPCR = 0x38;</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span> </div>
<div class="line"><span class="lineno">  178</span>    <span class="comment">/* initialization procedure */</span></div>
<div class="line"><span class="lineno">  179</span> </div>
<div class="line"><span class="lineno">  180</span>    <span class="keywordflow">if</span>(!<a class="code hl_function" href="#gad8a7de96505d870f59afa5168b3e73c0">sd_raw_available</a>()) {</div>
<div class="line"><span class="lineno">  181</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  182</span>    }</div>
<div class="line"><span class="lineno">  183</span>    configure_pin_ss();</div>
<div class="line"><span class="lineno">  184</span>    unselect_card();</div>
<div class="line"><span class="lineno">  185</span> </div>
<div class="line"><span class="lineno">  186</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> i;</div>
<div class="line"><span class="lineno">  187</span>    <span class="comment">/* card needs 74 cycles minimum to start up */</span></div>
<div class="line"><span class="lineno">  188</span>    <span class="keywordflow">for</span>(i = 0; i &lt; 10; ++i) {</div>
<div class="line"><span class="lineno">  189</span>        <span class="comment">/* wait 8 clock cycles */</span></div>
<div class="line"><span class="lineno">  190</span>        <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  191</span>    }</div>
<div class="line"><span class="lineno">  192</span> </div>
<div class="line"><span class="lineno">  193</span>    <span class="comment">/* address card */</span></div>
<div class="line"><span class="lineno">  194</span>    select_card();</div>
<div class="line"><span class="lineno">  195</span> </div>
<div class="line"><span class="lineno">  196</span>    <span class="comment">/* reset card */</span></div>
<div class="line"><span class="lineno">  197</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> response;</div>
<div class="line"><span class="lineno">  198</span>    <span class="keywordflow">for</span>(i = 0; ; ++i)</div>
<div class="line"><span class="lineno">  199</span>    {</div>
<div class="line"><span class="lineno">  200</span>        response = <a class="code hl_function" href="#ga956fc6f9ea12bf3c42fe5d3b472e61a8">sd_raw_send_command_r1</a>(<a class="code hl_define" href="sd__card_8h.html#ae3dd15ec52cbd1ef2ce6e20e39fd6efb">CMD_GO_IDLE_STATE</a>, 0);</div>
<div class="line"><span class="lineno">  201</span>        <span class="keywordflow">if</span>(response == (1 &lt;&lt; <a class="code hl_define" href="sd__card_8h.html#a7adb3673fe75b9397a1f241533e3f08a">R1_IDLE_STATE</a>))</div>
<div class="line"><span class="lineno">  202</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  203</span> </div>
<div class="line"><span class="lineno">  204</span>        <span class="keywordflow">if</span>(i == 0x1ff) {</div>
<div class="line"><span class="lineno">  205</span>            unselect_card();</div>
<div class="line"><span class="lineno">  206</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  207</span>        }</div>
<div class="line"><span class="lineno">  208</span>    }</div>
<div class="line"><span class="lineno">  209</span> </div>
<div class="line"><span class="lineno">  210</span>    <span class="comment">/* wait for card to get ready */</span></div>
<div class="line"><span class="lineno">  211</span>    <span class="keywordflow">for</span>(i = 0; ; ++i)</div>
<div class="line"><span class="lineno">  212</span>    {</div>
<div class="line"><span class="lineno">  213</span>        response = <a class="code hl_function" href="#ga956fc6f9ea12bf3c42fe5d3b472e61a8">sd_raw_send_command_r1</a>(<a class="code hl_define" href="sd__card_8h.html#ae059745768a7fde0832a1dea6a623ab0">CMD_SEND_OP_COND</a>, 0);</div>
<div class="line"><span class="lineno">  214</span>        <span class="keywordflow">if</span>(!(response &amp; (1 &lt;&lt; <a class="code hl_define" href="sd__card_8h.html#a7adb3673fe75b9397a1f241533e3f08a">R1_IDLE_STATE</a>)))</div>
<div class="line"><span class="lineno">  215</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>        <span class="keywordflow">if</span>(i == 0x7fff) {</div>
<div class="line"><span class="lineno">  218</span>            unselect_card();</div>
<div class="line"><span class="lineno">  219</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  220</span>        }</div>
<div class="line"><span class="lineno">  221</span>    }</div>
<div class="line"><span class="lineno">  222</span> </div>
<div class="line"><span class="lineno">  223</span>    <span class="comment">/* set block size to 512 bytes */</span></div>
<div class="line"><span class="lineno">  224</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="#ga956fc6f9ea12bf3c42fe5d3b472e61a8">sd_raw_send_command_r1</a>(<a class="code hl_define" href="sd__card_8h.html#acc98caadb00bb27cee9c6037193adb68">CMD_SET_BLOCKLEN</a>, 512)) {</div>
<div class="line"><span class="lineno">  225</span>        unselect_card();</div>
<div class="line"><span class="lineno">  226</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  227</span>    }</div>
<div class="line"><span class="lineno">  228</span> </div>
<div class="line"><span class="lineno">  229</span>    <span class="comment">/* deaddress card */</span></div>
<div class="line"><span class="lineno">  230</span>    unselect_card();</div>
<div class="line"><span class="lineno">  231</span> </div>
<div class="line"><span class="lineno">  232</span>    <span class="comment">/* switch to highest SPI frequency possible */</span></div>
<div class="line"><span class="lineno">  233</span>    S0SPCCR = 10; <span class="comment">/* ~1MHz-- potentially can be faster */</span></div>
<div class="line"><span class="lineno">  234</span> </div>
<div class="line"><span class="lineno">  235</span><span class="preprocessor">    #if !SD_RAW_SAVE_RAM</span></div>
<div class="line"><span class="lineno">  236</span>        <span class="comment">/* the first block is likely to be accessed first, so precache it here */</span></div>
<div class="line"><span class="lineno">  237</span>        <a class="code hl_variable" href="sd__card_8h.html#af7e0a319714313d4a1cbd2f45adda45d">raw_block_address</a> = 0xffffffff;</div>
<div class="line"><span class="lineno">  238</span><span class="preprocessor">        #if SD_RAW_WRITE_BUFFERING</span></div>
<div class="line"><span class="lineno">  239</span>        raw_block_written = 1;</div>
<div class="line"><span class="lineno">  240</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno">  241</span>    <span class="keywordflow">if</span>(!<a class="code hl_function" href="#ga7aa8ed58f08b39d21b778b66f3e6ce59">sd_raw_read</a>(0, <a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a>, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a>))) {</div>
<div class="line"><span class="lineno">  242</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  243</span>    }</div>
<div class="line"><span class="lineno">  244</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno">  245</span> </div>
<div class="line"><span class="lineno">  246</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  247</span>}</div>
<div class="ttc" id="agroup__sd__raw_html_ga7aa8ed58f08b39d21b778b66f3e6ce59"><div class="ttname"><a href="#ga7aa8ed58f08b39d21b778b66f3e6ce59">sd_raw_read</a></div><div class="ttdeci">unsigned char sd_raw_read(unsigned int offset, unsigned char *buffer, unsigned short length)</div><div class="ttdoc">Send a command to the memory card which responses with a R2 response.</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00390">sd_card.h:390</a></div></div>
<div class="ttc" id="asd__card_8h_html_a2b29b7ccaa3ad4ab2e60a1bf8d2abb39"><div class="ttname"><a href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a></div><div class="ttdeci">static unsigned char raw_block[512]</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00137">sd_card.h:137</a></div></div>
<div class="ttc" id="asd__card_8h_html_a7adb3673fe75b9397a1f241533e3f08a"><div class="ttname"><a href="sd__card_8h.html#a7adb3673fe75b9397a1f241533e3f08a">R1_IDLE_STATE</a></div><div class="ttdeci">#define R1_IDLE_STATE</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00094">sd_card.h:94</a></div></div>
<div class="ttc" id="asd__card_8h_html_acc98caadb00bb27cee9c6037193adb68"><div class="ttname"><a href="sd__card_8h.html#acc98caadb00bb27cee9c6037193adb68">CMD_SET_BLOCKLEN</a></div><div class="ttdeci">#define CMD_SET_BLOCKLEN</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00054">sd_card.h:54</a></div></div>
<div class="ttc" id="asd__card_8h_html_ae059745768a7fde0832a1dea6a623ab0"><div class="ttname"><a href="sd__card_8h.html#ae059745768a7fde0832a1dea6a623ab0">CMD_SEND_OP_COND</a></div><div class="ttdeci">#define CMD_SEND_OP_COND</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00044">sd_card.h:44</a></div></div>
<div class="ttc" id="asd__card_8h_html_ae3dd15ec52cbd1ef2ce6e20e39fd6efb"><div class="ttname"><a href="sd__card_8h.html#ae3dd15ec52cbd1ef2ce6e20e39fd6efb">CMD_GO_IDLE_STATE</a></div><div class="ttdeci">#define CMD_GO_IDLE_STATE</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00042">sd_card.h:42</a></div></div>
<div class="ttc" id="asd__card_8h_html_af7e0a319714313d4a1cbd2f45adda45d"><div class="ttname"><a href="sd__card_8h.html#af7e0a319714313d4a1cbd2f45adda45d">raw_block_address</a></div><div class="ttdeci">static unsigned int raw_block_address</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00139">sd_card.h:139</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__sd__raw_gac2e6d0ba10cef8f72391d35b4aabf385_cgraph.png" border="0" usemap="#agroup__sd__raw_gac2e6d0ba10cef8f72391d35b4aabf385_cgraph" alt=""/></div>
<map name="agroup__sd__raw_gac2e6d0ba10cef8f72391d35b4aabf385_cgraph" id="agroup__sd__raw_gac2e6d0ba10cef8f72391d35b4aabf385_cgraph">
<area shape="rect" title="Initializes memory card communication." alt="" coords="5,119,92,145"/>
<area shape="rect" href="group__sd__raw.html#gad8a7de96505d870f59afa5168b3e73c0" title="Checks wether a memory card is located in the slot." alt="" coords="140,5,258,32"/>
<area shape="poly" title=" " alt="" coords="61,116,95,84,138,49,155,38,158,42,141,53,98,88,65,120"/>
<area shape="rect" href="group__sd__raw.html#ga7aa8ed58f08b39d21b778b66f3e6ce59" title="Send a command to the memory card which responses with a R2 response." alt="" coords="152,181,246,208"/>
<area shape="poly" title=" " alt="" coords="84,143,152,172,150,177,82,148"/>
<area shape="rect" href="group__sd__raw.html#ga75085da84454931647328e80f6bdea7c" title="Receives a raw byte from the memory card." alt="" coords="683,195,802,221"/>
<area shape="poly" title=" " alt="" coords="61,144,93,182,115,202,141,218,211,243,285,257,361,263,435,262,507,256,573,246,679,223,680,228,574,252,508,261,436,268,361,269,285,263,210,248,139,222,112,206,89,186,57,147"/>
<area shape="rect" href="group__sd__raw.html#ga956fc6f9ea12bf3c42fe5d3b472e61a8" title="Send a command to the memory card which responses with a R1 response." alt="" coords="450,80,630,107"/>
<area shape="poly" title=" " alt="" coords="92,126,435,99,435,104,92,131"/>
<area shape="poly" title=" " alt="" coords="247,206,306,217,404,224,501,224,667,214,667,219,501,230,403,230,306,223,246,211"/>
<area shape="poly" title=" " alt="" coords="225,178,305,143,374,123,441,108,442,113,375,128,307,148,227,183"/>
<area shape="rect" href="group__sd__raw.html#ga70e84e3345f19d2b5eecb9f665b37e0d" title="Writes raw data to the card." alt="" coords="306,181,402,208"/>
<area shape="poly" title=" " alt="" coords="246,200,291,201,291,206,246,206"/>
<area shape="poly" title=" " alt="" coords="567,105,705,184,702,189,564,109"/>
<area shape="rect" href="group__sd__raw.html#ga157908b0533eb72368d320eb697f0cc0" title="Sends a raw byte to the memory card." alt="" coords="678,119,807,145"/>
<area shape="poly" title=" " alt="" coords="614,105,663,114,662,119,613,110"/>
<area shape="poly" title=" " alt="" coords="306,189,261,188,261,183,306,184"/>
<area shape="poly" title=" " alt="" coords="403,194,668,203,668,208,403,199"/>
<area shape="poly" title=" " alt="" coords="370,179,405,151,449,123,477,110,479,115,452,128,408,156,373,183"/>
<area shape="poly" title=" " alt="" coords="402,184,662,142,663,147,403,190"/>
<area shape="poly" title=" " alt="" coords="327,182,322,173,326,163,337,157,354,155,373,157,383,164,380,168,371,162,354,160,338,162,330,167,328,172,332,180"/>
</map>
</div>

</div>
</div>
<a id="ga3b5607bd24b1d86cb597e3ac55fa0ab3" name="ga3b5607bd24b1d86cb597e3ac55fa0ab3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3b5607bd24b1d86cb597e3ac55fa0ab3">&#9670;&#160;</a></span>sd_raw_locked()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char sd_raw_locked </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks wether the memory card is locked for write access. </p>
<dl class="section return"><dt>Returns</dt><dd>1 if the card is locked, 0 if it is not. </dd></dl>

<p class="definition">Definition at line <a class="el" href="sd__card_8h_source.html#l00271">271</a> of file <a class="el" href="sd__card_8h_source.html">sd_card.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  272</span>{</div>
<div class="line"><span class="lineno">  273</span>    <span class="keywordflow">return</span> get_pin_locked() == 0x00;</div>
<div class="line"><span class="lineno">  274</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ga7aa8ed58f08b39d21b778b66f3e6ce59" name="ga7aa8ed58f08b39d21b778b66f3e6ce59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7aa8ed58f08b39d21b778b66f3e6ce59">&#9670;&#160;</a></span>sd_raw_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char sd_raw_read </td>
          <td>(</td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>offset</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *</td>          <td class="paramname"><span class="paramname"><em>buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short</td>          <td class="paramname"><span class="paramname"><em>length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a command to the memory card which responses with a R2 response. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">command</td><td>The command to send. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">arg</td><td>The argument for command. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The command answer.</dd></dl>
<p>Reads raw data from the card.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">offset</td><td>The offset from which to read. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">buffer</td><td>The buffer into which to write the data. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>The number of bytes to read. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, 1 on success. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#ga0321ddf4d0234479fc90ee90d3e3cc40" title="Continuously reads units of interval bytes and calls a callback function.">sd_raw_read_interval</a>, <a class="el" href="#ga70e84e3345f19d2b5eecb9f665b37e0d" title="Writes raw data to the card.">sd_raw_write</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="sd__card_8h_source.html#l00390">390</a> of file <a class="el" href="sd__card_8h_source.html">sd_card.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  391</span>{</div>
<div class="line"><span class="lineno">  392</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> block_address;</div>
<div class="line"><span class="lineno">  393</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> block_offset;</div>
<div class="line"><span class="lineno">  394</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> read_length;</div>
<div class="line"><span class="lineno">  395</span>    <span class="keywordflow">while</span>(length &gt; 0)</div>
<div class="line"><span class="lineno">  396</span>    {</div>
<div class="line"><span class="lineno">  397</span>        <span class="comment">/* determine byte count to read at once */</span></div>
<div class="line"><span class="lineno">  398</span>        block_address = offset &amp; 0xfffffe00;</div>
<div class="line"><span class="lineno">  399</span>        block_offset = offset &amp; 0x01ff;</div>
<div class="line"><span class="lineno">  400</span>        read_length = 512 - block_offset; <span class="comment">/* read up to block border */</span></div>
<div class="line"><span class="lineno">  401</span>        <span class="keywordflow">if</span>(read_length &gt; length)</div>
<div class="line"><span class="lineno">  402</span>            read_length = length;</div>
<div class="line"><span class="lineno">  403</span> </div>
<div class="line"><span class="lineno">  404</span><span class="preprocessor">        #if !SD_RAW_SAVE_RAM</span></div>
<div class="line"><span class="lineno">  405</span>            <span class="comment">/* check if the requested data is cached */</span></div>
<div class="line"><span class="lineno">  406</span>            <span class="keywordflow">if</span>(block_address != <a class="code hl_variable" href="sd__card_8h.html#af7e0a319714313d4a1cbd2f45adda45d">raw_block_address</a>)</div>
<div class="line"><span class="lineno">  407</span><span class="preprocessor">            #endif</span></div>
<div class="line"><span class="lineno">  408</span>        {</div>
<div class="line"><span class="lineno">  409</span><span class="preprocessor">            #if SD_RAW_WRITE_BUFFERING</span></div>
<div class="line"><span class="lineno">  410</span>                <span class="keywordflow">if</span>(!raw_block_written)</div>
<div class="line"><span class="lineno">  411</span>                {</div>
<div class="line"><span class="lineno">  412</span>                    <span class="keywordflow">if</span>(!<a class="code hl_function" href="#ga70e84e3345f19d2b5eecb9f665b37e0d">sd_raw_write</a>(<a class="code hl_variable" href="sd__card_8h.html#af7e0a319714313d4a1cbd2f45adda45d">raw_block_address</a>, <a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a>, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a>)))</div>
<div class="line"><span class="lineno">  413</span>                        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  414</span>                }</div>
<div class="line"><span class="lineno">  415</span><span class="preprocessor">            #endif</span></div>
<div class="line"><span class="lineno">  416</span> </div>
<div class="line"><span class="lineno">  417</span>            <span class="comment">/* address card */</span></div>
<div class="line"><span class="lineno">  418</span>            select_card();</div>
<div class="line"><span class="lineno">  419</span> </div>
<div class="line"><span class="lineno">  420</span>            <span class="comment">/* send single block request */</span></div>
<div class="line"><span class="lineno">  421</span>            <span class="keywordflow">if</span>(<a class="code hl_function" href="#ga956fc6f9ea12bf3c42fe5d3b472e61a8">sd_raw_send_command_r1</a>(<a class="code hl_define" href="sd__card_8h.html#a6b4ea5767b225fa6bb958718b97e07e6">CMD_READ_SINGLE_BLOCK</a>, block_address))</div>
<div class="line"><span class="lineno">  422</span>            {</div>
<div class="line"><span class="lineno">  423</span>                unselect_card();</div>
<div class="line"><span class="lineno">  424</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  425</span>            }</div>
<div class="line"><span class="lineno">  426</span> </div>
<div class="line"><span class="lineno">  427</span>            <span class="comment">/* wait for data block (start byte 0xfe) */</span></div>
<div class="line"><span class="lineno">  428</span>            <span class="keywordflow">while</span>(<a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>() != 0xfe);</div>
<div class="line"><span class="lineno">  429</span> </div>
<div class="line"><span class="lineno">  430</span><span class="preprocessor">            #if SD_RAW_SAVE_RAM</span></div>
<div class="line"><span class="lineno">  431</span>                <span class="comment">/* read byte block */</span></div>
<div class="line"><span class="lineno">  432</span>                <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> read_to = block_offset + read_length;</div>
<div class="line"><span class="lineno">  433</span>                <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> i = 0; i &lt; 512; ++i)</div>
<div class="line"><span class="lineno">  434</span>                {</div>
<div class="line"><span class="lineno">  435</span>                    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> b = <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  436</span>                    <span class="keywordflow">if</span>(i &gt;= block_offset &amp;&amp; i &lt; read_to)</div>
<div class="line"><span class="lineno">  437</span>                        *buffer++ = b;</div>
<div class="line"><span class="lineno">  438</span>                }</div>
<div class="line"><span class="lineno">  439</span><span class="preprocessor">            #else</span></div>
<div class="line"><span class="lineno">  440</span>                <span class="comment">/* read byte block */</span></div>
<div class="line"><span class="lineno">  441</span>                <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* cache = <a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a>;</div>
<div class="line"><span class="lineno">  442</span>                <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> i;</div>
<div class="line"><span class="lineno">  443</span>                <span class="keywordflow">for</span>(i = 0; i &lt; 512; ++i)</div>
<div class="line"><span class="lineno">  444</span>                    *cache++ = <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  445</span>                <a class="code hl_variable" href="sd__card_8h.html#af7e0a319714313d4a1cbd2f45adda45d">raw_block_address</a> = block_address;</div>
<div class="line"><span class="lineno">  446</span>    </div>
<div class="line"><span class="lineno">  447</span>                memcpy(buffer, <a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a> + block_offset, read_length);</div>
<div class="line"><span class="lineno">  448</span>                buffer += read_length;</div>
<div class="line"><span class="lineno">  449</span><span class="preprocessor">            #endif</span></div>
<div class="line"><span class="lineno">  450</span> </div>
<div class="line"><span class="lineno">  451</span>            <span class="comment">/* read crc16 */</span></div>
<div class="line"><span class="lineno">  452</span>            <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  453</span>            <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  454</span> </div>
<div class="line"><span class="lineno">  455</span>            <span class="comment">/* deaddress card */</span></div>
<div class="line"><span class="lineno">  456</span>            unselect_card();</div>
<div class="line"><span class="lineno">  457</span> </div>
<div class="line"><span class="lineno">  458</span>            <span class="comment">/* let card some time to finish */</span></div>
<div class="line"><span class="lineno">  459</span>            <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  460</span>        }</div>
<div class="line"><span class="lineno">  461</span><span class="preprocessor">        #if !SD_RAW_SAVE_RAM</span></div>
<div class="line"><span class="lineno">  462</span>            <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  463</span>            {</div>
<div class="line"><span class="lineno">  464</span>                <span class="comment">/* use cached data */</span></div>
<div class="line"><span class="lineno">  465</span>                memcpy(buffer, <a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a> + block_offset, read_length);</div>
<div class="line"><span class="lineno">  466</span>            }</div>
<div class="line"><span class="lineno">  467</span><span class="preprocessor">        #endif</span></div>
<div class="line"><span class="lineno">  468</span> </div>
<div class="line"><span class="lineno">  469</span>        length -= read_length;</div>
<div class="line"><span class="lineno">  470</span>        offset += read_length;</div>
<div class="line"><span class="lineno">  471</span>    }</div>
<div class="line"><span class="lineno">  472</span> </div>
<div class="line"><span class="lineno">  473</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  474</span>}</div>
<div class="ttc" id="agroup__sd__raw_html_ga70e84e3345f19d2b5eecb9f665b37e0d"><div class="ttname"><a href="#ga70e84e3345f19d2b5eecb9f665b37e0d">sd_raw_write</a></div><div class="ttdeci">unsigned char sd_raw_write(unsigned int offset, const unsigned char *buffer, unsigned short length)</div><div class="ttdoc">Writes raw data to the card.</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00610">sd_card.h:610</a></div></div>
<div class="ttc" id="asd__card_8h_html_a6b4ea5767b225fa6bb958718b97e07e6"><div class="ttname"><a href="sd__card_8h.html#a6b4ea5767b225fa6bb958718b97e07e6">CMD_READ_SINGLE_BLOCK</a></div><div class="ttdeci">#define CMD_READ_SINGLE_BLOCK</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00056">sd_card.h:56</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__sd__raw_ga7aa8ed58f08b39d21b778b66f3e6ce59_cgraph.png" border="0" usemap="#agroup__sd__raw_ga7aa8ed58f08b39d21b778b66f3e6ce59_cgraph" alt=""/></div>
<map name="agroup__sd__raw_ga7aa8ed58f08b39d21b778b66f3e6ce59_cgraph" id="agroup__sd__raw_ga7aa8ed58f08b39d21b778b66f3e6ce59_cgraph">
<area shape="rect" title="Send a command to the memory card which responses with a R2 response." alt="" coords="5,64,100,91"/>
<area shape="rect" href="group__sd__raw.html#ga75085da84454931647328e80f6bdea7c" title="Receives a raw byte from the memory card." alt="" coords="524,27,644,53"/>
<area shape="poly" title=" " alt="" coords="85,61,147,39,236,16,308,5,380,4,472,12,518,20,517,25,471,17,380,9,308,10,237,21,148,44,87,66"/>
<area shape="rect" href="group__sd__raw.html#ga956fc6f9ea12bf3c42fe5d3b472e61a8" title="Send a command to the memory card which responses with a R1 response." alt="" coords="292,27,471,53"/>
<area shape="poly" title=" " alt="" coords="100,69,147,63,276,48,277,54,148,68,100,74"/>
<area shape="rect" href="group__sd__raw.html#ga70e84e3345f19d2b5eecb9f665b37e0d" title="Writes raw data to the card." alt="" coords="148,101,244,128"/>
<area shape="poly" title=" " alt="" coords="80,89,133,105,132,110,79,94"/>
<area shape="poly" title=" " alt="" coords="472,37,509,37,509,43,472,43"/>
<area shape="rect" href="group__sd__raw.html#ga157908b0533eb72368d320eb697f0cc0" title="Sends a raw byte to the memory card." alt="" coords="519,103,649,129"/>
<area shape="poly" title=" " alt="" coords="421,52,533,94,531,99,419,57"/>
<area shape="poly" title=" " alt="" coords="168,103,114,87,116,82,170,98"/>
<area shape="poly" title=" " alt="" coords="244,104,471,63,509,55,510,60,472,68,245,110"/>
<area shape="poly" title=" " alt="" coords="225,99,291,70,325,57,327,62,293,75,227,103"/>
<area shape="poly" title=" " alt="" coords="244,112,504,113,504,119,244,118"/>
<area shape="poly" title=" " alt="" coords="171,102,166,93,169,83,180,77,196,75,213,77,223,84,220,88,211,82,196,80,181,82,174,87,172,92,175,100"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__sd__raw_ga7aa8ed58f08b39d21b778b66f3e6ce59_icgraph.png" border="0" usemap="#agroup__sd__raw_ga7aa8ed58f08b39d21b778b66f3e6ce59_icgraph" alt=""/></div>
<map name="agroup__sd__raw_ga7aa8ed58f08b39d21b778b66f3e6ce59_icgraph" id="agroup__sd__raw_ga7aa8ed58f08b39d21b778b66f3e6ce59_icgraph">
<area shape="rect" title="Send a command to the memory card which responses with a R2 response." alt="" coords="340,93,434,120"/>
<area shape="rect" href="group__sd__raw.html#gac2e6d0ba10cef8f72391d35b4aabf385" title="Initializes memory card communication." alt="" coords="178,5,265,32"/>
<area shape="poly" title=" " alt="" coords="355,86,291,46,264,35,266,30,293,42,357,82"/>
<area shape="rect" href="group__sd__raw.html#ga0321ddf4d0234479fc90ee90d3e3cc40" title="Continuously reads units of interval bytes and calls a callback function." alt="" coords="151,56,292,83"/>
<area shape="poly" title=" " alt="" coords="324,95,283,86,284,81,325,90"/>
<area shape="rect" href="group__sd__raw.html#ga70e84e3345f19d2b5eecb9f665b37e0d" title="Writes raw data to the card." alt="" coords="173,131,270,157"/>
<area shape="poly" title=" " alt="" coords="342,128,270,144,269,139,341,122"/>
<area shape="poly" title=" " alt="" coords="266,123,339,106,340,112,267,128"/>
<area shape="poly" title=" " alt="" coords="249,118,240,112,221,109,204,111,195,116,193,121,197,129,193,131,188,122,191,112,203,106,221,104,241,107,252,113"/>
<area shape="rect" href="group__sd__raw.html#ga8cff641a3a1cd747bb6634eeba1ad54b" title="Writes the write buffer&#39;s content to the card." alt="" coords="5,131,103,157"/>
<area shape="poly" title=" " alt="" coords="158,147,103,147,103,141,158,141"/>
</map>
</div>

</div>
</div>
<a id="ga0321ddf4d0234479fc90ee90d3e3cc40" name="ga0321ddf4d0234479fc90ee90d3e3cc40"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0321ddf4d0234479fc90ee90d3e3cc40">&#9670;&#160;</a></span>sd_raw_read_interval()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char sd_raw_read_interval </td>
          <td>(</td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>offset</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *</td>          <td class="paramname"><span class="paramname"><em>buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short</td>          <td class="paramname"><span class="paramname"><em>interval</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short</td>          <td class="paramname"><span class="paramname"><em>length</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="#ga0932092e0096d2973d52d72aa69190ef">sd_raw_interval_handler</a></td>          <td class="paramname"><span class="paramname"><em>callback</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>p</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Continuously reads units of <code>interval</code> bytes and calls a callback function. </p>
<p>This function starts reading at the specified offset. Every <code>interval</code> bytes, it calls the callback function with the associated data buffer.</p>
<p>By returning zero, the callback may stop reading.</p>
<dl class="section note"><dt>Note</dt><dd>Within the callback function, you can not start another read or write operation. </dd>
<dd>
This function only works if the following conditions are met:<ul>
<li>(offset - (offset % 512)) % interval == 0</li>
<li>length % interval == 0</li>
</ul>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">offset</td><td>Offset from which to start reading. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buffer</td><td>Pointer to a buffer which is at least interval bytes in size. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">interval</td><td>Number of bytes to read before calling the callback function. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>Number of bytes to read altogether. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">callback</td><td>The function to call every interval bytes. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p</td><td>An opaque pointer directly passed to the callback function. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, 1 on success </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#ga7aa8ed58f08b39d21b778b66f3e6ce59" title="Send a command to the memory card which responses with a R2 response.">sd_raw_read</a>, <a class="el" href="#ga70e84e3345f19d2b5eecb9f665b37e0d" title="Writes raw data to the card.">sd_raw_write</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="sd__card_8h_source.html#l00500">500</a> of file <a class="el" href="sd__card_8h_source.html">sd_card.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  501</span>{</div>
<div class="line"><span class="lineno">  502</span>    <span class="keywordflow">if</span>(!buffer || interval == 0 || length &lt; interval || !callback)</div>
<div class="line"><span class="lineno">  503</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  504</span> </div>
<div class="line"><span class="lineno">  505</span><span class="preprocessor">    #if !SD_RAW_SAVE_RAM</span></div>
<div class="line"><span class="lineno">  506</span>        <span class="keywordflow">while</span>(length &gt;= interval)</div>
<div class="line"><span class="lineno">  507</span>        {</div>
<div class="line"><span class="lineno">  508</span>            <span class="comment">/* as reading is now buffered, we directly</span></div>
<div class="line"><span class="lineno">  509</span><span class="comment">                     * hand over the request to sd_raw_read()</span></div>
<div class="line"><span class="lineno">  510</span><span class="comment">                     */</span></div>
<div class="line"><span class="lineno">  511</span>            <span class="keywordflow">if</span>(!<a class="code hl_function" href="#ga7aa8ed58f08b39d21b778b66f3e6ce59">sd_raw_read</a>(offset, buffer, interval))</div>
<div class="line"><span class="lineno">  512</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  513</span>            <span class="keywordflow">if</span>(!callback(buffer, offset, p))</div>
<div class="line"><span class="lineno">  514</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  515</span>            offset += interval;</div>
<div class="line"><span class="lineno">  516</span>            length -= interval;</div>
<div class="line"><span class="lineno">  517</span>        }</div>
<div class="line"><span class="lineno">  518</span>    </div>
<div class="line"><span class="lineno">  519</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  520</span><span class="preprocessor">    #else</span></div>
<div class="line"><span class="lineno">  521</span>        <span class="comment">/* address card */</span></div>
<div class="line"><span class="lineno">  522</span>        select_card();</div>
<div class="line"><span class="lineno">  523</span>    </div>
<div class="line"><span class="lineno">  524</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> block_offset;</div>
<div class="line"><span class="lineno">  525</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> read_length;</div>
<div class="line"><span class="lineno">  526</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* buffer_cur;</div>
<div class="line"><span class="lineno">  527</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> finished = 0;</div>
<div class="line"><span class="lineno">  528</span>        <span class="keywordflow">do</span></div>
<div class="line"><span class="lineno">  529</span>        {</div>
<div class="line"><span class="lineno">  530</span>            <span class="comment">/* determine byte count to read at once */</span></div>
<div class="line"><span class="lineno">  531</span>            block_offset = offset &amp; 0x01ff;</div>
<div class="line"><span class="lineno">  532</span>            read_length = 512 - block_offset;</div>
<div class="line"><span class="lineno">  533</span>    </div>
<div class="line"><span class="lineno">  534</span>            <span class="comment">/* send single block request */</span></div>
<div class="line"><span class="lineno">  535</span>            <span class="keywordflow">if</span>(<a class="code hl_function" href="#ga956fc6f9ea12bf3c42fe5d3b472e61a8">sd_raw_send_command_r1</a>(<a class="code hl_define" href="sd__card_8h.html#a6b4ea5767b225fa6bb958718b97e07e6">CMD_READ_SINGLE_BLOCK</a>, offset &amp; 0xfffffe00))</div>
<div class="line"><span class="lineno">  536</span>            {</div>
<div class="line"><span class="lineno">  537</span>                unselect_card();</div>
<div class="line"><span class="lineno">  538</span>                <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  539</span>            }</div>
<div class="line"><span class="lineno">  540</span>    </div>
<div class="line"><span class="lineno">  541</span>            <span class="comment">/* wait for data block (start byte 0xfe) */</span></div>
<div class="line"><span class="lineno">  542</span>            <span class="keywordflow">while</span>(<a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>() != 0xfe);</div>
<div class="line"><span class="lineno">  543</span>            <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> i;</div>
<div class="line"><span class="lineno">  544</span>            <span class="comment">/* read up to the data of interest */</span></div>
<div class="line"><span class="lineno">  545</span>            <span class="keywordflow">for</span>(i = 0; i &lt; block_offset; ++i)</div>
<div class="line"><span class="lineno">  546</span>                <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  547</span>    </div>
<div class="line"><span class="lineno">  548</span>            <span class="comment">/* read interval bytes of data and execute the callback */</span></div>
<div class="line"><span class="lineno">  549</span>            <span class="keywordflow">do</span></div>
<div class="line"><span class="lineno">  550</span>            {</div>
<div class="line"><span class="lineno">  551</span>                <span class="keywordflow">if</span>(read_length &lt; interval || length &lt; interval)</div>
<div class="line"><span class="lineno">  552</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  553</span>    </div>
<div class="line"><span class="lineno">  554</span>                buffer_cur = buffer;</div>
<div class="line"><span class="lineno">  555</span>                <span class="keywordflow">for</span>(i = 0; i &lt; interval; ++i)</div>
<div class="line"><span class="lineno">  556</span>                    *buffer_cur++ = <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  557</span>    </div>
<div class="line"><span class="lineno">  558</span>                <span class="keywordflow">if</span>(!callback(buffer, offset + (512 - read_length), p))</div>
<div class="line"><span class="lineno">  559</span>                {</div>
<div class="line"><span class="lineno">  560</span>                    finished = 1;</div>
<div class="line"><span class="lineno">  561</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  562</span>                }</div>
<div class="line"><span class="lineno">  563</span>    </div>
<div class="line"><span class="lineno">  564</span>                read_length -= interval;</div>
<div class="line"><span class="lineno">  565</span>                length -= interval;</div>
<div class="line"><span class="lineno">  566</span>    </div>
<div class="line"><span class="lineno">  567</span>            }</div>
<div class="line"><span class="lineno">  568</span>            <span class="keywordflow">while</span>(read_length &gt; 0 &amp;&amp; length &gt; 0);</div>
<div class="line"><span class="lineno">  569</span>    </div>
<div class="line"><span class="lineno">  570</span>            <span class="comment">/* read rest of data block */</span></div>
<div class="line"><span class="lineno">  571</span>            <span class="keywordflow">while</span>(read_length-- &gt; 0)</div>
<div class="line"><span class="lineno">  572</span>                <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  573</span>    </div>
<div class="line"><span class="lineno">  574</span>            <span class="comment">/* read crc16 */</span></div>
<div class="line"><span class="lineno">  575</span>            <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  576</span>            <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  577</span>    </div>
<div class="line"><span class="lineno">  578</span>            <span class="keywordflow">if</span>(length &lt; interval)</div>
<div class="line"><span class="lineno">  579</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  580</span>    </div>
<div class="line"><span class="lineno">  581</span>            offset = (offset &amp; 0xfffffe00) + 512;</div>
<div class="line"><span class="lineno">  582</span>    </div>
<div class="line"><span class="lineno">  583</span>        }</div>
<div class="line"><span class="lineno">  584</span>        <span class="keywordflow">while</span>(!finished);</div>
<div class="line"><span class="lineno">  585</span>    </div>
<div class="line"><span class="lineno">  586</span>        <span class="comment">/* deaddress card */</span></div>
<div class="line"><span class="lineno">  587</span>        unselect_card();</div>
<div class="line"><span class="lineno">  588</span>    </div>
<div class="line"><span class="lineno">  589</span>        <span class="comment">/* let card some time to finish */</span></div>
<div class="line"><span class="lineno">  590</span>        <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  591</span>    </div>
<div class="line"><span class="lineno">  592</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  593</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno">  594</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__sd__raw_ga0321ddf4d0234479fc90ee90d3e3cc40_cgraph.png" border="0" usemap="#agroup__sd__raw_ga0321ddf4d0234479fc90ee90d3e3cc40_cgraph" alt=""/></div>
<map name="agroup__sd__raw_ga0321ddf4d0234479fc90ee90d3e3cc40_cgraph" id="agroup__sd__raw_ga0321ddf4d0234479fc90ee90d3e3cc40_cgraph">
<area shape="rect" title="Continuously reads units of interval bytes and calls a callback function." alt="" coords="5,107,147,133"/>
<area shape="rect" href="group__sd__raw.html#ga7aa8ed58f08b39d21b778b66f3e6ce59" title="Send a command to the memory card which responses with a R2 response." alt="" coords="195,107,289,133"/>
<area shape="poly" title=" " alt="" coords="147,117,179,117,179,123,147,123"/>
<area shape="rect" href="group__sd__raw.html#ga75085da84454931647328e80f6bdea7c" title="Receives a raw byte from the memory card." alt="" coords="714,120,833,147"/>
<area shape="poly" title=" " alt="" coords="135,131,195,143,325,162,427,171,530,170,660,157,709,148,710,154,661,163,530,175,427,176,325,167,194,148,134,136"/>
<area shape="rect" href="group__sd__raw.html#ga956fc6f9ea12bf3c42fe5d3b472e61a8" title="Send a command to the memory card which responses with a R1 response." alt="" coords="481,5,661,32"/>
<area shape="poly" title=" " alt="" coords="112,103,212,69,336,36,402,26,466,20,466,25,402,31,338,41,214,74,114,109"/>
<area shape="poly" title=" " alt="" coords="286,131,337,143,435,151,532,151,698,140,699,145,532,156,434,156,337,148,285,136"/>
<area shape="poly" title=" " alt="" coords="264,104,297,85,336,68,401,48,466,33,468,38,403,53,338,73,300,90,267,108"/>
<area shape="rect" href="group__sd__raw.html#ga70e84e3345f19d2b5eecb9f665b37e0d" title="Writes raw data to the card." alt="" coords="337,107,433,133"/>
<area shape="poly" title=" " alt="" coords="290,126,321,126,321,132,290,131"/>
<area shape="poly" title=" " alt="" coords="598,30,736,110,733,114,595,35"/>
<area shape="rect" href="group__sd__raw.html#ga157908b0533eb72368d320eb697f0cc0" title="Sends a raw byte to the memory card." alt="" coords="709,44,838,71"/>
<area shape="poly" title=" " alt="" coords="645,30,694,40,693,45,644,35"/>
<area shape="poly" title=" " alt="" coords="336,114,305,114,305,108,337,109"/>
<area shape="poly" title=" " alt="" coords="434,119,699,128,699,133,434,124"/>
<area shape="poly" title=" " alt="" coords="401,104,436,77,480,48,508,35,510,40,483,53,439,81,404,108"/>
<area shape="poly" title=" " alt="" coords="433,110,693,68,694,73,434,115"/>
<area shape="poly" title=" " alt="" coords="360,107,356,98,359,88,369,82,385,80,403,83,412,89,409,94,401,88,385,85,371,87,363,92,361,98,365,105"/>
</map>
</div>

</div>
</div>
<a id="ga75085da84454931647328e80f6bdea7c" name="ga75085da84454931647328e80f6bdea7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga75085da84454931647328e80f6bdea7c">&#9670;&#160;</a></span>sd_raw_rec_byte()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char sd_raw_rec_byte </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Receives a raw byte from the memory card. </p>
<dl class="section return"><dt>Returns</dt><dd>The byte which should be read. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#ga157908b0533eb72368d320eb697f0cc0" title="Sends a raw byte to the memory card.">sd_raw_send_byte</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="sd__card_8h_source.html#l00297">297</a> of file <a class="el" href="sd__card_8h_source.html">sd_card.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  298</span>{</div>
<div class="line"><span class="lineno">  299</span>    <span class="comment">/* send dummy data for receiving some */</span></div>
<div class="line"><span class="lineno">  300</span>    S0SPDR = 0xff;</div>
<div class="line"><span class="lineno">  301</span>    <span class="keywordflow">while</span>(!(S0SPSR &amp; 0x80));</div>
<div class="line"><span class="lineno">  302</span> </div>
<div class="line"><span class="lineno">  303</span>    <span class="keywordflow">return</span> S0SPDR;</div>
<div class="line"><span class="lineno">  304</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__sd__raw_ga75085da84454931647328e80f6bdea7c_icgraph.png" border="0" usemap="#agroup__sd__raw_ga75085da84454931647328e80f6bdea7c_icgraph" alt=""/></div>
<map name="agroup__sd__raw_ga75085da84454931647328e80f6bdea7c_icgraph" id="agroup__sd__raw_ga75085da84454931647328e80f6bdea7c_icgraph">
<area shape="rect" title="Receives a raw byte from the memory card." alt="" coords="755,157,874,184"/>
<area shape="rect" href="group__sd__raw.html#ga0cd21cf9a326b8cfc9b9d9f35fa57423" title=" " alt="" coords="340,30,479,57"/>
<area shape="poly" title=" " alt="" coords="778,151,743,132,706,114,647,95,587,79,479,57,480,51,588,73,649,90,708,109,746,127,780,146"/>
<area shape="rect" href="group__sd__raw.html#ga16b73f2f45ee2f1c647d6bef916eb198" title="Reads informational data from the card." alt="" coords="353,81,467,108"/>
<area shape="poly" title=" " alt="" coords="742,156,706,148,467,106,468,100,707,143,743,150"/>
<area shape="rect" href="group__sd__raw.html#gac2e6d0ba10cef8f72391d35b4aabf385" title="Initializes memory card communication." alt="" coords="178,132,265,158"/>
<area shape="poly" title=" " alt="" coords="791,147,754,108,731,89,705,73,646,46,597,33,479,21,408,9,377,10,341,21,304,44,273,75,249,107,232,133,228,130,244,104,269,72,301,40,339,16,377,4,408,4,480,16,598,28,648,41,708,68,734,85,757,104,795,143"/>
<area shape="rect" href="group__sd__raw.html#ga7aa8ed58f08b39d21b778b66f3e6ce59" title="Send a command to the memory card which responses with a R2 response." alt="" coords="363,233,457,260"/>
<area shape="poly" title=" " alt="" coords="743,191,707,198,458,242,457,237,706,193,742,185"/>
<area shape="rect" href="group__sd__raw.html#ga0321ddf4d0234479fc90ee90d3e3cc40" title="Continuously reads units of interval bytes and calls a callback function." alt="" coords="151,284,292,310"/>
<area shape="poly" title=" " alt="" coords="799,199,762,247,737,270,708,288,654,307,597,320,540,328,483,330,376,326,289,314,290,308,376,320,483,325,539,322,596,315,652,302,706,283,734,265,758,243,795,196"/>
<area shape="rect" href="group__sd__raw.html#ga70e84e3345f19d2b5eecb9f665b37e0d" title="Writes raw data to the card." alt="" coords="173,233,270,260"/>
<area shape="poly" title=" " alt="" coords="784,195,748,217,708,236,608,268,527,283,444,284,340,274,269,262,270,256,340,269,444,278,526,277,607,263,706,231,746,212,781,190"/>
<area shape="rect" href="group__sd__raw.html#ga956fc6f9ea12bf3c42fe5d3b472e61a8" title="Send a command to the memory card which responses with a R1 response." alt="" coords="527,157,707,184"/>
<area shape="poly" title=" " alt="" coords="739,173,707,173,707,168,739,168"/>
<area shape="poly" title=" " alt="" coords="369,228,247,161,249,157,371,223"/>
<area shape="poly" title=" " alt="" coords="348,266,274,286,273,281,347,261"/>
<area shape="poly" title=" " alt="" coords="347,258,270,257,270,252,347,252"/>
<area shape="poly" title=" " alt="" coords="285,235,362,236,362,241,285,241"/>
<area shape="poly" title=" " alt="" coords="250,220,240,214,221,212,204,214,195,218,193,224,197,231,192,234,187,224,191,215,203,209,221,206,242,209,252,216"/>
<area shape="rect" href="group__sd__raw.html#ga8cff641a3a1cd747bb6634eeba1ad54b" title="Writes the write buffer&#39;s content to the card." alt="" coords="5,233,103,260"/>
<area shape="poly" title=" " alt="" coords="158,249,103,249,103,244,158,244"/>
<area shape="poly" title=" " alt="" coords="587,149,538,110,478,71,453,60,456,55,481,67,541,106,590,145"/>
<area shape="poly" title=" " alt="" coords="563,154,448,111,450,106,565,149"/>
<area shape="poly" title=" " alt="" coords="512,166,265,151,265,145,512,161"/>
<area shape="poly" title=" " alt="" coords="564,192,528,205,448,235,446,230,526,200,562,187"/>
<area shape="poly" title=" " alt="" coords="593,197,544,238,513,258,480,274,433,289,384,297,293,303,292,298,383,292,432,283,478,269,511,254,541,234,590,193"/>
<area shape="poly" title=" " alt="" coords="521,190,341,224,271,239,269,233,339,219,520,185"/>
</map>
</div>

</div>
</div>
<a id="ga157908b0533eb72368d320eb697f0cc0" name="ga157908b0533eb72368d320eb697f0cc0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga157908b0533eb72368d320eb697f0cc0">&#9670;&#160;</a></span>sd_raw_send_byte()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void sd_raw_send_byte </td>
          <td>(</td>
          <td class="paramtype">unsigned char</td>          <td class="paramname"><span class="paramname"><em>b</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sends a raw byte to the memory card. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">b</td><td>The byte to sent. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#ga75085da84454931647328e80f6bdea7c" title="Receives a raw byte from the memory card.">sd_raw_rec_byte</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="sd__card_8h_source.html#l00283">283</a> of file <a class="el" href="sd__card_8h_source.html">sd_card.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  284</span>{</div>
<div class="line"><span class="lineno">  285</span>    S0SPDR = b;</div>
<div class="line"><span class="lineno">  286</span>    <span class="comment">/* wait for byte to be shifted out */</span></div>
<div class="line"><span class="lineno">  287</span>    <span class="keywordflow">while</span>(!(S0SPSR &amp; 0x80));</div>
<div class="line"><span class="lineno">  288</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__sd__raw_ga157908b0533eb72368d320eb697f0cc0_icgraph.png" border="0" usemap="#agroup__sd__raw_ga157908b0533eb72368d320eb697f0cc0_icgraph" alt=""/></div>
<map name="agroup__sd__raw_ga157908b0533eb72368d320eb697f0cc0_icgraph" id="agroup__sd__raw_ga157908b0533eb72368d320eb697f0cc0_icgraph">
<area shape="rect" title="Sends a raw byte to the memory card." alt="" coords="755,209,884,235"/>
<area shape="rect" href="group__sd__raw.html#ga956fc6f9ea12bf3c42fe5d3b472e61a8" title="Send a command to the memory card which responses with a R1 response." alt="" coords="527,133,707,159"/>
<area shape="poly" title=" " alt="" coords="766,205,654,162,656,158,768,200"/>
<area shape="rect" href="group__sd__raw.html#ga70e84e3345f19d2b5eecb9f665b37e0d" title="Writes raw data to the card." alt="" coords="173,221,270,247"/>
<area shape="poly" title=" " alt="" coords="739,234,557,247,448,251,340,249,270,243,270,237,340,243,448,245,557,242,739,228"/>
<area shape="rect" href="group__sd__raw.html#ga0cd21cf9a326b8cfc9b9d9f35fa57423" title=" " alt="" coords="340,31,479,58"/>
<area shape="poly" title=" " alt="" coords="579,127,478,72,451,61,453,56,480,68,582,122"/>
<area shape="rect" href="group__sd__raw.html#ga16b73f2f45ee2f1c647d6bef916eb198" title="Reads informational data from the card." alt="" coords="353,82,467,109"/>
<area shape="poly" title=" " alt="" coords="544,131,467,112,468,107,545,126"/>
<area shape="rect" href="group__sd__raw.html#gac2e6d0ba10cef8f72391d35b4aabf385" title="Initializes memory card communication." alt="" coords="178,35,265,62"/>
<area shape="poly" title=" " alt="" coords="595,122,547,68,515,41,478,22,450,13,420,9,359,12,303,23,258,37,256,32,302,18,358,6,420,4,451,8,480,17,518,37,551,64,599,118"/>
<area shape="rect" href="group__sd__raw.html#ga7aa8ed58f08b39d21b778b66f3e6ce59" title="Send a command to the memory card which responses with a R2 response." alt="" coords="363,183,457,210"/>
<area shape="poly" title=" " alt="" coords="545,166,458,188,457,183,544,161"/>
<area shape="rect" href="group__sd__raw.html#ga0321ddf4d0234479fc90ee90d3e3cc40" title="Continuously reads units of interval bytes and calls a callback function." alt="" coords="151,139,292,166"/>
<area shape="poly" title=" " alt="" coords="512,150,292,154,292,149,512,145"/>
<area shape="poly" title=" " alt="" coords="586,171,538,200,480,225,425,236,368,242,270,241,270,236,368,236,424,231,479,219,536,196,584,166"/>
<area shape="poly" title=" " alt="" coords="378,176,239,65,242,61,381,171"/>
<area shape="poly" title=" " alt="" coords="346,185,281,169,282,164,348,180"/>
<area shape="poly" title=" " alt="" coords="360,217,271,235,270,230,359,212"/>
<area shape="poly" title=" " alt="" coords="270,214,361,195,362,201,271,219"/>
<area shape="poly" title=" " alt="" coords="250,208,240,202,221,199,204,201,195,206,193,212,197,219,192,222,187,212,191,202,203,196,221,194,242,197,252,203"/>
<area shape="rect" href="group__sd__raw.html#ga8cff641a3a1cd747bb6634eeba1ad54b" title="Writes the write buffer&#39;s content to the card." alt="" coords="5,221,103,247"/>
<area shape="poly" title=" " alt="" coords="158,237,103,237,103,231,158,231"/>
</map>
</div>

</div>
</div>
<a id="ga956fc6f9ea12bf3c42fe5d3b472e61a8" name="ga956fc6f9ea12bf3c42fe5d3b472e61a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga956fc6f9ea12bf3c42fe5d3b472e61a8">&#9670;&#160;</a></span>sd_raw_send_command_r1()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char sd_raw_send_command_r1 </td>
          <td>(</td>
          <td class="paramtype">unsigned char</td>          <td class="paramname"><span class="paramname"><em>command</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>arg</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Send a command to the memory card which responses with a R1 response. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">command</td><td>The command to send. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">arg</td><td>The argument for command. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The command answer. </dd></dl>

<p class="definition">Definition at line <a class="el" href="sd__card_8h_source.html#l00314">314</a> of file <a class="el" href="sd__card_8h_source.html">sd_card.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  315</span>{</div>
<div class="line"><span class="lineno">  316</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> response;</div>
<div class="line"><span class="lineno">  317</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i;</div>
<div class="line"><span class="lineno">  318</span> </div>
<div class="line"><span class="lineno">  319</span>    <span class="comment">/* wait some clock cycles */</span></div>
<div class="line"><span class="lineno">  320</span>    <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  321</span> </div>
<div class="line"><span class="lineno">  322</span>    <span class="comment">/* send command via SPI */</span></div>
<div class="line"><span class="lineno">  323</span>    <a class="code hl_function" href="#ga157908b0533eb72368d320eb697f0cc0">sd_raw_send_byte</a>(0x40 | command);</div>
<div class="line"><span class="lineno">  324</span>    <a class="code hl_function" href="#ga157908b0533eb72368d320eb697f0cc0">sd_raw_send_byte</a>((arg &gt;&gt; 24) &amp; 0xff);</div>
<div class="line"><span class="lineno">  325</span>    <a class="code hl_function" href="#ga157908b0533eb72368d320eb697f0cc0">sd_raw_send_byte</a>((arg &gt;&gt; 16) &amp; 0xff);</div>
<div class="line"><span class="lineno">  326</span>    <a class="code hl_function" href="#ga157908b0533eb72368d320eb697f0cc0">sd_raw_send_byte</a>((arg &gt;&gt; 8) &amp; 0xff);</div>
<div class="line"><span class="lineno">  327</span>    <a class="code hl_function" href="#ga157908b0533eb72368d320eb697f0cc0">sd_raw_send_byte</a>((arg &gt;&gt; 0) &amp; 0xff);</div>
<div class="line"><span class="lineno">  328</span>    <a class="code hl_function" href="#ga157908b0533eb72368d320eb697f0cc0">sd_raw_send_byte</a>((command == <a class="code hl_define" href="sd__card_8h.html#ae3dd15ec52cbd1ef2ce6e20e39fd6efb">CMD_GO_IDLE_STATE</a>) ? 0x95 : 0xff);</div>
<div class="line"><span class="lineno">  329</span> </div>
<div class="line"><span class="lineno">  330</span>    <span class="comment">/* receive response */</span></div>
<div class="line"><span class="lineno">  331</span>    <span class="keywordflow">for</span>(i = 0; i &lt; 10; ++i)</div>
<div class="line"><span class="lineno">  332</span>    {</div>
<div class="line"><span class="lineno">  333</span>        response = <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  334</span>        <span class="keywordflow">if</span>(response != 0xff)</div>
<div class="line"><span class="lineno">  335</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  336</span>    }</div>
<div class="line"><span class="lineno">  337</span> </div>
<div class="line"><span class="lineno">  338</span>    <span class="keywordflow">return</span> response;</div>
<div class="line"><span class="lineno">  339</span>}</div>
<div class="ttc" id="agroup__sd__raw_html_ga157908b0533eb72368d320eb697f0cc0"><div class="ttname"><a href="#ga157908b0533eb72368d320eb697f0cc0">sd_raw_send_byte</a></div><div class="ttdeci">static void sd_raw_send_byte(unsigned char b)</div><div class="ttdoc">Sends a raw byte to the memory card.</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00283">sd_card.h:283</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__sd__raw_ga956fc6f9ea12bf3c42fe5d3b472e61a8_cgraph.png" border="0" usemap="#agroup__sd__raw_ga956fc6f9ea12bf3c42fe5d3b472e61a8_cgraph" alt=""/></div>
<map name="agroup__sd__raw_ga956fc6f9ea12bf3c42fe5d3b472e61a8_cgraph" id="agroup__sd__raw_ga956fc6f9ea12bf3c42fe5d3b472e61a8_cgraph">
<area shape="rect" title="Send a command to the memory card which responses with a R1 response." alt="" coords="5,31,185,57"/>
<area shape="rect" href="group__sd__raw.html#ga75085da84454931647328e80f6bdea7c" title="Receives a raw byte from the memory card." alt="" coords="238,5,357,32"/>
<area shape="poly" title=" " alt="" coords="185,30,222,25,223,31,185,35"/>
<area shape="rect" href="group__sd__raw.html#ga157908b0533eb72368d320eb697f0cc0" title="Sends a raw byte to the memory card." alt="" coords="233,56,362,83"/>
<area shape="poly" title=" " alt="" coords="185,53,217,57,217,62,185,58"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__sd__raw_ga956fc6f9ea12bf3c42fe5d3b472e61a8_icgraph.png" border="0" usemap="#agroup__sd__raw_ga956fc6f9ea12bf3c42fe5d3b472e61a8_icgraph" alt=""/></div>
<map name="agroup__sd__raw_ga956fc6f9ea12bf3c42fe5d3b472e61a8_icgraph" id="agroup__sd__raw_ga956fc6f9ea12bf3c42fe5d3b472e61a8_icgraph">
<area shape="rect" title="Send a command to the memory card which responses with a R1 response." alt="" coords="527,132,707,159"/>
<area shape="rect" href="group__sd__raw.html#ga0cd21cf9a326b8cfc9b9d9f35fa57423" title=" " alt="" coords="340,5,479,32"/>
<area shape="poly" title=" " alt="" coords="587,124,538,85,478,46,453,35,456,30,481,42,541,81,590,120"/>
<area shape="rect" href="group__sd__raw.html#ga16b73f2f45ee2f1c647d6bef916eb198" title="Reads informational data from the card." alt="" coords="353,56,467,83"/>
<area shape="poly" title=" " alt="" coords="563,129,448,86,450,81,565,124"/>
<area shape="rect" href="group__sd__raw.html#gac2e6d0ba10cef8f72391d35b4aabf385" title="Initializes memory card communication." alt="" coords="178,107,265,133"/>
<area shape="poly" title=" " alt="" coords="512,141,265,125,265,120,512,136"/>
<area shape="rect" href="group__sd__raw.html#ga7aa8ed58f08b39d21b778b66f3e6ce59" title="Send a command to the memory card which responses with a R2 response." alt="" coords="363,208,457,235"/>
<area shape="poly" title=" " alt="" coords="565,167,450,210,448,205,563,162"/>
<area shape="rect" href="group__sd__raw.html#ga0321ddf4d0234479fc90ee90d3e3cc40" title="Continuously reads units of interval bytes and calls a callback function." alt="" coords="151,157,292,184"/>
<area shape="poly" title=" " alt="" coords="512,155,292,169,292,164,512,149"/>
<area shape="rect" href="group__sd__raw.html#ga70e84e3345f19d2b5eecb9f665b37e0d" title="Writes raw data to the card." alt="" coords="173,232,270,259"/>
<area shape="poly" title=" " alt="" coords="594,172,545,214,514,234,480,249,425,261,368,265,315,263,270,257,270,252,315,257,368,260,424,256,478,244,511,230,542,210,591,168"/>
<area shape="poly" title=" " alt="" coords="376,201,336,174,291,148,264,136,266,131,293,143,339,169,379,197"/>
<area shape="poly" title=" " alt="" coords="347,207,273,187,274,182,348,202"/>
<area shape="poly" title=" " alt="" coords="347,240,270,250,269,245,347,235"/>
<area shape="poly" title=" " alt="" coords="284,226,362,217,362,222,284,232"/>
<area shape="poly" title=" " alt="" coords="250,219,240,213,221,211,204,213,195,217,193,223,197,230,192,233,187,223,191,214,203,208,221,205,242,208,252,214"/>
<area shape="rect" href="group__sd__raw.html#ga8cff641a3a1cd747bb6634eeba1ad54b" title="Writes the write buffer&#39;s content to the card." alt="" coords="5,232,103,259"/>
<area shape="poly" title=" " alt="" coords="158,248,103,248,103,243,158,243"/>
</map>
</div>

</div>
</div>
<a id="ga8cff641a3a1cd747bb6634eeba1ad54b" name="ga8cff641a3a1cd747bb6634eeba1ad54b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8cff641a3a1cd747bb6634eeba1ad54b">&#9670;&#160;</a></span>sd_raw_sync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char sd_raw_sync </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Writes the write buffer's content to the card. </p>
<dl class="section note"><dt>Note</dt><dd>When write buffering is enabled, you should call this function before disconnecting the card to ensure all remaining data has been written.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, 1 on success. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#ga70e84e3345f19d2b5eecb9f665b37e0d" title="Writes raw data to the card.">sd_raw_write</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="sd__card_8h_source.html#l00705">705</a> of file <a class="el" href="sd__card_8h_source.html">sd_card.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  706</span>{</div>
<div class="line"><span class="lineno">  707</span><span class="preprocessor">    #if SD_RAW_WRITE_SUPPORT</span></div>
<div class="line"><span class="lineno">  708</span><span class="preprocessor">        #if SD_RAW_WRITE_BUFFERING</span></div>
<div class="line"><span class="lineno">  709</span>        <span class="keywordflow">if</span>(raw_block_written)</div>
<div class="line"><span class="lineno">  710</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  711</span>        <span class="keywordflow">if</span>(!<a class="code hl_function" href="#ga70e84e3345f19d2b5eecb9f665b37e0d">sd_raw_write</a>(<a class="code hl_variable" href="sd__card_8h.html#af7e0a319714313d4a1cbd2f45adda45d">raw_block_address</a>, <a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a>, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a>)))</div>
<div class="line"><span class="lineno">  712</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  713</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno">  714</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  715</span><span class="preprocessor">    #else</span></div>
<div class="line"><span class="lineno">  716</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  717</span><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="lineno">  718</span>}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__sd__raw_ga8cff641a3a1cd747bb6634eeba1ad54b_cgraph.png" border="0" usemap="#agroup__sd__raw_ga8cff641a3a1cd747bb6634eeba1ad54b_cgraph" alt=""/></div>
<map name="agroup__sd__raw_ga8cff641a3a1cd747bb6634eeba1ad54b_cgraph" id="agroup__sd__raw_ga8cff641a3a1cd747bb6634eeba1ad54b_cgraph">
<area shape="rect" title="Writes the write buffer&#39;s content to the card." alt="" coords="5,29,103,56"/>
<area shape="rect" href="group__sd__raw.html#ga70e84e3345f19d2b5eecb9f665b37e0d" title="Writes raw data to the card." alt="" coords="151,29,247,56"/>
<area shape="poly" title=" " alt="" coords="103,40,135,40,135,45,103,45"/>
<area shape="poly" title=" " alt="" coords="174,30,169,21,172,11,183,5,199,3,216,5,226,12,223,16,214,10,199,8,184,10,177,14,175,20,178,28"/>
<area shape="rect" href="group__sd__raw.html#ga7aa8ed58f08b39d21b778b66f3e6ce59" title="Send a command to the memory card which responses with a R2 response." alt="" coords="295,29,389,56"/>
<area shape="poly" title=" " alt="" coords="247,49,279,49,279,54,247,54"/>
<area shape="rect" href="group__sd__raw.html#ga75085da84454931647328e80f6bdea7c" title="Receives a raw byte from the memory card." alt="" coords="670,29,789,56"/>
<area shape="poly" title=" " alt="" coords="242,26,295,15,358,12,449,13,617,21,655,26,654,31,616,27,449,18,358,17,295,20,243,31"/>
<area shape="rect" href="group__sd__raw.html#ga956fc6f9ea12bf3c42fe5d3b472e61a8" title="Send a command to the memory card which responses with a R1 response." alt="" coords="437,80,617,107"/>
<area shape="poly" title=" " alt="" coords="247,54,295,65,422,83,422,88,295,71,246,59"/>
<area shape="rect" href="group__sd__raw.html#ga157908b0533eb72368d320eb697f0cc0" title="Sends a raw byte to the memory card." alt="" coords="665,105,794,132"/>
<area shape="poly" title=" " alt="" coords="227,54,296,84,366,105,438,116,548,122,649,121,649,126,548,128,437,121,364,110,294,89,225,59"/>
<area shape="poly" title=" " alt="" coords="294,37,263,36,263,31,294,31"/>
<area shape="poly" title=" " alt="" coords="390,40,655,40,655,45,390,45"/>
<area shape="poly" title=" " alt="" coords="391,53,462,73,461,78,389,58"/>
<area shape="poly" title=" " alt="" coords="583,77,658,58,659,63,584,82"/>
<area shape="poly" title=" " alt="" coords="617,102,649,106,649,111,617,107"/>
</map>
</div>

</div>
</div>
<a id="ga70e84e3345f19d2b5eecb9f665b37e0d" name="ga70e84e3345f19d2b5eecb9f665b37e0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga70e84e3345f19d2b5eecb9f665b37e0d">&#9670;&#160;</a></span>sd_raw_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char sd_raw_write </td>
          <td>(</td>
          <td class="paramtype">unsigned int</td>          <td class="paramname"><span class="paramname"><em>offset</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *</td>          <td class="paramname"><span class="paramname"><em>buffer</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short</td>          <td class="paramname"><span class="paramname"><em>length</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Writes raw data to the card. </p>
<dl class="section note"><dt>Note</dt><dd>If write buffering is enabled, you might have to call <a class="el" href="#ga8cff641a3a1cd747bb6634eeba1ad54b" title="Writes the write buffer&#39;s content to the card.">sd_raw_sync()</a> before disconnecting the card to ensure all remaining data has been written.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">offset</td><td>The offset where to start writing. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buffer</td><td>The buffer containing the data to be written. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">length</td><td>The number of bytes to write. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on failure, 1 on success. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#ga7aa8ed58f08b39d21b778b66f3e6ce59" title="Send a command to the memory card which responses with a R2 response.">sd_raw_read</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="sd__card_8h_source.html#l00610">610</a> of file <a class="el" href="sd__card_8h_source.html">sd_card.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  610</span>                                                                                                    {</div>
<div class="line"><span class="lineno">  611</span><span class="preprocessor">#if SD_RAW_WRITE_SUPPORT</span></div>
<div class="line"><span class="lineno">  612</span>    </div>
<div class="line"><span class="lineno">  613</span>  <span class="keywordflow">if</span>(get_pin_locked()) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  614</span>    </div>
<div class="line"><span class="lineno">  615</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> block_address;</div>
<div class="line"><span class="lineno">  616</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> block_offset;</div>
<div class="line"><span class="lineno">  617</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> write_length;</div>
<div class="line"><span class="lineno">  618</span>  <span class="keywordflow">while</span>(length &gt; 0) {</div>
<div class="line"><span class="lineno">  619</span>    <span class="comment">/* determine byte count to write at once */</span></div>
<div class="line"><span class="lineno">  620</span>    block_address = offset &amp; 0xfffffe00;</div>
<div class="line"><span class="lineno">  621</span>    block_offset = offset &amp; 0x01ff;</div>
<div class="line"><span class="lineno">  622</span>    write_length = 512 - block_offset; <span class="comment">/* write up to block border */</span></div>
<div class="line"><span class="lineno">  623</span>    <span class="keywordflow">if</span>(write_length &gt; length) write_length = length;</div>
<div class="line"><span class="lineno">  624</span>    </div>
<div class="line"><span class="lineno">  625</span>    <span class="comment">/* Merge the data to write with the content of the block.</span></div>
<div class="line"><span class="lineno">  626</span><span class="comment">     * Use the cached block if available.</span></div>
<div class="line"><span class="lineno">  627</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  628</span>    <span class="keywordflow">if</span>(block_address != <a class="code hl_variable" href="sd__card_8h.html#af7e0a319714313d4a1cbd2f45adda45d">raw_block_address</a>) {</div>
<div class="line"><span class="lineno">  629</span><span class="preprocessor">#if SD_RAW_WRITE_BUFFERING</span></div>
<div class="line"><span class="lineno">  630</span>      <span class="keywordflow">if</span>(!raw_block_written) {</div>
<div class="line"><span class="lineno">  631</span>        <span class="keywordflow">if</span>(!<a class="code hl_function" href="#ga70e84e3345f19d2b5eecb9f665b37e0d">sd_raw_write</a>(<a class="code hl_variable" href="sd__card_8h.html#af7e0a319714313d4a1cbd2f45adda45d">raw_block_address</a>, <a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a>, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a>))) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  632</span>      }</div>
<div class="line"><span class="lineno">  633</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  634</span>      <span class="keywordflow">if</span>(block_offset || write_length &lt; 512) {</div>
<div class="line"><span class="lineno">  635</span>        <span class="keywordflow">if</span>(!<a class="code hl_function" href="#ga7aa8ed58f08b39d21b778b66f3e6ce59">sd_raw_read</a>(block_address, <a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a>, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a>))) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  636</span>      }</div>
<div class="line"><span class="lineno">  637</span>      <a class="code hl_variable" href="sd__card_8h.html#af7e0a319714313d4a1cbd2f45adda45d">raw_block_address</a> = block_address;</div>
<div class="line"><span class="lineno">  638</span>    }</div>
<div class="line"><span class="lineno">  639</span> </div>
<div class="line"><span class="lineno">  640</span>    <span class="keywordflow">if</span>(buffer != <a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a>) {</div>
<div class="line"><span class="lineno">  641</span>      memcpy(<a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a> + block_offset, buffer, write_length);</div>
<div class="line"><span class="lineno">  642</span> </div>
<div class="line"><span class="lineno">  643</span><span class="preprocessor">#if SD_RAW_WRITE_BUFFERING</span></div>
<div class="line"><span class="lineno">  644</span>      raw_block_written = 0;</div>
<div class="line"><span class="lineno">  645</span>      <span class="keywordflow">if</span>(length == write_length) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  646</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  647</span>    }</div>
<div class="line"><span class="lineno">  648</span> </div>
<div class="line"><span class="lineno">  649</span>    buffer += write_length;</div>
<div class="line"><span class="lineno">  650</span> </div>
<div class="line"><span class="lineno">  651</span>    <span class="comment">/* address card */</span></div>
<div class="line"><span class="lineno">  652</span>    select_card();</div>
<div class="line"><span class="lineno">  653</span> </div>
<div class="line"><span class="lineno">  654</span>    <span class="comment">/* send single block request */</span></div>
<div class="line"><span class="lineno">  655</span>    <span class="keywordflow">if</span>(<a class="code hl_function" href="#ga956fc6f9ea12bf3c42fe5d3b472e61a8">sd_raw_send_command_r1</a>(<a class="code hl_define" href="sd__card_8h.html#abadbda3eadae68f4a9678fd9c8aa1f57">CMD_WRITE_SINGLE_BLOCK</a>, block_address)) {</div>
<div class="line"><span class="lineno">  656</span>      unselect_card();</div>
<div class="line"><span class="lineno">  657</span>      <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  658</span>    }</div>
<div class="line"><span class="lineno">  659</span> </div>
<div class="line"><span class="lineno">  660</span>    <span class="comment">/* send start byte */</span></div>
<div class="line"><span class="lineno">  661</span>    <a class="code hl_function" href="#ga157908b0533eb72368d320eb697f0cc0">sd_raw_send_byte</a>(0xfe);</div>
<div class="line"><span class="lineno">  662</span> </div>
<div class="line"><span class="lineno">  663</span>    <span class="comment">/* write byte block */</span></div>
<div class="line"><span class="lineno">  664</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* cache = <a class="code hl_variable" href="sd__card_8h.html#a2b29b7ccaa3ad4ab2e60a1bf8d2abb39">raw_block</a>;</div>
<div class="line"><span class="lineno">  665</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> i;</div>
<div class="line"><span class="lineno">  666</span>    <span class="keywordflow">for</span>(i = 0; i &lt; 512; ++i) <a class="code hl_function" href="#ga157908b0533eb72368d320eb697f0cc0">sd_raw_send_byte</a>(*cache++);</div>
<div class="line"><span class="lineno">  667</span> </div>
<div class="line"><span class="lineno">  668</span>    <span class="comment">/* write dummy crc16 */</span></div>
<div class="line"><span class="lineno">  669</span>    <a class="code hl_function" href="#ga157908b0533eb72368d320eb697f0cc0">sd_raw_send_byte</a>(0xff);</div>
<div class="line"><span class="lineno">  670</span>    <a class="code hl_function" href="#ga157908b0533eb72368d320eb697f0cc0">sd_raw_send_byte</a>(0xff);</div>
<div class="line"><span class="lineno">  671</span> </div>
<div class="line"><span class="lineno">  672</span>    <span class="comment">/* wait while card is busy */</span></div>
<div class="line"><span class="lineno">  673</span>    <span class="keywordflow">while</span>(<a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>() != 0xff);</div>
<div class="line"><span class="lineno">  674</span>    <a class="code hl_function" href="#ga75085da84454931647328e80f6bdea7c">sd_raw_rec_byte</a>();</div>
<div class="line"><span class="lineno">  675</span> </div>
<div class="line"><span class="lineno">  676</span>    <span class="comment">/* deaddress card */</span></div>
<div class="line"><span class="lineno">  677</span>    unselect_card();</div>
<div class="line"><span class="lineno">  678</span> </div>
<div class="line"><span class="lineno">  679</span>    length -= write_length;</div>
<div class="line"><span class="lineno">  680</span>    offset += write_length;</div>
<div class="line"><span class="lineno">  681</span> </div>
<div class="line"><span class="lineno">  682</span><span class="preprocessor">#if SD_RAW_WRITE_BUFFERING</span></div>
<div class="line"><span class="lineno">  683</span>    raw_block_written = 1;</div>
<div class="line"><span class="lineno">  684</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  685</span>  }</div>
<div class="line"><span class="lineno">  686</span> </div>
<div class="line"><span class="lineno">  687</span>  <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  688</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  689</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  690</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  691</span>}</div>
<div class="ttc" id="asd__card_8h_html_abadbda3eadae68f4a9678fd9c8aa1f57"><div class="ttname"><a href="sd__card_8h.html#abadbda3eadae68f4a9678fd9c8aa1f57">CMD_WRITE_SINGLE_BLOCK</a></div><div class="ttdeci">#define CMD_WRITE_SINGLE_BLOCK</div><div class="ttdef"><b>Definition</b> <a href="sd__card_8h_source.html#l00060">sd_card.h:60</a></div></div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__sd__raw_ga70e84e3345f19d2b5eecb9f665b37e0d_cgraph.png" border="0" usemap="#agroup__sd__raw_ga70e84e3345f19d2b5eecb9f665b37e0d_cgraph" alt=""/></div>
<map name="agroup__sd__raw_ga70e84e3345f19d2b5eecb9f665b37e0d_cgraph" id="agroup__sd__raw_ga70e84e3345f19d2b5eecb9f665b37e0d_cgraph">
<area shape="rect" title="Writes raw data to the card." alt="" coords="5,29,102,56"/>
<area shape="poly" title=" " alt="" coords="28,30,24,21,27,11,37,5,54,3,71,5,80,12,77,16,69,10,53,8,39,10,31,14,29,20,33,28"/>
<area shape="rect" href="group__sd__raw.html#ga7aa8ed58f08b39d21b778b66f3e6ce59" title="Send a command to the memory card which responses with a R2 response." alt="" coords="150,29,244,56"/>
<area shape="poly" title=" " alt="" coords="102,49,134,49,134,54,102,54"/>
<area shape="rect" href="group__sd__raw.html#ga75085da84454931647328e80f6bdea7c" title="Receives a raw byte from the memory card." alt="" coords="524,29,644,56"/>
<area shape="poly" title=" " alt="" coords="97,26,149,15,213,12,304,13,472,21,509,26,509,31,471,27,304,18,213,17,150,20,98,31"/>
<area shape="rect" href="group__sd__raw.html#ga956fc6f9ea12bf3c42fe5d3b472e61a8" title="Send a command to the memory card which responses with a R1 response." alt="" coords="292,80,471,107"/>
<area shape="poly" title=" " alt="" coords="102,54,150,65,277,83,276,88,149,71,101,59"/>
<area shape="rect" href="group__sd__raw.html#ga157908b0533eb72368d320eb697f0cc0" title="Sends a raw byte to the memory card." alt="" coords="519,105,649,132"/>
<area shape="poly" title=" " alt="" coords="82,54,151,84,220,105,292,116,403,122,504,121,504,126,403,128,292,121,219,110,149,89,80,59"/>
<area shape="poly" title=" " alt="" coords="149,37,117,36,117,31,149,31"/>
<area shape="poly" title=" " alt="" coords="245,40,509,40,509,45,245,45"/>
<area shape="poly" title=" " alt="" coords="245,53,317,73,315,78,244,58"/>
<area shape="poly" title=" " alt="" coords="437,77,512,58,514,63,439,82"/>
<area shape="poly" title=" " alt="" coords="472,102,504,106,503,111,471,107"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__sd__raw_ga70e84e3345f19d2b5eecb9f665b37e0d_icgraph.png" border="0" usemap="#agroup__sd__raw_ga70e84e3345f19d2b5eecb9f665b37e0d_icgraph" alt=""/></div>
<map name="agroup__sd__raw_ga70e84e3345f19d2b5eecb9f665b37e0d_icgraph" id="agroup__sd__raw_ga70e84e3345f19d2b5eecb9f665b37e0d_icgraph">
<area shape="rect" title="Writes raw data to the card." alt="" coords="340,31,436,57"/>
<area shape="poly" title=" " alt="" coords="412,18,404,12,388,9,373,11,366,16,364,22,368,29,363,31,358,22,361,12,372,6,388,4,406,7,415,13"/>
<area shape="rect" href="group__sd__raw.html#ga7aa8ed58f08b39d21b778b66f3e6ce59" title="Send a command to the memory card which responses with a R2 response." alt="" coords="196,31,291,57"/>
<area shape="poly" title=" " alt="" coords="324,56,291,55,291,50,324,50"/>
<area shape="rect" href="group__sd__raw.html#ga8cff641a3a1cd747bb6634eeba1ad54b" title="Writes the write buffer&#39;s content to the card." alt="" coords="195,81,292,108"/>
<area shape="poly" title=" " alt="" coords="334,66,285,83,283,78,333,60"/>
<area shape="poly" title=" " alt="" coords="306,32,340,33,339,38,306,38"/>
<area shape="rect" href="group__sd__raw.html#gac2e6d0ba10cef8f72391d35b4aabf385" title="Initializes memory card communication." alt="" coords="33,5,119,32"/>
<area shape="poly" title=" " alt="" coords="180,37,119,28,120,22,181,32"/>
<area shape="rect" href="group__sd__raw.html#ga0321ddf4d0234479fc90ee90d3e3cc40" title="Continuously reads units of interval bytes and calls a callback function." alt="" coords="5,56,147,83"/>
<area shape="poly" title=" " alt="" coords="181,56,148,61,147,56,180,51"/>
</map>
</div>

</div>
</div>
<a id="ga33e2ae8b1a4e3088a37225670fb2fe99" name="ga33e2ae8b1a4e3088a37225670fb2fe99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga33e2ae8b1a4e3088a37225670fb2fe99">&#9670;&#160;</a></span>SDoff()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SDoff </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="sd__card_8h_source.html#l00878">878</a> of file <a class="el" href="sd__card_8h_source.html">sd_card.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  879</span>{</div>
<div class="line"><span class="lineno">  880</span>    SPI_SS_IODIR &amp;= ~(1&lt;&lt;SPI_SS_PIN);</div>
<div class="line"><span class="lineno">  881</span>    PINSEL0 &amp;= ~(0x1500);</div>
<div class="line"><span class="lineno">  882</span>}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
    <ul>
      <address class="footer">
        <a href="http://ykat.de">
        &copy 2024 ykat UG (haftungsbeschrnkt)
        </a>
        </address>
    </li>
    </ul>
  </div>
  </div>
  </div>
  </div>
  </div>
  </div>
  </body>
  </html>